
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466WOE225TR%2F20251229%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251229T041803Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEMj%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIAiRvHQnNCmBt1BEz99Di7CXHCYuHrPkkFdjsDJZj1y9AiEA2xm8XR%2B9qXQ1O0lyhSlRzAw3Z8OEX0Q%2BMzZSDrrVme8qiAQIkf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDF6qPcbZkJoIOqg6VCrcA3LzgBbjkBhv8MQ9HZb4lyoteQuvVVaFdoRdJ5t5eaRxsd%2FfiPP3vpD%2BBjUB7VMMIpqiYtV9bGwJx4oU5lIScbMRBsC7XhzgjWkdx7Ormj0DZbteWJW%2FQ%2FR3fA1m%2BaY9Rv1Lc9qotjlqML6zX%2FwMwo9%2BNihTQg6OuRlg6CER45CfuIo4bpoOY0IETPnF8y%2FIRsnqSa9EAr2StiyrMq0Oyp7jXo7FHJnKNqaWeatyVlSPpSuNoLMs%2Bg49czns6jaPLukycM7s1Y5ENs7ejFA8fUcLb08lLCkzqN6awmQHWCre3xt%2BGT2q2qa%2F0lChyGT8XxwpPppiKIBKArU45W7IIYm7a83rfuqzQwDXtHKLtUvQLoBti1Sn1RVYRdMy2sL8m%2BPSpvlGpg81%2B99Za7fGSearuRPhVFWZr5JRw4xOO8jbkRv5Ai2yIBXgFb0Cseehswf51MSvhz1XLZkvcWglHoJJkvVJ8fUNpQK2OqlvLjhyhOr4l6s0ugfZDzKXKUFwLUsqh5ehXxRFTbmxiNBHWLa88vu9xHl3gcBSijrifi5Bn%2BGmosP4QL4JOr8DKzuJYNcqeU41IY8c4W5Be7AQjF1rtS85ewzhuezX96hlXMmOcVIgxv0ENcVsP37IMPaOx8oGOqUBdbg0STsJSEeyitOdVCBiqZ5cnQzv5FVEMIi0eK%2FOKcgm2N7z%2FSZPDjytVC8uHAu7AqXpnIwQKoHz8A7yCzyP9wslclfPKzpaFfYiBV59YEIQvEYCywlfxHvDyBOb2Ir92Bz749zsZD%2FH%2BR4UTbbWMkaylvtTXuJwhyX95z8EML%2FoalissDZ75b%2FfpmrhQFX5h4jqrozDVhc%2FESztNAqBrGqWv71A&X-Amz-Signature=b40c2c952fde1628e7883d46ceca9b70930ce18d0249ead40725f17f05ca6517&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466WOE225TR%2F20251229%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251229T041803Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEMj%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIAiRvHQnNCmBt1BEz99Di7CXHCYuHrPkkFdjsDJZj1y9AiEA2xm8XR%2B9qXQ1O0lyhSlRzAw3Z8OEX0Q%2BMzZSDrrVme8qiAQIkf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDF6qPcbZkJoIOqg6VCrcA3LzgBbjkBhv8MQ9HZb4lyoteQuvVVaFdoRdJ5t5eaRxsd%2FfiPP3vpD%2BBjUB7VMMIpqiYtV9bGwJx4oU5lIScbMRBsC7XhzgjWkdx7Ormj0DZbteWJW%2FQ%2FR3fA1m%2BaY9Rv1Lc9qotjlqML6zX%2FwMwo9%2BNihTQg6OuRlg6CER45CfuIo4bpoOY0IETPnF8y%2FIRsnqSa9EAr2StiyrMq0Oyp7jXo7FHJnKNqaWeatyVlSPpSuNoLMs%2Bg49czns6jaPLukycM7s1Y5ENs7ejFA8fUcLb08lLCkzqN6awmQHWCre3xt%2BGT2q2qa%2F0lChyGT8XxwpPppiKIBKArU45W7IIYm7a83rfuqzQwDXtHKLtUvQLoBti1Sn1RVYRdMy2sL8m%2BPSpvlGpg81%2B99Za7fGSearuRPhVFWZr5JRw4xOO8jbkRv5Ai2yIBXgFb0Cseehswf51MSvhz1XLZkvcWglHoJJkvVJ8fUNpQK2OqlvLjhyhOr4l6s0ugfZDzKXKUFwLUsqh5ehXxRFTbmxiNBHWLa88vu9xHl3gcBSijrifi5Bn%2BGmosP4QL4JOr8DKzuJYNcqeU41IY8c4W5Be7AQjF1rtS85ewzhuezX96hlXMmOcVIgxv0ENcVsP37IMPaOx8oGOqUBdbg0STsJSEeyitOdVCBiqZ5cnQzv5FVEMIi0eK%2FOKcgm2N7z%2FSZPDjytVC8uHAu7AqXpnIwQKoHz8A7yCzyP9wslclfPKzpaFfYiBV59YEIQvEYCywlfxHvDyBOb2Ir92Bz749zsZD%2FH%2BR4UTbbWMkaylvtTXuJwhyX95z8EML%2FoalissDZ75b%2FfpmrhQFX5h4jqrozDVhc%2FESztNAqBrGqWv71A&X-Amz-Signature=30473d37e44a3b00c6e9017888d8195c1ca1881df332195e8b173a8d38e658e7&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466WOE225TR%2F20251229%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251229T041803Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEMj%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIAiRvHQnNCmBt1BEz99Di7CXHCYuHrPkkFdjsDJZj1y9AiEA2xm8XR%2B9qXQ1O0lyhSlRzAw3Z8OEX0Q%2BMzZSDrrVme8qiAQIkf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDF6qPcbZkJoIOqg6VCrcA3LzgBbjkBhv8MQ9HZb4lyoteQuvVVaFdoRdJ5t5eaRxsd%2FfiPP3vpD%2BBjUB7VMMIpqiYtV9bGwJx4oU5lIScbMRBsC7XhzgjWkdx7Ormj0DZbteWJW%2FQ%2FR3fA1m%2BaY9Rv1Lc9qotjlqML6zX%2FwMwo9%2BNihTQg6OuRlg6CER45CfuIo4bpoOY0IETPnF8y%2FIRsnqSa9EAr2StiyrMq0Oyp7jXo7FHJnKNqaWeatyVlSPpSuNoLMs%2Bg49czns6jaPLukycM7s1Y5ENs7ejFA8fUcLb08lLCkzqN6awmQHWCre3xt%2BGT2q2qa%2F0lChyGT8XxwpPppiKIBKArU45W7IIYm7a83rfuqzQwDXtHKLtUvQLoBti1Sn1RVYRdMy2sL8m%2BPSpvlGpg81%2B99Za7fGSearuRPhVFWZr5JRw4xOO8jbkRv5Ai2yIBXgFb0Cseehswf51MSvhz1XLZkvcWglHoJJkvVJ8fUNpQK2OqlvLjhyhOr4l6s0ugfZDzKXKUFwLUsqh5ehXxRFTbmxiNBHWLa88vu9xHl3gcBSijrifi5Bn%2BGmosP4QL4JOr8DKzuJYNcqeU41IY8c4W5Be7AQjF1rtS85ewzhuezX96hlXMmOcVIgxv0ENcVsP37IMPaOx8oGOqUBdbg0STsJSEeyitOdVCBiqZ5cnQzv5FVEMIi0eK%2FOKcgm2N7z%2FSZPDjytVC8uHAu7AqXpnIwQKoHz8A7yCzyP9wslclfPKzpaFfYiBV59YEIQvEYCywlfxHvDyBOb2Ir92Bz749zsZD%2FH%2BR4UTbbWMkaylvtTXuJwhyX95z8EML%2FoalissDZ75b%2FfpmrhQFX5h4jqrozDVhc%2FESztNAqBrGqWv71A&X-Amz-Signature=0477cf673461379af791a506c955ee860b6e435b6ab9523632b8043eb5c064a0&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466WOE225TR%2F20251229%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251229T041803Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEMj%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIAiRvHQnNCmBt1BEz99Di7CXHCYuHrPkkFdjsDJZj1y9AiEA2xm8XR%2B9qXQ1O0lyhSlRzAw3Z8OEX0Q%2BMzZSDrrVme8qiAQIkf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDF6qPcbZkJoIOqg6VCrcA3LzgBbjkBhv8MQ9HZb4lyoteQuvVVaFdoRdJ5t5eaRxsd%2FfiPP3vpD%2BBjUB7VMMIpqiYtV9bGwJx4oU5lIScbMRBsC7XhzgjWkdx7Ormj0DZbteWJW%2FQ%2FR3fA1m%2BaY9Rv1Lc9qotjlqML6zX%2FwMwo9%2BNihTQg6OuRlg6CER45CfuIo4bpoOY0IETPnF8y%2FIRsnqSa9EAr2StiyrMq0Oyp7jXo7FHJnKNqaWeatyVlSPpSuNoLMs%2Bg49czns6jaPLukycM7s1Y5ENs7ejFA8fUcLb08lLCkzqN6awmQHWCre3xt%2BGT2q2qa%2F0lChyGT8XxwpPppiKIBKArU45W7IIYm7a83rfuqzQwDXtHKLtUvQLoBti1Sn1RVYRdMy2sL8m%2BPSpvlGpg81%2B99Za7fGSearuRPhVFWZr5JRw4xOO8jbkRv5Ai2yIBXgFb0Cseehswf51MSvhz1XLZkvcWglHoJJkvVJ8fUNpQK2OqlvLjhyhOr4l6s0ugfZDzKXKUFwLUsqh5ehXxRFTbmxiNBHWLa88vu9xHl3gcBSijrifi5Bn%2BGmosP4QL4JOr8DKzuJYNcqeU41IY8c4W5Be7AQjF1rtS85ewzhuezX96hlXMmOcVIgxv0ENcVsP37IMPaOx8oGOqUBdbg0STsJSEeyitOdVCBiqZ5cnQzv5FVEMIi0eK%2FOKcgm2N7z%2FSZPDjytVC8uHAu7AqXpnIwQKoHz8A7yCzyP9wslclfPKzpaFfYiBV59YEIQvEYCywlfxHvDyBOb2Ir92Bz749zsZD%2FH%2BR4UTbbWMkaylvtTXuJwhyX95z8EML%2FoalissDZ75b%2FfpmrhQFX5h4jqrozDVhc%2FESztNAqBrGqWv71A&X-Amz-Signature=5122045e6065fafb3159c71871f84b3467173ef392b1f00357292f18ed7fedaf&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

