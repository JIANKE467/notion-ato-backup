
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466ZWJK6QRZ%2F20251230%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251230T041152Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEOH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIDTA8y3DYo36eh7sAPVEtVIE45snQxzagmYdyTa%2BBxTwAiEAwnO%2B0YNU26blDzfDsPEyPv0%2BhUfVH%2B8vGnHnd18lVYkqiAQIqv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDOXwBs2l18BR1iAWQircAy7sEeXHld5LU3o9a9gv6nzLV41J3aiBo8hc7BTAwdXgQ8EKmYPn%2FOp3Nj2ZLCCUnz6EYbtpNnLcGMZw%2FfxqygK8cUAj0Ee6W%2FdsxHbUuUSCEl30Lo%2FwuuhBSFzDx8ZMqHQBpDDXoYoX0P6SJHrUy5Jz9cy7j5GQ7x8JmRSUdGHA0KSpcIitx0zRhntpw72tSddXodLBHjo9dTL%2F6oikT5CfJJaKiSPNaIT5GVi%2Bf326iGV5jGh8B6fWDkl%2Bg%2Fsg8nZ5zwjs%2BJECmTdiVYC0H%2Fig3x2Q4RWDO3Xx8sg%2FopM5ArSCkRin6gs10%2F47epyxizG7fgFE9uIep7kK4pp5Q3rVhiFGXYuXdhW34WqsAIf%2BSQ%2Fwq8Q1BHVXMzCmCfPHoHc%2FCdZ0xvhjn25xpJjFzLc247uPi2A%2BmgGcQZoISYcYAt4D6mRHqCZYstyUfKEBumPM5WvZIualSxzEKhOEL0bR5SKojxLUjJGwW%2BOA4T2MxTmGNh1hOrmB183j4pvH1CSGvBYelRZOBeYPvVqit8%2BQWLXtbKmUSKS3TrLNLAk2mzl8Df6rvkuM0D4k16Tf4CMaMgxfahFBqvGaLuialAXT9sKf3%2FbmtXTmZfIRlVDKUzbethnJLDKFYMaiMNPIzMoGOqUBo3vFa5JLyZLo%2B0ZTKXvQLG%2Bg2PaPZDJIvGzm8Dcd4oQeH40vq9Mm1caK7OSScuYRpmdMpAGBmhh9Jji6o6WHclMY6%2BFYEfiFYMwWEznQq0dK68WWPGmvWgD4vAu8rbZHS5QnIGAnK1NQ%2BOTmCxkjf1egOVJ2QVRsDyH4l2JPD2%2FsS7Um4pDOmbveqYVJ44dZ76ygtom5UvTcBZmPvIxUAPfmF3By&X-Amz-Signature=acf01b6276a719917103d6cefedad135c8d2deac3366d7cf7a306af4fdd9005b&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466ZWJK6QRZ%2F20251230%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251230T041152Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEOH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIDTA8y3DYo36eh7sAPVEtVIE45snQxzagmYdyTa%2BBxTwAiEAwnO%2B0YNU26blDzfDsPEyPv0%2BhUfVH%2B8vGnHnd18lVYkqiAQIqv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDOXwBs2l18BR1iAWQircAy7sEeXHld5LU3o9a9gv6nzLV41J3aiBo8hc7BTAwdXgQ8EKmYPn%2FOp3Nj2ZLCCUnz6EYbtpNnLcGMZw%2FfxqygK8cUAj0Ee6W%2FdsxHbUuUSCEl30Lo%2FwuuhBSFzDx8ZMqHQBpDDXoYoX0P6SJHrUy5Jz9cy7j5GQ7x8JmRSUdGHA0KSpcIitx0zRhntpw72tSddXodLBHjo9dTL%2F6oikT5CfJJaKiSPNaIT5GVi%2Bf326iGV5jGh8B6fWDkl%2Bg%2Fsg8nZ5zwjs%2BJECmTdiVYC0H%2Fig3x2Q4RWDO3Xx8sg%2FopM5ArSCkRin6gs10%2F47epyxizG7fgFE9uIep7kK4pp5Q3rVhiFGXYuXdhW34WqsAIf%2BSQ%2Fwq8Q1BHVXMzCmCfPHoHc%2FCdZ0xvhjn25xpJjFzLc247uPi2A%2BmgGcQZoISYcYAt4D6mRHqCZYstyUfKEBumPM5WvZIualSxzEKhOEL0bR5SKojxLUjJGwW%2BOA4T2MxTmGNh1hOrmB183j4pvH1CSGvBYelRZOBeYPvVqit8%2BQWLXtbKmUSKS3TrLNLAk2mzl8Df6rvkuM0D4k16Tf4CMaMgxfahFBqvGaLuialAXT9sKf3%2FbmtXTmZfIRlVDKUzbethnJLDKFYMaiMNPIzMoGOqUBo3vFa5JLyZLo%2B0ZTKXvQLG%2Bg2PaPZDJIvGzm8Dcd4oQeH40vq9Mm1caK7OSScuYRpmdMpAGBmhh9Jji6o6WHclMY6%2BFYEfiFYMwWEznQq0dK68WWPGmvWgD4vAu8rbZHS5QnIGAnK1NQ%2BOTmCxkjf1egOVJ2QVRsDyH4l2JPD2%2FsS7Um4pDOmbveqYVJ44dZ76ygtom5UvTcBZmPvIxUAPfmF3By&X-Amz-Signature=86dfbb02114138d83eadf3563c36c1f549921cde1dc28e3f1b7e37ac6d6ba755&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466ZWJK6QRZ%2F20251230%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251230T041152Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEOH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIDTA8y3DYo36eh7sAPVEtVIE45snQxzagmYdyTa%2BBxTwAiEAwnO%2B0YNU26blDzfDsPEyPv0%2BhUfVH%2B8vGnHnd18lVYkqiAQIqv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDOXwBs2l18BR1iAWQircAy7sEeXHld5LU3o9a9gv6nzLV41J3aiBo8hc7BTAwdXgQ8EKmYPn%2FOp3Nj2ZLCCUnz6EYbtpNnLcGMZw%2FfxqygK8cUAj0Ee6W%2FdsxHbUuUSCEl30Lo%2FwuuhBSFzDx8ZMqHQBpDDXoYoX0P6SJHrUy5Jz9cy7j5GQ7x8JmRSUdGHA0KSpcIitx0zRhntpw72tSddXodLBHjo9dTL%2F6oikT5CfJJaKiSPNaIT5GVi%2Bf326iGV5jGh8B6fWDkl%2Bg%2Fsg8nZ5zwjs%2BJECmTdiVYC0H%2Fig3x2Q4RWDO3Xx8sg%2FopM5ArSCkRin6gs10%2F47epyxizG7fgFE9uIep7kK4pp5Q3rVhiFGXYuXdhW34WqsAIf%2BSQ%2Fwq8Q1BHVXMzCmCfPHoHc%2FCdZ0xvhjn25xpJjFzLc247uPi2A%2BmgGcQZoISYcYAt4D6mRHqCZYstyUfKEBumPM5WvZIualSxzEKhOEL0bR5SKojxLUjJGwW%2BOA4T2MxTmGNh1hOrmB183j4pvH1CSGvBYelRZOBeYPvVqit8%2BQWLXtbKmUSKS3TrLNLAk2mzl8Df6rvkuM0D4k16Tf4CMaMgxfahFBqvGaLuialAXT9sKf3%2FbmtXTmZfIRlVDKUzbethnJLDKFYMaiMNPIzMoGOqUBo3vFa5JLyZLo%2B0ZTKXvQLG%2Bg2PaPZDJIvGzm8Dcd4oQeH40vq9Mm1caK7OSScuYRpmdMpAGBmhh9Jji6o6WHclMY6%2BFYEfiFYMwWEznQq0dK68WWPGmvWgD4vAu8rbZHS5QnIGAnK1NQ%2BOTmCxkjf1egOVJ2QVRsDyH4l2JPD2%2FsS7Um4pDOmbveqYVJ44dZ76ygtom5UvTcBZmPvIxUAPfmF3By&X-Amz-Signature=833ec87fa7505204f7117586cbb2405fa31275120bf46dbf31b95aaedc27f66a&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466ZWJK6QRZ%2F20251230%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251230T041152Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEOH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIDTA8y3DYo36eh7sAPVEtVIE45snQxzagmYdyTa%2BBxTwAiEAwnO%2B0YNU26blDzfDsPEyPv0%2BhUfVH%2B8vGnHnd18lVYkqiAQIqv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDOXwBs2l18BR1iAWQircAy7sEeXHld5LU3o9a9gv6nzLV41J3aiBo8hc7BTAwdXgQ8EKmYPn%2FOp3Nj2ZLCCUnz6EYbtpNnLcGMZw%2FfxqygK8cUAj0Ee6W%2FdsxHbUuUSCEl30Lo%2FwuuhBSFzDx8ZMqHQBpDDXoYoX0P6SJHrUy5Jz9cy7j5GQ7x8JmRSUdGHA0KSpcIitx0zRhntpw72tSddXodLBHjo9dTL%2F6oikT5CfJJaKiSPNaIT5GVi%2Bf326iGV5jGh8B6fWDkl%2Bg%2Fsg8nZ5zwjs%2BJECmTdiVYC0H%2Fig3x2Q4RWDO3Xx8sg%2FopM5ArSCkRin6gs10%2F47epyxizG7fgFE9uIep7kK4pp5Q3rVhiFGXYuXdhW34WqsAIf%2BSQ%2Fwq8Q1BHVXMzCmCfPHoHc%2FCdZ0xvhjn25xpJjFzLc247uPi2A%2BmgGcQZoISYcYAt4D6mRHqCZYstyUfKEBumPM5WvZIualSxzEKhOEL0bR5SKojxLUjJGwW%2BOA4T2MxTmGNh1hOrmB183j4pvH1CSGvBYelRZOBeYPvVqit8%2BQWLXtbKmUSKS3TrLNLAk2mzl8Df6rvkuM0D4k16Tf4CMaMgxfahFBqvGaLuialAXT9sKf3%2FbmtXTmZfIRlVDKUzbethnJLDKFYMaiMNPIzMoGOqUBo3vFa5JLyZLo%2B0ZTKXvQLG%2Bg2PaPZDJIvGzm8Dcd4oQeH40vq9Mm1caK7OSScuYRpmdMpAGBmhh9Jji6o6WHclMY6%2BFYEfiFYMwWEznQq0dK68WWPGmvWgD4vAu8rbZHS5QnIGAnK1NQ%2BOTmCxkjf1egOVJ2QVRsDyH4l2JPD2%2FsS7Um4pDOmbveqYVJ44dZ76ygtom5UvTcBZmPvIxUAPfmF3By&X-Amz-Signature=5d21f39267acb5eaf41cd49a6b1ad3ad6e3e59bd82187d735183dddbdbb8acc4&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

