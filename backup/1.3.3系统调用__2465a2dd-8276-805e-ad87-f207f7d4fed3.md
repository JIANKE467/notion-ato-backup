
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QRB356DH%2F20251222%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251222T041429Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECQaCXVzLXdlc3QtMiJHMEUCIF%2FP8x1WP%2FBO9cPUos8DJAzetCJ10zD1OJXLeNak6MBDAiEAx22UFvECChl5QVNNUTsUdLFzgz5OTuCOnwZpVTpOQZcqiAQI7f%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDMtkgUwiikxxSUUG0yrcAz9uWoMl3mddZZFHSXkaRXvtrSMaiwB80DQ8yxNs0Ek44t6hbqee1T7tB6LVwsl0WVKIfqGmI5ZMqiHJyvSQbQeujwVWRItNY3Y8EKRDlJW22vvjo7MstWZTyRDzcEOn8saFM5tZerbhnlnjHfqLXp%2BW%2FGXjOfS2c9T8aHzwY8SLCep5%2BWmnmo9zlFtF6vLDq%2BsVk7GO29EPERIyBZsDJogNGaFJ%2F9flVeJFLwnXFx%2FmyssStOFsuInB7YCattNOvAQYKfxY34pzNqV%2BgCc%2Fi3TbuJ2Bzg%2B80F8Ik%2BA%2BMYudHI1KtlMLRkhH%2B1EBDxEU%2BbcRb7rxUZYsGZWjptCjFerbvqP9Ypr1%2B8AMSegMatg1xS1C0bsnWntdxtSkxKcgvLB6b%2FTh6Jj0DL%2BNTh7D8RTUaeecNJFkPBGND9cPRsrpuwLVtZ6REXCM0LBZQbDsu%2BSUeiQxDPTXSmC1qkt4BWsYLnyvsjwbX403xfY3RrT9g1IoiAUceUqxaC3wpetNNu5%2FfhIHoeKk4bzjss93Q2hudIT7k3%2ByskUNe%2FlfPRoS%2Fe7uoMzImix%2FjzCO9c9Y7QhA0UsBaFgcNhBTjYTI%2BIEtBEhkK2feseif3PUIbCkizND5YAfuhLgEK%2FILMPiFo8oGOqUBiUpnFmI6KQqUrYtvYKKJ%2F0QcX92bxU8n4q0CwybeEBevARNjqXbEJQdEt8ngs4Z2ASp%2B8ZjjV%2FnvpVujSMWUr%2BblqjFinHmG4GIzdraM2Eepe2NXCpcQpLY5DYKtJ1EcludsaD0MHhTjvlTCmQ4FM7je8FP1FNOwUMAHbdW3%2FNoUgKct0fLi8aMp%2F05gcsApzO31AXWticDhkAmvkmNFNPZgGPkv&X-Amz-Signature=9521ec16568995b6d99cd5e8726029640b33394225937b5330f8e610d7aa99fb&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QRB356DH%2F20251222%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251222T041429Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECQaCXVzLXdlc3QtMiJHMEUCIF%2FP8x1WP%2FBO9cPUos8DJAzetCJ10zD1OJXLeNak6MBDAiEAx22UFvECChl5QVNNUTsUdLFzgz5OTuCOnwZpVTpOQZcqiAQI7f%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDMtkgUwiikxxSUUG0yrcAz9uWoMl3mddZZFHSXkaRXvtrSMaiwB80DQ8yxNs0Ek44t6hbqee1T7tB6LVwsl0WVKIfqGmI5ZMqiHJyvSQbQeujwVWRItNY3Y8EKRDlJW22vvjo7MstWZTyRDzcEOn8saFM5tZerbhnlnjHfqLXp%2BW%2FGXjOfS2c9T8aHzwY8SLCep5%2BWmnmo9zlFtF6vLDq%2BsVk7GO29EPERIyBZsDJogNGaFJ%2F9flVeJFLwnXFx%2FmyssStOFsuInB7YCattNOvAQYKfxY34pzNqV%2BgCc%2Fi3TbuJ2Bzg%2B80F8Ik%2BA%2BMYudHI1KtlMLRkhH%2B1EBDxEU%2BbcRb7rxUZYsGZWjptCjFerbvqP9Ypr1%2B8AMSegMatg1xS1C0bsnWntdxtSkxKcgvLB6b%2FTh6Jj0DL%2BNTh7D8RTUaeecNJFkPBGND9cPRsrpuwLVtZ6REXCM0LBZQbDsu%2BSUeiQxDPTXSmC1qkt4BWsYLnyvsjwbX403xfY3RrT9g1IoiAUceUqxaC3wpetNNu5%2FfhIHoeKk4bzjss93Q2hudIT7k3%2ByskUNe%2FlfPRoS%2Fe7uoMzImix%2FjzCO9c9Y7QhA0UsBaFgcNhBTjYTI%2BIEtBEhkK2feseif3PUIbCkizND5YAfuhLgEK%2FILMPiFo8oGOqUBiUpnFmI6KQqUrYtvYKKJ%2F0QcX92bxU8n4q0CwybeEBevARNjqXbEJQdEt8ngs4Z2ASp%2B8ZjjV%2FnvpVujSMWUr%2BblqjFinHmG4GIzdraM2Eepe2NXCpcQpLY5DYKtJ1EcludsaD0MHhTjvlTCmQ4FM7je8FP1FNOwUMAHbdW3%2FNoUgKct0fLi8aMp%2F05gcsApzO31AXWticDhkAmvkmNFNPZgGPkv&X-Amz-Signature=957a544ae7561742361ba731f15a6f54dcd9415f5cfb974b5981dc332c94eae4&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QRB356DH%2F20251222%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251222T041429Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECQaCXVzLXdlc3QtMiJHMEUCIF%2FP8x1WP%2FBO9cPUos8DJAzetCJ10zD1OJXLeNak6MBDAiEAx22UFvECChl5QVNNUTsUdLFzgz5OTuCOnwZpVTpOQZcqiAQI7f%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDMtkgUwiikxxSUUG0yrcAz9uWoMl3mddZZFHSXkaRXvtrSMaiwB80DQ8yxNs0Ek44t6hbqee1T7tB6LVwsl0WVKIfqGmI5ZMqiHJyvSQbQeujwVWRItNY3Y8EKRDlJW22vvjo7MstWZTyRDzcEOn8saFM5tZerbhnlnjHfqLXp%2BW%2FGXjOfS2c9T8aHzwY8SLCep5%2BWmnmo9zlFtF6vLDq%2BsVk7GO29EPERIyBZsDJogNGaFJ%2F9flVeJFLwnXFx%2FmyssStOFsuInB7YCattNOvAQYKfxY34pzNqV%2BgCc%2Fi3TbuJ2Bzg%2B80F8Ik%2BA%2BMYudHI1KtlMLRkhH%2B1EBDxEU%2BbcRb7rxUZYsGZWjptCjFerbvqP9Ypr1%2B8AMSegMatg1xS1C0bsnWntdxtSkxKcgvLB6b%2FTh6Jj0DL%2BNTh7D8RTUaeecNJFkPBGND9cPRsrpuwLVtZ6REXCM0LBZQbDsu%2BSUeiQxDPTXSmC1qkt4BWsYLnyvsjwbX403xfY3RrT9g1IoiAUceUqxaC3wpetNNu5%2FfhIHoeKk4bzjss93Q2hudIT7k3%2ByskUNe%2FlfPRoS%2Fe7uoMzImix%2FjzCO9c9Y7QhA0UsBaFgcNhBTjYTI%2BIEtBEhkK2feseif3PUIbCkizND5YAfuhLgEK%2FILMPiFo8oGOqUBiUpnFmI6KQqUrYtvYKKJ%2F0QcX92bxU8n4q0CwybeEBevARNjqXbEJQdEt8ngs4Z2ASp%2B8ZjjV%2FnvpVujSMWUr%2BblqjFinHmG4GIzdraM2Eepe2NXCpcQpLY5DYKtJ1EcludsaD0MHhTjvlTCmQ4FM7je8FP1FNOwUMAHbdW3%2FNoUgKct0fLi8aMp%2F05gcsApzO31AXWticDhkAmvkmNFNPZgGPkv&X-Amz-Signature=1c6398d3264841e4478ecca3f0a856bd556557be8a39996b17cb98d5b2dc1f3d&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QRB356DH%2F20251222%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251222T041429Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECQaCXVzLXdlc3QtMiJHMEUCIF%2FP8x1WP%2FBO9cPUos8DJAzetCJ10zD1OJXLeNak6MBDAiEAx22UFvECChl5QVNNUTsUdLFzgz5OTuCOnwZpVTpOQZcqiAQI7f%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDMtkgUwiikxxSUUG0yrcAz9uWoMl3mddZZFHSXkaRXvtrSMaiwB80DQ8yxNs0Ek44t6hbqee1T7tB6LVwsl0WVKIfqGmI5ZMqiHJyvSQbQeujwVWRItNY3Y8EKRDlJW22vvjo7MstWZTyRDzcEOn8saFM5tZerbhnlnjHfqLXp%2BW%2FGXjOfS2c9T8aHzwY8SLCep5%2BWmnmo9zlFtF6vLDq%2BsVk7GO29EPERIyBZsDJogNGaFJ%2F9flVeJFLwnXFx%2FmyssStOFsuInB7YCattNOvAQYKfxY34pzNqV%2BgCc%2Fi3TbuJ2Bzg%2B80F8Ik%2BA%2BMYudHI1KtlMLRkhH%2B1EBDxEU%2BbcRb7rxUZYsGZWjptCjFerbvqP9Ypr1%2B8AMSegMatg1xS1C0bsnWntdxtSkxKcgvLB6b%2FTh6Jj0DL%2BNTh7D8RTUaeecNJFkPBGND9cPRsrpuwLVtZ6REXCM0LBZQbDsu%2BSUeiQxDPTXSmC1qkt4BWsYLnyvsjwbX403xfY3RrT9g1IoiAUceUqxaC3wpetNNu5%2FfhIHoeKk4bzjss93Q2hudIT7k3%2ByskUNe%2FlfPRoS%2Fe7uoMzImix%2FjzCO9c9Y7QhA0UsBaFgcNhBTjYTI%2BIEtBEhkK2feseif3PUIbCkizND5YAfuhLgEK%2FILMPiFo8oGOqUBiUpnFmI6KQqUrYtvYKKJ%2F0QcX92bxU8n4q0CwybeEBevARNjqXbEJQdEt8ngs4Z2ASp%2B8ZjjV%2FnvpVujSMWUr%2BblqjFinHmG4GIzdraM2Eepe2NXCpcQpLY5DYKtJ1EcludsaD0MHhTjvlTCmQ4FM7je8FP1FNOwUMAHbdW3%2FNoUgKct0fLi8aMp%2F05gcsApzO31AXWticDhkAmvkmNFNPZgGPkv&X-Amz-Signature=abc15dca94011c4a4e44aa72424325a2283ebc56e6c99f1425ac77e70ff34cc1&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

