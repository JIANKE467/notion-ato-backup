
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466S4Q7J4PD%2F20260105%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260105T042830Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHIaCXVzLXdlc3QtMiJIMEYCIQDrkU54g9FN%2B%2F5WcOTBQGOEtFpfWVvWxtc%2B7hRVVBGLvQIhAJ5F%2FEtI0W35q%2FRJ5CWmmxHOfao%2FBzWiT7tFl4sUCPVvKv8DCDsQABoMNjM3NDIzMTgzODA1IgwRG0U66PXTblCfZTYq3AMbWI5yVLg3yGNKgCTiCy9W3wcXwQ8hFwO30eS37heXHbw6uJQAlXITB2SbI20Tsra2eRrWQdeGteLNPDCR6DR4G5makbBOF2EC%2FpC63jq2Gd54EeYGMlbfy3lnXXBacYpT7JDaNGLdFe1QVb0wv10rTjD9EgUTn3dqtlsWOKpk7FjMc%2FhNLVKZC7oSvTrUsX62L7yAsGdlQxWSs1pTiDi5vsw6IzDRF9LiuwQkE3IVPAZmLf9o9%2Bb7DXyj%2BwEVQp9zUC6JLTw4d7psHIVZAXff1Qeo2MjhA6EezTMGhHsXLSFVWS9%2F%2FSylpnkNOYONMaTI%2Brjc3%2FxRxEFDNE%2BNNUoExSvSNJLR38vemcnQHUzUw%2FPzwTNCN5dlDEePiAKbH6bougaoFMrb7T%2FzeXKlOqZvH4vWwdIW4CrR6G4rna1smPMpkjp%2BTSReeFieONtMLu2XU%2F2Ge8ci0wYtXTIdvgyislYRm5xjrzMn2GNh7uWLb05pXEqw4AJWGOZ49Ifac1MDPky7774aLP7ywgpatMYBLXoSwEOaI8VGbjWbTvUYaKYSrU%2Fi6kFCSo1PEcK2FTA5FktiglWIEBmzjh8MQykLcA1tpjm2qMQ38uGEgDwfSbUtnBicRNHhe8An%2FDCDp%2BzKBjqkAVgESKOObjjpDMhrHEsOsqOwI3n67j30eub2sAYYcL6vSlGfYk8epHazqIjzEGbxjjSgEOLFzViLG81XCaacwWl3LbUILLZHg7twRTFougPT9oabsYs4RKUn2sNJ%2Fdj%2FaYoRQku%2FRdTfKkS51Rr%2Fx72KltgDjWG7NoUt%2BI2zzonXndjWrbhdNFzY5Tc%2Bl%2B90cl7146EQJKHn04L7Lu%2B%2BYIAKGCNU&X-Amz-Signature=d3753d0a79f497dc1cbe01792c36d6c5c48ff7350b6389a540586f1620086617&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466S4Q7J4PD%2F20260105%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260105T042830Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHIaCXVzLXdlc3QtMiJIMEYCIQDrkU54g9FN%2B%2F5WcOTBQGOEtFpfWVvWxtc%2B7hRVVBGLvQIhAJ5F%2FEtI0W35q%2FRJ5CWmmxHOfao%2FBzWiT7tFl4sUCPVvKv8DCDsQABoMNjM3NDIzMTgzODA1IgwRG0U66PXTblCfZTYq3AMbWI5yVLg3yGNKgCTiCy9W3wcXwQ8hFwO30eS37heXHbw6uJQAlXITB2SbI20Tsra2eRrWQdeGteLNPDCR6DR4G5makbBOF2EC%2FpC63jq2Gd54EeYGMlbfy3lnXXBacYpT7JDaNGLdFe1QVb0wv10rTjD9EgUTn3dqtlsWOKpk7FjMc%2FhNLVKZC7oSvTrUsX62L7yAsGdlQxWSs1pTiDi5vsw6IzDRF9LiuwQkE3IVPAZmLf9o9%2Bb7DXyj%2BwEVQp9zUC6JLTw4d7psHIVZAXff1Qeo2MjhA6EezTMGhHsXLSFVWS9%2F%2FSylpnkNOYONMaTI%2Brjc3%2FxRxEFDNE%2BNNUoExSvSNJLR38vemcnQHUzUw%2FPzwTNCN5dlDEePiAKbH6bougaoFMrb7T%2FzeXKlOqZvH4vWwdIW4CrR6G4rna1smPMpkjp%2BTSReeFieONtMLu2XU%2F2Ge8ci0wYtXTIdvgyislYRm5xjrzMn2GNh7uWLb05pXEqw4AJWGOZ49Ifac1MDPky7774aLP7ywgpatMYBLXoSwEOaI8VGbjWbTvUYaKYSrU%2Fi6kFCSo1PEcK2FTA5FktiglWIEBmzjh8MQykLcA1tpjm2qMQ38uGEgDwfSbUtnBicRNHhe8An%2FDCDp%2BzKBjqkAVgESKOObjjpDMhrHEsOsqOwI3n67j30eub2sAYYcL6vSlGfYk8epHazqIjzEGbxjjSgEOLFzViLG81XCaacwWl3LbUILLZHg7twRTFougPT9oabsYs4RKUn2sNJ%2Fdj%2FaYoRQku%2FRdTfKkS51Rr%2Fx72KltgDjWG7NoUt%2BI2zzonXndjWrbhdNFzY5Tc%2Bl%2B90cl7146EQJKHn04L7Lu%2B%2BYIAKGCNU&X-Amz-Signature=482c75962236f51313c79bd9128aa7f0cdb994880095a0b8e31c3a8ab06ecbba&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466S4Q7J4PD%2F20260105%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260105T042830Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHIaCXVzLXdlc3QtMiJIMEYCIQDrkU54g9FN%2B%2F5WcOTBQGOEtFpfWVvWxtc%2B7hRVVBGLvQIhAJ5F%2FEtI0W35q%2FRJ5CWmmxHOfao%2FBzWiT7tFl4sUCPVvKv8DCDsQABoMNjM3NDIzMTgzODA1IgwRG0U66PXTblCfZTYq3AMbWI5yVLg3yGNKgCTiCy9W3wcXwQ8hFwO30eS37heXHbw6uJQAlXITB2SbI20Tsra2eRrWQdeGteLNPDCR6DR4G5makbBOF2EC%2FpC63jq2Gd54EeYGMlbfy3lnXXBacYpT7JDaNGLdFe1QVb0wv10rTjD9EgUTn3dqtlsWOKpk7FjMc%2FhNLVKZC7oSvTrUsX62L7yAsGdlQxWSs1pTiDi5vsw6IzDRF9LiuwQkE3IVPAZmLf9o9%2Bb7DXyj%2BwEVQp9zUC6JLTw4d7psHIVZAXff1Qeo2MjhA6EezTMGhHsXLSFVWS9%2F%2FSylpnkNOYONMaTI%2Brjc3%2FxRxEFDNE%2BNNUoExSvSNJLR38vemcnQHUzUw%2FPzwTNCN5dlDEePiAKbH6bougaoFMrb7T%2FzeXKlOqZvH4vWwdIW4CrR6G4rna1smPMpkjp%2BTSReeFieONtMLu2XU%2F2Ge8ci0wYtXTIdvgyislYRm5xjrzMn2GNh7uWLb05pXEqw4AJWGOZ49Ifac1MDPky7774aLP7ywgpatMYBLXoSwEOaI8VGbjWbTvUYaKYSrU%2Fi6kFCSo1PEcK2FTA5FktiglWIEBmzjh8MQykLcA1tpjm2qMQ38uGEgDwfSbUtnBicRNHhe8An%2FDCDp%2BzKBjqkAVgESKOObjjpDMhrHEsOsqOwI3n67j30eub2sAYYcL6vSlGfYk8epHazqIjzEGbxjjSgEOLFzViLG81XCaacwWl3LbUILLZHg7twRTFougPT9oabsYs4RKUn2sNJ%2Fdj%2FaYoRQku%2FRdTfKkS51Rr%2Fx72KltgDjWG7NoUt%2BI2zzonXndjWrbhdNFzY5Tc%2Bl%2B90cl7146EQJKHn04L7Lu%2B%2BYIAKGCNU&X-Amz-Signature=615274c3e4f571693596a7a7b81f23282634a6aaed2ecc523ef25b47c85c377d&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466S4Q7J4PD%2F20260105%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260105T042830Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHIaCXVzLXdlc3QtMiJIMEYCIQDrkU54g9FN%2B%2F5WcOTBQGOEtFpfWVvWxtc%2B7hRVVBGLvQIhAJ5F%2FEtI0W35q%2FRJ5CWmmxHOfao%2FBzWiT7tFl4sUCPVvKv8DCDsQABoMNjM3NDIzMTgzODA1IgwRG0U66PXTblCfZTYq3AMbWI5yVLg3yGNKgCTiCy9W3wcXwQ8hFwO30eS37heXHbw6uJQAlXITB2SbI20Tsra2eRrWQdeGteLNPDCR6DR4G5makbBOF2EC%2FpC63jq2Gd54EeYGMlbfy3lnXXBacYpT7JDaNGLdFe1QVb0wv10rTjD9EgUTn3dqtlsWOKpk7FjMc%2FhNLVKZC7oSvTrUsX62L7yAsGdlQxWSs1pTiDi5vsw6IzDRF9LiuwQkE3IVPAZmLf9o9%2Bb7DXyj%2BwEVQp9zUC6JLTw4d7psHIVZAXff1Qeo2MjhA6EezTMGhHsXLSFVWS9%2F%2FSylpnkNOYONMaTI%2Brjc3%2FxRxEFDNE%2BNNUoExSvSNJLR38vemcnQHUzUw%2FPzwTNCN5dlDEePiAKbH6bougaoFMrb7T%2FzeXKlOqZvH4vWwdIW4CrR6G4rna1smPMpkjp%2BTSReeFieONtMLu2XU%2F2Ge8ci0wYtXTIdvgyislYRm5xjrzMn2GNh7uWLb05pXEqw4AJWGOZ49Ifac1MDPky7774aLP7ywgpatMYBLXoSwEOaI8VGbjWbTvUYaKYSrU%2Fi6kFCSo1PEcK2FTA5FktiglWIEBmzjh8MQykLcA1tpjm2qMQ38uGEgDwfSbUtnBicRNHhe8An%2FDCDp%2BzKBjqkAVgESKOObjjpDMhrHEsOsqOwI3n67j30eub2sAYYcL6vSlGfYk8epHazqIjzEGbxjjSgEOLFzViLG81XCaacwWl3LbUILLZHg7twRTFougPT9oabsYs4RKUn2sNJ%2Fdj%2FaYoRQku%2FRdTfKkS51Rr%2Fx72KltgDjWG7NoUt%2BI2zzonXndjWrbhdNFzY5Tc%2Bl%2B90cl7146EQJKHn04L7Lu%2B%2BYIAKGCNU&X-Amz-Signature=14b627875be16c4de08c137907bcc70570288ce9c211fd8918d10bbb48f7e0f9&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

