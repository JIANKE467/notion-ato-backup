
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466SGVGAZLX%2F20260124%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260124T041026Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEDwaCXVzLXdlc3QtMiJHMEUCIQCGHUoOL%2FS0XDvSDLcppfc28jFDUfcuwUzEugjKsZjk9AIgE5RtxnkWJHpMAlBopRJx1lyzeDgAH6k6LD89f3y9Spsq%2FwMIBRAAGgw2Mzc0MjMxODM4MDUiDK150edutJ1Zt867DircA18fL110UTAgV54QSu%2FVBJtb5L1NL1EL61RrS5Ro34GDIBuJGM0jiiSXo72ZqyAjzsVrdIGvIT8WByf%2Fo7Z2sVwl3a7sNhU8sgGUNaC%2BvplW8%2FyuC2M%2F4krZ%2F4p%2BWkGw89wLIFGkvA9H1aojWuU4OTCSCmAszFapoDuHUyxqdrgqnsfKKjnC6n%2FhZ%2B75%2FUtSRnxPXDu4%2B5V7DKs5Jb4oi%2FrHOt8Pt0NStEeHiNCJUUJb7DJ0Z7lwMZQhhsKtAbnO8M08FVZH%2B7LH6A369tNxkbhYRizOyFhQt7dH1DPUmiD3dmPEgyALGlsBCQwyUdFJzATZoG6V1e8OxJ36Q289rNdyLv3tamkYtDFNJ39ZFmPdjjH6FWeF5z94hxKXpiQNDPmzN1EeuIrwzse65en%2BAUpzh7u5sbSua2kLBILxM1u7CffSmznB6oWPrJ1JTvYd7tFv4Mw%2FboFig3quQ%2BK6PQ4D0JXfOdLYxtuy13YjY2utUzMNrYwF8oKM7yEYdBYSS0n7VxKX%2Btjh2Cb7byAN8j1hY3hYx1plfDCT2fu8EKUihhnrkkstVRtIbQVgA4rIYJ66h%2FKcG7YknpY4uiIbNBqRQj9sBY3VZTDP%2BD9mE4r3KVlRpulYAzBA%2FetHMIH90MsGOqUBZcRrx2Cing0F6DAZTl%2FHz%2BCgWNynJzvwE8fMBnPNGOrVyzp8yxvb%2Fhc5HNa3Ti1eQUq0Vxh%2By4pj900C2nPEwVMUqoWLJigW9xpBNS%2FN1nRzzz4kFttFapK3MQNWOjvlEHYx%2F7%2BpavKebKP82PgPG55YgmDewzkFt91D1cY8S7THDeezAlaBqKCzVlCdbpiyLGN1ndSRyMSRG%2BCI0cY2GDAljugt&X-Amz-Signature=fcf0ace54b0a4d52d0dcb48b5abd933f1da6cf596330103ec6fa85bb71a87cd5&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466SGVGAZLX%2F20260124%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260124T041026Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEDwaCXVzLXdlc3QtMiJHMEUCIQCGHUoOL%2FS0XDvSDLcppfc28jFDUfcuwUzEugjKsZjk9AIgE5RtxnkWJHpMAlBopRJx1lyzeDgAH6k6LD89f3y9Spsq%2FwMIBRAAGgw2Mzc0MjMxODM4MDUiDK150edutJ1Zt867DircA18fL110UTAgV54QSu%2FVBJtb5L1NL1EL61RrS5Ro34GDIBuJGM0jiiSXo72ZqyAjzsVrdIGvIT8WByf%2Fo7Z2sVwl3a7sNhU8sgGUNaC%2BvplW8%2FyuC2M%2F4krZ%2F4p%2BWkGw89wLIFGkvA9H1aojWuU4OTCSCmAszFapoDuHUyxqdrgqnsfKKjnC6n%2FhZ%2B75%2FUtSRnxPXDu4%2B5V7DKs5Jb4oi%2FrHOt8Pt0NStEeHiNCJUUJb7DJ0Z7lwMZQhhsKtAbnO8M08FVZH%2B7LH6A369tNxkbhYRizOyFhQt7dH1DPUmiD3dmPEgyALGlsBCQwyUdFJzATZoG6V1e8OxJ36Q289rNdyLv3tamkYtDFNJ39ZFmPdjjH6FWeF5z94hxKXpiQNDPmzN1EeuIrwzse65en%2BAUpzh7u5sbSua2kLBILxM1u7CffSmznB6oWPrJ1JTvYd7tFv4Mw%2FboFig3quQ%2BK6PQ4D0JXfOdLYxtuy13YjY2utUzMNrYwF8oKM7yEYdBYSS0n7VxKX%2Btjh2Cb7byAN8j1hY3hYx1plfDCT2fu8EKUihhnrkkstVRtIbQVgA4rIYJ66h%2FKcG7YknpY4uiIbNBqRQj9sBY3VZTDP%2BD9mE4r3KVlRpulYAzBA%2FetHMIH90MsGOqUBZcRrx2Cing0F6DAZTl%2FHz%2BCgWNynJzvwE8fMBnPNGOrVyzp8yxvb%2Fhc5HNa3Ti1eQUq0Vxh%2By4pj900C2nPEwVMUqoWLJigW9xpBNS%2FN1nRzzz4kFttFapK3MQNWOjvlEHYx%2F7%2BpavKebKP82PgPG55YgmDewzkFt91D1cY8S7THDeezAlaBqKCzVlCdbpiyLGN1ndSRyMSRG%2BCI0cY2GDAljugt&X-Amz-Signature=e16ed540e574d32223db149727a216c75757e87926ba2773350074fbf5137ead&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466SGVGAZLX%2F20260124%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260124T041026Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEDwaCXVzLXdlc3QtMiJHMEUCIQCGHUoOL%2FS0XDvSDLcppfc28jFDUfcuwUzEugjKsZjk9AIgE5RtxnkWJHpMAlBopRJx1lyzeDgAH6k6LD89f3y9Spsq%2FwMIBRAAGgw2Mzc0MjMxODM4MDUiDK150edutJ1Zt867DircA18fL110UTAgV54QSu%2FVBJtb5L1NL1EL61RrS5Ro34GDIBuJGM0jiiSXo72ZqyAjzsVrdIGvIT8WByf%2Fo7Z2sVwl3a7sNhU8sgGUNaC%2BvplW8%2FyuC2M%2F4krZ%2F4p%2BWkGw89wLIFGkvA9H1aojWuU4OTCSCmAszFapoDuHUyxqdrgqnsfKKjnC6n%2FhZ%2B75%2FUtSRnxPXDu4%2B5V7DKs5Jb4oi%2FrHOt8Pt0NStEeHiNCJUUJb7DJ0Z7lwMZQhhsKtAbnO8M08FVZH%2B7LH6A369tNxkbhYRizOyFhQt7dH1DPUmiD3dmPEgyALGlsBCQwyUdFJzATZoG6V1e8OxJ36Q289rNdyLv3tamkYtDFNJ39ZFmPdjjH6FWeF5z94hxKXpiQNDPmzN1EeuIrwzse65en%2BAUpzh7u5sbSua2kLBILxM1u7CffSmznB6oWPrJ1JTvYd7tFv4Mw%2FboFig3quQ%2BK6PQ4D0JXfOdLYxtuy13YjY2utUzMNrYwF8oKM7yEYdBYSS0n7VxKX%2Btjh2Cb7byAN8j1hY3hYx1plfDCT2fu8EKUihhnrkkstVRtIbQVgA4rIYJ66h%2FKcG7YknpY4uiIbNBqRQj9sBY3VZTDP%2BD9mE4r3KVlRpulYAzBA%2FetHMIH90MsGOqUBZcRrx2Cing0F6DAZTl%2FHz%2BCgWNynJzvwE8fMBnPNGOrVyzp8yxvb%2Fhc5HNa3Ti1eQUq0Vxh%2By4pj900C2nPEwVMUqoWLJigW9xpBNS%2FN1nRzzz4kFttFapK3MQNWOjvlEHYx%2F7%2BpavKebKP82PgPG55YgmDewzkFt91D1cY8S7THDeezAlaBqKCzVlCdbpiyLGN1ndSRyMSRG%2BCI0cY2GDAljugt&X-Amz-Signature=c414c33f5894487e914353f45f0333d2d8742e37733c3cc66ab403b53bc176fe&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466SGVGAZLX%2F20260124%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260124T041026Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEDwaCXVzLXdlc3QtMiJHMEUCIQCGHUoOL%2FS0XDvSDLcppfc28jFDUfcuwUzEugjKsZjk9AIgE5RtxnkWJHpMAlBopRJx1lyzeDgAH6k6LD89f3y9Spsq%2FwMIBRAAGgw2Mzc0MjMxODM4MDUiDK150edutJ1Zt867DircA18fL110UTAgV54QSu%2FVBJtb5L1NL1EL61RrS5Ro34GDIBuJGM0jiiSXo72ZqyAjzsVrdIGvIT8WByf%2Fo7Z2sVwl3a7sNhU8sgGUNaC%2BvplW8%2FyuC2M%2F4krZ%2F4p%2BWkGw89wLIFGkvA9H1aojWuU4OTCSCmAszFapoDuHUyxqdrgqnsfKKjnC6n%2FhZ%2B75%2FUtSRnxPXDu4%2B5V7DKs5Jb4oi%2FrHOt8Pt0NStEeHiNCJUUJb7DJ0Z7lwMZQhhsKtAbnO8M08FVZH%2B7LH6A369tNxkbhYRizOyFhQt7dH1DPUmiD3dmPEgyALGlsBCQwyUdFJzATZoG6V1e8OxJ36Q289rNdyLv3tamkYtDFNJ39ZFmPdjjH6FWeF5z94hxKXpiQNDPmzN1EeuIrwzse65en%2BAUpzh7u5sbSua2kLBILxM1u7CffSmznB6oWPrJ1JTvYd7tFv4Mw%2FboFig3quQ%2BK6PQ4D0JXfOdLYxtuy13YjY2utUzMNrYwF8oKM7yEYdBYSS0n7VxKX%2Btjh2Cb7byAN8j1hY3hYx1plfDCT2fu8EKUihhnrkkstVRtIbQVgA4rIYJ66h%2FKcG7YknpY4uiIbNBqRQj9sBY3VZTDP%2BD9mE4r3KVlRpulYAzBA%2FetHMIH90MsGOqUBZcRrx2Cing0F6DAZTl%2FHz%2BCgWNynJzvwE8fMBnPNGOrVyzp8yxvb%2Fhc5HNa3Ti1eQUq0Vxh%2By4pj900C2nPEwVMUqoWLJigW9xpBNS%2FN1nRzzz4kFttFapK3MQNWOjvlEHYx%2F7%2BpavKebKP82PgPG55YgmDewzkFt91D1cY8S7THDeezAlaBqKCzVlCdbpiyLGN1ndSRyMSRG%2BCI0cY2GDAljugt&X-Amz-Signature=f7fb537fa8382afeb8b63b26cf5694c480950c8f306affc04f2f4b3f78494c5f&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

