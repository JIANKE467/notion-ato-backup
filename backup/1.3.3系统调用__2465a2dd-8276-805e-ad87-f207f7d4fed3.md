
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466ZN65AYGW%2F20260108%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260108T041156Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjELz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQC24cNHMUuwUJNegjseLy5YJhY4RoxwmwY5JXDhPRx8AgIhAMU%2Bbjyito1bHEko5uMkiu4uaGC0I6hS6AUKkQEJUjBPKogECIX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1Igy6QCvxIJpIJTMkmJ4q3AMSqpo%2FHXRgnKi%2BHk2GRBOREfkyA8oez7HzuioIki3YB76lszvdfszKRy%2Brp4btHPH83v9L5itvrBctEUXtYbbD3TIr0G3cVICkjA1gPIhvioIIq%2FGoeksce6PVMH6kXVkNmqoBcq7MZE1TAQQq%2FJgdA41weLEj9O7l23JsCT2AxkhJ%2Fo7k2wwdaxAlmwcP3G7kDKUB9vYEH0ITTBJseGJhEOyzXsmSlK9Tg6yUj8X5Cy9jnqPfTywKsGNJ95Eahn18TRuqLK%2BXTzX291MG86G%2Bree8HDrZFzrV0ZCZtgpyifycq3TgqfW8P1DKlhSqKa%2BOKFVAyNnYivX8F%2FzbLOJcMU3Mru75hZ5kIyLEDnkm82FmYXrDXvV%2Bo01JCIAzaon27TlRzC4DLsd3J5VXjy78zb2Kj0x4OZmRtvXCifFLSGRUq1KQ%2FVVuoaVbSVfjncKolx7itzOWshIMKrLQFoIoNkJlzANGDqFGX6cAWWHQpLAU9JA0R6VI0gws7Rs%2BgyyQo%2B4HLg4g7JIu%2FLlDerdAZ63p4sNd8Nf0ZF5SXPeJ1fDc2TK3B7gMJnqjf9tkcjtiNwcoj3HdpdMwV87UfSZRFHmgkXwvn6Qch5uNp7DOrQjfYL%2BwmvcxWh69%2FzCNz%2FzKBjqkAcZA7VrFw4mrQNuVBM4vaQ6fQWoQg9Rkx22krHO1M2YVWFOd29GVi3%2FYf4yBwGFQk%2BYAeJ74OX%2F9u7HE4ZYujo7dUzzYDn8aXer44CUDIndcTQ8W1nWN%2FtKzt%2FgcIIS%2BmhDE4C0HsMQiJ6ZY6UAI1KWj%2BYFxYh7CZjreVW4ddC%2FfpeG4Gi1WlirzlQghXYrDHTyG11eoxAhQOHSqxwbEelCqf3Va&X-Amz-Signature=8cb09aa8a0b36f4e50ce0112f2198afb2e73b1c42640ea2624d22d40b27d5ccc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466ZN65AYGW%2F20260108%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260108T041156Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjELz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQC24cNHMUuwUJNegjseLy5YJhY4RoxwmwY5JXDhPRx8AgIhAMU%2Bbjyito1bHEko5uMkiu4uaGC0I6hS6AUKkQEJUjBPKogECIX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1Igy6QCvxIJpIJTMkmJ4q3AMSqpo%2FHXRgnKi%2BHk2GRBOREfkyA8oez7HzuioIki3YB76lszvdfszKRy%2Brp4btHPH83v9L5itvrBctEUXtYbbD3TIr0G3cVICkjA1gPIhvioIIq%2FGoeksce6PVMH6kXVkNmqoBcq7MZE1TAQQq%2FJgdA41weLEj9O7l23JsCT2AxkhJ%2Fo7k2wwdaxAlmwcP3G7kDKUB9vYEH0ITTBJseGJhEOyzXsmSlK9Tg6yUj8X5Cy9jnqPfTywKsGNJ95Eahn18TRuqLK%2BXTzX291MG86G%2Bree8HDrZFzrV0ZCZtgpyifycq3TgqfW8P1DKlhSqKa%2BOKFVAyNnYivX8F%2FzbLOJcMU3Mru75hZ5kIyLEDnkm82FmYXrDXvV%2Bo01JCIAzaon27TlRzC4DLsd3J5VXjy78zb2Kj0x4OZmRtvXCifFLSGRUq1KQ%2FVVuoaVbSVfjncKolx7itzOWshIMKrLQFoIoNkJlzANGDqFGX6cAWWHQpLAU9JA0R6VI0gws7Rs%2BgyyQo%2B4HLg4g7JIu%2FLlDerdAZ63p4sNd8Nf0ZF5SXPeJ1fDc2TK3B7gMJnqjf9tkcjtiNwcoj3HdpdMwV87UfSZRFHmgkXwvn6Qch5uNp7DOrQjfYL%2BwmvcxWh69%2FzCNz%2FzKBjqkAcZA7VrFw4mrQNuVBM4vaQ6fQWoQg9Rkx22krHO1M2YVWFOd29GVi3%2FYf4yBwGFQk%2BYAeJ74OX%2F9u7HE4ZYujo7dUzzYDn8aXer44CUDIndcTQ8W1nWN%2FtKzt%2FgcIIS%2BmhDE4C0HsMQiJ6ZY6UAI1KWj%2BYFxYh7CZjreVW4ddC%2FfpeG4Gi1WlirzlQghXYrDHTyG11eoxAhQOHSqxwbEelCqf3Va&X-Amz-Signature=f5d252fb8fd2cbab59bca490b2405e63022a43e991b0a2eb7302998e6707a083&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466ZN65AYGW%2F20260108%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260108T041156Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjELz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQC24cNHMUuwUJNegjseLy5YJhY4RoxwmwY5JXDhPRx8AgIhAMU%2Bbjyito1bHEko5uMkiu4uaGC0I6hS6AUKkQEJUjBPKogECIX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1Igy6QCvxIJpIJTMkmJ4q3AMSqpo%2FHXRgnKi%2BHk2GRBOREfkyA8oez7HzuioIki3YB76lszvdfszKRy%2Brp4btHPH83v9L5itvrBctEUXtYbbD3TIr0G3cVICkjA1gPIhvioIIq%2FGoeksce6PVMH6kXVkNmqoBcq7MZE1TAQQq%2FJgdA41weLEj9O7l23JsCT2AxkhJ%2Fo7k2wwdaxAlmwcP3G7kDKUB9vYEH0ITTBJseGJhEOyzXsmSlK9Tg6yUj8X5Cy9jnqPfTywKsGNJ95Eahn18TRuqLK%2BXTzX291MG86G%2Bree8HDrZFzrV0ZCZtgpyifycq3TgqfW8P1DKlhSqKa%2BOKFVAyNnYivX8F%2FzbLOJcMU3Mru75hZ5kIyLEDnkm82FmYXrDXvV%2Bo01JCIAzaon27TlRzC4DLsd3J5VXjy78zb2Kj0x4OZmRtvXCifFLSGRUq1KQ%2FVVuoaVbSVfjncKolx7itzOWshIMKrLQFoIoNkJlzANGDqFGX6cAWWHQpLAU9JA0R6VI0gws7Rs%2BgyyQo%2B4HLg4g7JIu%2FLlDerdAZ63p4sNd8Nf0ZF5SXPeJ1fDc2TK3B7gMJnqjf9tkcjtiNwcoj3HdpdMwV87UfSZRFHmgkXwvn6Qch5uNp7DOrQjfYL%2BwmvcxWh69%2FzCNz%2FzKBjqkAcZA7VrFw4mrQNuVBM4vaQ6fQWoQg9Rkx22krHO1M2YVWFOd29GVi3%2FYf4yBwGFQk%2BYAeJ74OX%2F9u7HE4ZYujo7dUzzYDn8aXer44CUDIndcTQ8W1nWN%2FtKzt%2FgcIIS%2BmhDE4C0HsMQiJ6ZY6UAI1KWj%2BYFxYh7CZjreVW4ddC%2FfpeG4Gi1WlirzlQghXYrDHTyG11eoxAhQOHSqxwbEelCqf3Va&X-Amz-Signature=59e44b9748ee4eb9c7f792184d6882457872f344c26d47c7e75649c893da9c2e&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466ZN65AYGW%2F20260108%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260108T041156Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjELz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQC24cNHMUuwUJNegjseLy5YJhY4RoxwmwY5JXDhPRx8AgIhAMU%2Bbjyito1bHEko5uMkiu4uaGC0I6hS6AUKkQEJUjBPKogECIX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1Igy6QCvxIJpIJTMkmJ4q3AMSqpo%2FHXRgnKi%2BHk2GRBOREfkyA8oez7HzuioIki3YB76lszvdfszKRy%2Brp4btHPH83v9L5itvrBctEUXtYbbD3TIr0G3cVICkjA1gPIhvioIIq%2FGoeksce6PVMH6kXVkNmqoBcq7MZE1TAQQq%2FJgdA41weLEj9O7l23JsCT2AxkhJ%2Fo7k2wwdaxAlmwcP3G7kDKUB9vYEH0ITTBJseGJhEOyzXsmSlK9Tg6yUj8X5Cy9jnqPfTywKsGNJ95Eahn18TRuqLK%2BXTzX291MG86G%2Bree8HDrZFzrV0ZCZtgpyifycq3TgqfW8P1DKlhSqKa%2BOKFVAyNnYivX8F%2FzbLOJcMU3Mru75hZ5kIyLEDnkm82FmYXrDXvV%2Bo01JCIAzaon27TlRzC4DLsd3J5VXjy78zb2Kj0x4OZmRtvXCifFLSGRUq1KQ%2FVVuoaVbSVfjncKolx7itzOWshIMKrLQFoIoNkJlzANGDqFGX6cAWWHQpLAU9JA0R6VI0gws7Rs%2BgyyQo%2B4HLg4g7JIu%2FLlDerdAZ63p4sNd8Nf0ZF5SXPeJ1fDc2TK3B7gMJnqjf9tkcjtiNwcoj3HdpdMwV87UfSZRFHmgkXwvn6Qch5uNp7DOrQjfYL%2BwmvcxWh69%2FzCNz%2FzKBjqkAcZA7VrFw4mrQNuVBM4vaQ6fQWoQg9Rkx22krHO1M2YVWFOd29GVi3%2FYf4yBwGFQk%2BYAeJ74OX%2F9u7HE4ZYujo7dUzzYDn8aXer44CUDIndcTQ8W1nWN%2FtKzt%2FgcIIS%2BmhDE4C0HsMQiJ6ZY6UAI1KWj%2BYFxYh7CZjreVW4ddC%2FfpeG4Gi1WlirzlQghXYrDHTyG11eoxAhQOHSqxwbEelCqf3Va&X-Amz-Signature=11ac7dccd23011d55fdda5ea5ec9dfe60bc5e7afb3a2f53fe5c0e18ef8938a13&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

