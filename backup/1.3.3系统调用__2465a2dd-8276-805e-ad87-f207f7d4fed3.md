
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QZ6YCU2R%2F20251216%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251216T040524Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDL7IVWYtNEqGtoOGNeh5a6lO%2Fe2M253O2S3F8QDmCmJAIhAITWZa%2BB93WuyFdLrZHaaZeGysfEm3OZlULzOr999EdEKv8DCFwQABoMNjM3NDIzMTgzODA1IgxKbr606Dmem6lsigIq3AMg0tH7nLvQsQPgnGqEnuxOgpJd4YHthvaJ5FviEG9svjUQ7JHWek%2FyJapeKskeYDgAqohYnZ0RKCampb%2BdtU0QdTHb5DF3oOMZAgDaYKn6xAHC%2F2lZ9efUgJlUbDmJG1UknRfv%2Ff2znu03yw3NSrDdi7njeuuJlxfdZLOB3v5HqrxTezzbJo%2FY0H6FTtvPcvBH0gS1faOSLb7YbLZkRCh7HY1fIGDjONkSKrfE8hMsrivA8dihLBdI%2FkahsAx%2FjaeYNOJ2vnJdwF2kJZ5sIMJLLZ5Boli2tzHpdxf023wsXtn%2B6YLwOqE18yAm6ANTH26ya5IZQ7ELBNUu%2FWDwkFfJC6CzNAx3q4VpoS6FJcVY4Ggz1CrfbPV4hTdoDg%2FZs%2Bx8gmktVM79D%2BndQYPxBCXBN5u7%2BfbY5hgQ6G4PqKCiaoFIeaEEFlIxAwwS8GdukR1j6sRzE1nYzk5VnqGGD9IZUIdbsf2tfvweTLPXZFIOHtpJ5CmN1oU18497BTxVOTa97LQ%2FYCVSuqmcZiWux%2FZ3LYpaBR2qQl%2FDRon79v2DACSWeYb%2BS3T5vQbTEk%2FxmbemqpRnun3Zc7p1c64cEFnPmR0JAQvC2cb37NKUjswoRn3e4O5eXOYell0ydjC5l4PKBjqkAXkMP0IsVLWnpInoO%2FcHqEluI6LGx1FZ2peFIGdg7oTt2F3Z4VbKlHXPTpNrrdjzwubqQ4o0bJ92yFTJ8buMPMTWb6rTpvLvVAm7ztlWF4z%2BSyP%2FfbzsOruyRzFuAN%2BU6FDeOopdkL3kS%2FFA5aw%2BoNSuuugZVFioetUDkLfayOVsQ0VR9uDnC0GIn%2Befz1pKcoZLI%2BVW6vizHzrvP8qYJe4m9Uny&X-Amz-Signature=e6f05be5af8a4ec61323a3528d706b72e560c3d2b791d3e2afb3928e53853cf3&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QZ6YCU2R%2F20251216%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251216T040524Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDL7IVWYtNEqGtoOGNeh5a6lO%2Fe2M253O2S3F8QDmCmJAIhAITWZa%2BB93WuyFdLrZHaaZeGysfEm3OZlULzOr999EdEKv8DCFwQABoMNjM3NDIzMTgzODA1IgxKbr606Dmem6lsigIq3AMg0tH7nLvQsQPgnGqEnuxOgpJd4YHthvaJ5FviEG9svjUQ7JHWek%2FyJapeKskeYDgAqohYnZ0RKCampb%2BdtU0QdTHb5DF3oOMZAgDaYKn6xAHC%2F2lZ9efUgJlUbDmJG1UknRfv%2Ff2znu03yw3NSrDdi7njeuuJlxfdZLOB3v5HqrxTezzbJo%2FY0H6FTtvPcvBH0gS1faOSLb7YbLZkRCh7HY1fIGDjONkSKrfE8hMsrivA8dihLBdI%2FkahsAx%2FjaeYNOJ2vnJdwF2kJZ5sIMJLLZ5Boli2tzHpdxf023wsXtn%2B6YLwOqE18yAm6ANTH26ya5IZQ7ELBNUu%2FWDwkFfJC6CzNAx3q4VpoS6FJcVY4Ggz1CrfbPV4hTdoDg%2FZs%2Bx8gmktVM79D%2BndQYPxBCXBN5u7%2BfbY5hgQ6G4PqKCiaoFIeaEEFlIxAwwS8GdukR1j6sRzE1nYzk5VnqGGD9IZUIdbsf2tfvweTLPXZFIOHtpJ5CmN1oU18497BTxVOTa97LQ%2FYCVSuqmcZiWux%2FZ3LYpaBR2qQl%2FDRon79v2DACSWeYb%2BS3T5vQbTEk%2FxmbemqpRnun3Zc7p1c64cEFnPmR0JAQvC2cb37NKUjswoRn3e4O5eXOYell0ydjC5l4PKBjqkAXkMP0IsVLWnpInoO%2FcHqEluI6LGx1FZ2peFIGdg7oTt2F3Z4VbKlHXPTpNrrdjzwubqQ4o0bJ92yFTJ8buMPMTWb6rTpvLvVAm7ztlWF4z%2BSyP%2FfbzsOruyRzFuAN%2BU6FDeOopdkL3kS%2FFA5aw%2BoNSuuugZVFioetUDkLfayOVsQ0VR9uDnC0GIn%2Befz1pKcoZLI%2BVW6vizHzrvP8qYJe4m9Uny&X-Amz-Signature=9d7355ca2e16b703b5020d0456c793c240eed6a6a207843368b3ffb15799a1d8&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QZ6YCU2R%2F20251216%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251216T040524Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDL7IVWYtNEqGtoOGNeh5a6lO%2Fe2M253O2S3F8QDmCmJAIhAITWZa%2BB93WuyFdLrZHaaZeGysfEm3OZlULzOr999EdEKv8DCFwQABoMNjM3NDIzMTgzODA1IgxKbr606Dmem6lsigIq3AMg0tH7nLvQsQPgnGqEnuxOgpJd4YHthvaJ5FviEG9svjUQ7JHWek%2FyJapeKskeYDgAqohYnZ0RKCampb%2BdtU0QdTHb5DF3oOMZAgDaYKn6xAHC%2F2lZ9efUgJlUbDmJG1UknRfv%2Ff2znu03yw3NSrDdi7njeuuJlxfdZLOB3v5HqrxTezzbJo%2FY0H6FTtvPcvBH0gS1faOSLb7YbLZkRCh7HY1fIGDjONkSKrfE8hMsrivA8dihLBdI%2FkahsAx%2FjaeYNOJ2vnJdwF2kJZ5sIMJLLZ5Boli2tzHpdxf023wsXtn%2B6YLwOqE18yAm6ANTH26ya5IZQ7ELBNUu%2FWDwkFfJC6CzNAx3q4VpoS6FJcVY4Ggz1CrfbPV4hTdoDg%2FZs%2Bx8gmktVM79D%2BndQYPxBCXBN5u7%2BfbY5hgQ6G4PqKCiaoFIeaEEFlIxAwwS8GdukR1j6sRzE1nYzk5VnqGGD9IZUIdbsf2tfvweTLPXZFIOHtpJ5CmN1oU18497BTxVOTa97LQ%2FYCVSuqmcZiWux%2FZ3LYpaBR2qQl%2FDRon79v2DACSWeYb%2BS3T5vQbTEk%2FxmbemqpRnun3Zc7p1c64cEFnPmR0JAQvC2cb37NKUjswoRn3e4O5eXOYell0ydjC5l4PKBjqkAXkMP0IsVLWnpInoO%2FcHqEluI6LGx1FZ2peFIGdg7oTt2F3Z4VbKlHXPTpNrrdjzwubqQ4o0bJ92yFTJ8buMPMTWb6rTpvLvVAm7ztlWF4z%2BSyP%2FfbzsOruyRzFuAN%2BU6FDeOopdkL3kS%2FFA5aw%2BoNSuuugZVFioetUDkLfayOVsQ0VR9uDnC0GIn%2Befz1pKcoZLI%2BVW6vizHzrvP8qYJe4m9Uny&X-Amz-Signature=f7c01afdb9a2a653d6fb131ffccf313264dd77d8bf90e2679e4453ffc85aea11&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QZ6YCU2R%2F20251216%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251216T040524Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDL7IVWYtNEqGtoOGNeh5a6lO%2Fe2M253O2S3F8QDmCmJAIhAITWZa%2BB93WuyFdLrZHaaZeGysfEm3OZlULzOr999EdEKv8DCFwQABoMNjM3NDIzMTgzODA1IgxKbr606Dmem6lsigIq3AMg0tH7nLvQsQPgnGqEnuxOgpJd4YHthvaJ5FviEG9svjUQ7JHWek%2FyJapeKskeYDgAqohYnZ0RKCampb%2BdtU0QdTHb5DF3oOMZAgDaYKn6xAHC%2F2lZ9efUgJlUbDmJG1UknRfv%2Ff2znu03yw3NSrDdi7njeuuJlxfdZLOB3v5HqrxTezzbJo%2FY0H6FTtvPcvBH0gS1faOSLb7YbLZkRCh7HY1fIGDjONkSKrfE8hMsrivA8dihLBdI%2FkahsAx%2FjaeYNOJ2vnJdwF2kJZ5sIMJLLZ5Boli2tzHpdxf023wsXtn%2B6YLwOqE18yAm6ANTH26ya5IZQ7ELBNUu%2FWDwkFfJC6CzNAx3q4VpoS6FJcVY4Ggz1CrfbPV4hTdoDg%2FZs%2Bx8gmktVM79D%2BndQYPxBCXBN5u7%2BfbY5hgQ6G4PqKCiaoFIeaEEFlIxAwwS8GdukR1j6sRzE1nYzk5VnqGGD9IZUIdbsf2tfvweTLPXZFIOHtpJ5CmN1oU18497BTxVOTa97LQ%2FYCVSuqmcZiWux%2FZ3LYpaBR2qQl%2FDRon79v2DACSWeYb%2BS3T5vQbTEk%2FxmbemqpRnun3Zc7p1c64cEFnPmR0JAQvC2cb37NKUjswoRn3e4O5eXOYell0ydjC5l4PKBjqkAXkMP0IsVLWnpInoO%2FcHqEluI6LGx1FZ2peFIGdg7oTt2F3Z4VbKlHXPTpNrrdjzwubqQ4o0bJ92yFTJ8buMPMTWb6rTpvLvVAm7ztlWF4z%2BSyP%2FfbzsOruyRzFuAN%2BU6FDeOopdkL3kS%2FFA5aw%2BoNSuuugZVFioetUDkLfayOVsQ0VR9uDnC0GIn%2Befz1pKcoZLI%2BVW6vizHzrvP8qYJe4m9Uny&X-Amz-Signature=866bec02ed681f07d55cb3bb5115084788db213e0b7cb5f5009a79d7079d4f91&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

