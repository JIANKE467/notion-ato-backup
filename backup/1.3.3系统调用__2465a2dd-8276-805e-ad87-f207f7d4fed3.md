
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QB6IXJPV%2F20260130%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260130T045540Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEMz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQD8J2YcmV3%2FSi3fX2RupfLpKLk%2FX%2FC%2BrZVwWApOUwHmcAIhALfupqnRDesd9KhXyhszQ8s%2BrDKv5Ah8V7nCZQo7VfSzKogECJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1IgwXcsxunWlJvK6%2FALEq3AOKlgeabJx5RraHr7PGniI1F3p%2Bra9ul83lTScATAETQzvaVVau1DgwT55Xg2Sg%2BipTyr%2FmWXvpJeFh8Gy1sS4tBE4D0LJcTbSjXmGFqo8MtriTpUwu3%2F3uKwIsRCRnwZkusw9yTnTZX75BMfyWeziS8EoV2gtM%2BOKZ1RThC9%2BmHMZeKu4FhdvCGheBuX%2BrSden1SlghhqEDxHOsCf%2BMak3TyzQ1ORViwhBPZVWNoFe9NXzp3R6GCSPR%2B9gDEF4ytgZoJlmiLqYTfnGOb8BEBGi62v4VXrDCbQPuv%2BDCfVmIVy%2FvHtBmPrBvgJHdQaHWVXUlbpiz5hXoCIEH%2BK9geex21J%2FYnpeuF16RTwVkuVArCFgSTVmWfdp61oWQFx8BRFlulj7of9fSYATfB5nsI8xji7ctvEm7sQMXuhWQwI6FkHp%2BdDgET%2Fpkm9MN%2BfpR1WQGYF1EEf9c%2FAUEL4d9XeDNjDMLb27gDjbpTwUT9Dma%2BBTuCiQWc2AQXSijAzYCAcqI6LFXpOUh5VrGaLsLaVIXCbsDv6DW5KWyLG59wraavwY7DjzvJ8EzNBRRzd%2FGP5s3kSzHf6Wbjj8LJ08mt3XnJHJMY39GMzpkKPexo%2FjS%2BWK6x78RgLn4%2BG7%2FDCh2fDLBjqkAbKsgSaEy6gKdOeqv9VM5qc5I%2BZMJr%2F4Ka9%2FMCygjToGBiUQBUO8e5dRlSlCytz1OYh5DMz6zk0FVLcHgU1lzLWzU89iWN6j7eXpQaIdJlp9feky8GrcAC%2B99PFvXuBCWhKmhQeKSQBnpGZS4L51MxWKigfkz4L8fiaWgg0ubP5%2FyOyK%2B%2BqExfOqLYiD4%2F3C068CgjxBSRyK%2F9Kjnkbf6k3O4NfR&X-Amz-Signature=335e7d19ecc8d281f8f1bb6bd7c5f7b60627c0f7d6804e01cd649dd98fd1f122&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QB6IXJPV%2F20260130%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260130T045540Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEMz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQD8J2YcmV3%2FSi3fX2RupfLpKLk%2FX%2FC%2BrZVwWApOUwHmcAIhALfupqnRDesd9KhXyhszQ8s%2BrDKv5Ah8V7nCZQo7VfSzKogECJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1IgwXcsxunWlJvK6%2FALEq3AOKlgeabJx5RraHr7PGniI1F3p%2Bra9ul83lTScATAETQzvaVVau1DgwT55Xg2Sg%2BipTyr%2FmWXvpJeFh8Gy1sS4tBE4D0LJcTbSjXmGFqo8MtriTpUwu3%2F3uKwIsRCRnwZkusw9yTnTZX75BMfyWeziS8EoV2gtM%2BOKZ1RThC9%2BmHMZeKu4FhdvCGheBuX%2BrSden1SlghhqEDxHOsCf%2BMak3TyzQ1ORViwhBPZVWNoFe9NXzp3R6GCSPR%2B9gDEF4ytgZoJlmiLqYTfnGOb8BEBGi62v4VXrDCbQPuv%2BDCfVmIVy%2FvHtBmPrBvgJHdQaHWVXUlbpiz5hXoCIEH%2BK9geex21J%2FYnpeuF16RTwVkuVArCFgSTVmWfdp61oWQFx8BRFlulj7of9fSYATfB5nsI8xji7ctvEm7sQMXuhWQwI6FkHp%2BdDgET%2Fpkm9MN%2BfpR1WQGYF1EEf9c%2FAUEL4d9XeDNjDMLb27gDjbpTwUT9Dma%2BBTuCiQWc2AQXSijAzYCAcqI6LFXpOUh5VrGaLsLaVIXCbsDv6DW5KWyLG59wraavwY7DjzvJ8EzNBRRzd%2FGP5s3kSzHf6Wbjj8LJ08mt3XnJHJMY39GMzpkKPexo%2FjS%2BWK6x78RgLn4%2BG7%2FDCh2fDLBjqkAbKsgSaEy6gKdOeqv9VM5qc5I%2BZMJr%2F4Ka9%2FMCygjToGBiUQBUO8e5dRlSlCytz1OYh5DMz6zk0FVLcHgU1lzLWzU89iWN6j7eXpQaIdJlp9feky8GrcAC%2B99PFvXuBCWhKmhQeKSQBnpGZS4L51MxWKigfkz4L8fiaWgg0ubP5%2FyOyK%2B%2BqExfOqLYiD4%2F3C068CgjxBSRyK%2F9Kjnkbf6k3O4NfR&X-Amz-Signature=5adf8207e0e373e05d6165b3dceab426cb68bebd18c973f19496ec623452d346&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QB6IXJPV%2F20260130%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260130T045540Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEMz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQD8J2YcmV3%2FSi3fX2RupfLpKLk%2FX%2FC%2BrZVwWApOUwHmcAIhALfupqnRDesd9KhXyhszQ8s%2BrDKv5Ah8V7nCZQo7VfSzKogECJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1IgwXcsxunWlJvK6%2FALEq3AOKlgeabJx5RraHr7PGniI1F3p%2Bra9ul83lTScATAETQzvaVVau1DgwT55Xg2Sg%2BipTyr%2FmWXvpJeFh8Gy1sS4tBE4D0LJcTbSjXmGFqo8MtriTpUwu3%2F3uKwIsRCRnwZkusw9yTnTZX75BMfyWeziS8EoV2gtM%2BOKZ1RThC9%2BmHMZeKu4FhdvCGheBuX%2BrSden1SlghhqEDxHOsCf%2BMak3TyzQ1ORViwhBPZVWNoFe9NXzp3R6GCSPR%2B9gDEF4ytgZoJlmiLqYTfnGOb8BEBGi62v4VXrDCbQPuv%2BDCfVmIVy%2FvHtBmPrBvgJHdQaHWVXUlbpiz5hXoCIEH%2BK9geex21J%2FYnpeuF16RTwVkuVArCFgSTVmWfdp61oWQFx8BRFlulj7of9fSYATfB5nsI8xji7ctvEm7sQMXuhWQwI6FkHp%2BdDgET%2Fpkm9MN%2BfpR1WQGYF1EEf9c%2FAUEL4d9XeDNjDMLb27gDjbpTwUT9Dma%2BBTuCiQWc2AQXSijAzYCAcqI6LFXpOUh5VrGaLsLaVIXCbsDv6DW5KWyLG59wraavwY7DjzvJ8EzNBRRzd%2FGP5s3kSzHf6Wbjj8LJ08mt3XnJHJMY39GMzpkKPexo%2FjS%2BWK6x78RgLn4%2BG7%2FDCh2fDLBjqkAbKsgSaEy6gKdOeqv9VM5qc5I%2BZMJr%2F4Ka9%2FMCygjToGBiUQBUO8e5dRlSlCytz1OYh5DMz6zk0FVLcHgU1lzLWzU89iWN6j7eXpQaIdJlp9feky8GrcAC%2B99PFvXuBCWhKmhQeKSQBnpGZS4L51MxWKigfkz4L8fiaWgg0ubP5%2FyOyK%2B%2BqExfOqLYiD4%2F3C068CgjxBSRyK%2F9Kjnkbf6k3O4NfR&X-Amz-Signature=4f359a88ddc8a547fcd7ca4ab5e8cb4e1450c459cd20c6ce98f27872b5fcdd62&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QB6IXJPV%2F20260130%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260130T045540Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEMz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQD8J2YcmV3%2FSi3fX2RupfLpKLk%2FX%2FC%2BrZVwWApOUwHmcAIhALfupqnRDesd9KhXyhszQ8s%2BrDKv5Ah8V7nCZQo7VfSzKogECJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1IgwXcsxunWlJvK6%2FALEq3AOKlgeabJx5RraHr7PGniI1F3p%2Bra9ul83lTScATAETQzvaVVau1DgwT55Xg2Sg%2BipTyr%2FmWXvpJeFh8Gy1sS4tBE4D0LJcTbSjXmGFqo8MtriTpUwu3%2F3uKwIsRCRnwZkusw9yTnTZX75BMfyWeziS8EoV2gtM%2BOKZ1RThC9%2BmHMZeKu4FhdvCGheBuX%2BrSden1SlghhqEDxHOsCf%2BMak3TyzQ1ORViwhBPZVWNoFe9NXzp3R6GCSPR%2B9gDEF4ytgZoJlmiLqYTfnGOb8BEBGi62v4VXrDCbQPuv%2BDCfVmIVy%2FvHtBmPrBvgJHdQaHWVXUlbpiz5hXoCIEH%2BK9geex21J%2FYnpeuF16RTwVkuVArCFgSTVmWfdp61oWQFx8BRFlulj7of9fSYATfB5nsI8xji7ctvEm7sQMXuhWQwI6FkHp%2BdDgET%2Fpkm9MN%2BfpR1WQGYF1EEf9c%2FAUEL4d9XeDNjDMLb27gDjbpTwUT9Dma%2BBTuCiQWc2AQXSijAzYCAcqI6LFXpOUh5VrGaLsLaVIXCbsDv6DW5KWyLG59wraavwY7DjzvJ8EzNBRRzd%2FGP5s3kSzHf6Wbjj8LJ08mt3XnJHJMY39GMzpkKPexo%2FjS%2BWK6x78RgLn4%2BG7%2FDCh2fDLBjqkAbKsgSaEy6gKdOeqv9VM5qc5I%2BZMJr%2F4Ka9%2FMCygjToGBiUQBUO8e5dRlSlCytz1OYh5DMz6zk0FVLcHgU1lzLWzU89iWN6j7eXpQaIdJlp9feky8GrcAC%2B99PFvXuBCWhKmhQeKSQBnpGZS4L51MxWKigfkz4L8fiaWgg0ubP5%2FyOyK%2B%2BqExfOqLYiD4%2F3C068CgjxBSRyK%2F9Kjnkbf6k3O4NfR&X-Amz-Signature=a34cd068fd4737d184fc22477e9132c01188ab3f632241690cc12d8faa8b8144&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

