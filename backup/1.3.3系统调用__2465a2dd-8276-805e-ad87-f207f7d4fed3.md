
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466USWYIQRO%2F20260104%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260104T042041Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEFsaCXVzLXdlc3QtMiJHMEUCIBj3RRiLbXiYEIo7XyuWm3Sr6cn0nmf3YqDsWYzQ1AauAiEAsOr4hd591%2FoX4UY84CN5iGDgaPmir6X9ATZnxRWddk4q%2FwMIJBAAGgw2Mzc0MjMxODM4MDUiDGf60ZC96ZD1K5HBDyrcAz%2B%2Bq6zFp2WkAsie7ZaXYFva6JxCnBtA484z5wuHDTlEJkdtXg57T%2BT68hOxR9FbWmhFqCJOt8zc0fI6LRG4kLouf4%2FaFoT9SK6fQpRyva14oRjW7NkQ4Yid6%2FXP%2ByCY4Y076xZhTvrGUD0Cpmhypd7gf3v8kaDMEzidddeDXrpykIlLFLWjsbeg6SXIZwPvjv5CbBBpK1Hy8qditJLfrsql1WeYLaBEpiObuPYdovpYf79YYv8gmxxH0NUSiOxVxT7YMVsHs81TCZxoZfTj3IeA0NpAnLYQVu%2FnS4ptrcasOGqk8ngqV2hGOJvdybAQd%2FamLG0Gza4tthcuOJw2FEgwM6%2FsALzRfCkchTI4StvvMuQlboVYHTHWWXgdFW7vVh%2BKdMoBPYqtXbV3S3%2BHkL2G1b11HePA17kEX%2FxLfqkd6UA9uW1aionzJBVG5aggTDKfHVcU2vTdag5gaFghrRS9a4%2BZdqINHAQLN7rnb8EbPEjGTJ6wVFBILF0n4gptQkzmjJFDcn191ewjFp4WC2hyTfjqZk0TP%2FTNgHWRa%2Fgp3Yb4NYcBbKuqUfWlvBz60VCJC1AYjWZExbFIZpEKTrxDG0jOjYNx7PCy0kxnNDsKgXIRMScuxqKOJTQoMLum58oGOqUB9sxhlPtAj6%2FCcET7VIoPbP3pidotclEtrKF2yawbYYW7GRfTyDeSl8uGUmln%2B7%2B6xnyFeJ7e08KeT3dCz2ogUzgUcHK3l6McEerg2cGzaiQgsNdbijnf99YqTWC%2BAcUzNpXM%2FGLxoiac4HiIZ4h8LSW4M8hg0B4yDOt5KRkxo7GLFQe5KEm2B1qBYJGQ%2FoQ%2FjbnCv5NUhI2%2BdUdCB3LzpXrdGlV%2B&X-Amz-Signature=b06dab4b4f84fd07d898d9a6b36000dea558a34647915b4417fe75e70021df41&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466USWYIQRO%2F20260104%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260104T042041Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEFsaCXVzLXdlc3QtMiJHMEUCIBj3RRiLbXiYEIo7XyuWm3Sr6cn0nmf3YqDsWYzQ1AauAiEAsOr4hd591%2FoX4UY84CN5iGDgaPmir6X9ATZnxRWddk4q%2FwMIJBAAGgw2Mzc0MjMxODM4MDUiDGf60ZC96ZD1K5HBDyrcAz%2B%2Bq6zFp2WkAsie7ZaXYFva6JxCnBtA484z5wuHDTlEJkdtXg57T%2BT68hOxR9FbWmhFqCJOt8zc0fI6LRG4kLouf4%2FaFoT9SK6fQpRyva14oRjW7NkQ4Yid6%2FXP%2ByCY4Y076xZhTvrGUD0Cpmhypd7gf3v8kaDMEzidddeDXrpykIlLFLWjsbeg6SXIZwPvjv5CbBBpK1Hy8qditJLfrsql1WeYLaBEpiObuPYdovpYf79YYv8gmxxH0NUSiOxVxT7YMVsHs81TCZxoZfTj3IeA0NpAnLYQVu%2FnS4ptrcasOGqk8ngqV2hGOJvdybAQd%2FamLG0Gza4tthcuOJw2FEgwM6%2FsALzRfCkchTI4StvvMuQlboVYHTHWWXgdFW7vVh%2BKdMoBPYqtXbV3S3%2BHkL2G1b11HePA17kEX%2FxLfqkd6UA9uW1aionzJBVG5aggTDKfHVcU2vTdag5gaFghrRS9a4%2BZdqINHAQLN7rnb8EbPEjGTJ6wVFBILF0n4gptQkzmjJFDcn191ewjFp4WC2hyTfjqZk0TP%2FTNgHWRa%2Fgp3Yb4NYcBbKuqUfWlvBz60VCJC1AYjWZExbFIZpEKTrxDG0jOjYNx7PCy0kxnNDsKgXIRMScuxqKOJTQoMLum58oGOqUB9sxhlPtAj6%2FCcET7VIoPbP3pidotclEtrKF2yawbYYW7GRfTyDeSl8uGUmln%2B7%2B6xnyFeJ7e08KeT3dCz2ogUzgUcHK3l6McEerg2cGzaiQgsNdbijnf99YqTWC%2BAcUzNpXM%2FGLxoiac4HiIZ4h8LSW4M8hg0B4yDOt5KRkxo7GLFQe5KEm2B1qBYJGQ%2FoQ%2FjbnCv5NUhI2%2BdUdCB3LzpXrdGlV%2B&X-Amz-Signature=fb791a577e35cc12ee393c6193a2d282357665353800fe4a58504c50bd39ac17&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466USWYIQRO%2F20260104%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260104T042041Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEFsaCXVzLXdlc3QtMiJHMEUCIBj3RRiLbXiYEIo7XyuWm3Sr6cn0nmf3YqDsWYzQ1AauAiEAsOr4hd591%2FoX4UY84CN5iGDgaPmir6X9ATZnxRWddk4q%2FwMIJBAAGgw2Mzc0MjMxODM4MDUiDGf60ZC96ZD1K5HBDyrcAz%2B%2Bq6zFp2WkAsie7ZaXYFva6JxCnBtA484z5wuHDTlEJkdtXg57T%2BT68hOxR9FbWmhFqCJOt8zc0fI6LRG4kLouf4%2FaFoT9SK6fQpRyva14oRjW7NkQ4Yid6%2FXP%2ByCY4Y076xZhTvrGUD0Cpmhypd7gf3v8kaDMEzidddeDXrpykIlLFLWjsbeg6SXIZwPvjv5CbBBpK1Hy8qditJLfrsql1WeYLaBEpiObuPYdovpYf79YYv8gmxxH0NUSiOxVxT7YMVsHs81TCZxoZfTj3IeA0NpAnLYQVu%2FnS4ptrcasOGqk8ngqV2hGOJvdybAQd%2FamLG0Gza4tthcuOJw2FEgwM6%2FsALzRfCkchTI4StvvMuQlboVYHTHWWXgdFW7vVh%2BKdMoBPYqtXbV3S3%2BHkL2G1b11HePA17kEX%2FxLfqkd6UA9uW1aionzJBVG5aggTDKfHVcU2vTdag5gaFghrRS9a4%2BZdqINHAQLN7rnb8EbPEjGTJ6wVFBILF0n4gptQkzmjJFDcn191ewjFp4WC2hyTfjqZk0TP%2FTNgHWRa%2Fgp3Yb4NYcBbKuqUfWlvBz60VCJC1AYjWZExbFIZpEKTrxDG0jOjYNx7PCy0kxnNDsKgXIRMScuxqKOJTQoMLum58oGOqUB9sxhlPtAj6%2FCcET7VIoPbP3pidotclEtrKF2yawbYYW7GRfTyDeSl8uGUmln%2B7%2B6xnyFeJ7e08KeT3dCz2ogUzgUcHK3l6McEerg2cGzaiQgsNdbijnf99YqTWC%2BAcUzNpXM%2FGLxoiac4HiIZ4h8LSW4M8hg0B4yDOt5KRkxo7GLFQe5KEm2B1qBYJGQ%2FoQ%2FjbnCv5NUhI2%2BdUdCB3LzpXrdGlV%2B&X-Amz-Signature=4061bb51ab486d3b702cbca7ae22db443c33f47cc665710348f8a95975f93065&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466USWYIQRO%2F20260104%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260104T042041Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEFsaCXVzLXdlc3QtMiJHMEUCIBj3RRiLbXiYEIo7XyuWm3Sr6cn0nmf3YqDsWYzQ1AauAiEAsOr4hd591%2FoX4UY84CN5iGDgaPmir6X9ATZnxRWddk4q%2FwMIJBAAGgw2Mzc0MjMxODM4MDUiDGf60ZC96ZD1K5HBDyrcAz%2B%2Bq6zFp2WkAsie7ZaXYFva6JxCnBtA484z5wuHDTlEJkdtXg57T%2BT68hOxR9FbWmhFqCJOt8zc0fI6LRG4kLouf4%2FaFoT9SK6fQpRyva14oRjW7NkQ4Yid6%2FXP%2ByCY4Y076xZhTvrGUD0Cpmhypd7gf3v8kaDMEzidddeDXrpykIlLFLWjsbeg6SXIZwPvjv5CbBBpK1Hy8qditJLfrsql1WeYLaBEpiObuPYdovpYf79YYv8gmxxH0NUSiOxVxT7YMVsHs81TCZxoZfTj3IeA0NpAnLYQVu%2FnS4ptrcasOGqk8ngqV2hGOJvdybAQd%2FamLG0Gza4tthcuOJw2FEgwM6%2FsALzRfCkchTI4StvvMuQlboVYHTHWWXgdFW7vVh%2BKdMoBPYqtXbV3S3%2BHkL2G1b11HePA17kEX%2FxLfqkd6UA9uW1aionzJBVG5aggTDKfHVcU2vTdag5gaFghrRS9a4%2BZdqINHAQLN7rnb8EbPEjGTJ6wVFBILF0n4gptQkzmjJFDcn191ewjFp4WC2hyTfjqZk0TP%2FTNgHWRa%2Fgp3Yb4NYcBbKuqUfWlvBz60VCJC1AYjWZExbFIZpEKTrxDG0jOjYNx7PCy0kxnNDsKgXIRMScuxqKOJTQoMLum58oGOqUB9sxhlPtAj6%2FCcET7VIoPbP3pidotclEtrKF2yawbYYW7GRfTyDeSl8uGUmln%2B7%2B6xnyFeJ7e08KeT3dCz2ogUzgUcHK3l6McEerg2cGzaiQgsNdbijnf99YqTWC%2BAcUzNpXM%2FGLxoiac4HiIZ4h8LSW4M8hg0B4yDOt5KRkxo7GLFQe5KEm2B1qBYJGQ%2FoQ%2FjbnCv5NUhI2%2BdUdCB3LzpXrdGlV%2B&X-Amz-Signature=413fb6e259f3d4df095071f7593342b0da53866923119328153ac812795059fd&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

