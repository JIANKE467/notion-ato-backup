
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466UXXYGIL7%2F20251207%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251207T040436Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjELf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDYnRV29a172%2FsR%2FARlXWA9jo5x2m0O6W%2Bo8%2FMLzE4ICQIgW%2F4ofEPGfUi9ED097NdQH0v%2FLcefZLh4I2Pn9K%2Bil9QqiAQIgP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDJZjq%2Bt3KbwxE7AACSrcA59vkzOhmQ4U2PNQY3Ajc7frrBIbi8wfrIMRoBV%2BqnK7tpyx1vRheMYpLfv1PFIWP7yVsCdh4yRSgRfQLX25tXxJI6GgPEqSzpfGnIZcX5bfQyhF7aZiVd%2FX46m6hC2DfdykJIy5rGjpEJombtRafDVUB2rqwAiAIyZvNFAx6pUuVv2S3qejeWdLom3%2BXxubz2INoOWD%2FhYeqUMrY2QeSYVUd0s6py%2BOdJAFn0Mtp%2BRuFO%2FoTKY8nkNvgUyDIpTat114iI6h8t9JaCLyDeF5E%2B%2BXCqJB0SfsQEqV62OvQ%2BX7RAVhy8H%2Fq%2Bwb0MYygwkZEwTXoqlrSeO7hyXCk2SBd6JiBvlCfUBTJM3nacTXHrre4PYVsFfNgYk58U2IlZzimcudJO4fl%2BbXdZejDyPm3XDXQ88x33r6siDIjfKXIpNOWB4O10fLUVOq7ee8bMfSNbO%2BywidBN6%2Fn7Z4BSIqrxHOTyptEL8h89Qw92aQ9n6V61anmezXKsTycielguOf3YT5q1Zb0DAkcN2j%2B3TfCDcmtOtan0gH0h7enHxoGwTaEvpKlvX0jQQdHAVS%2F7EOhcSXElSkTyzvj%2FnitP8%2BHz4kvkUQSfuPhW56%2BZR6coEN8HJA2YZX%2Fhwym2d%2FMNnq0skGOqUBDpkYxiHSj5ajYBgGBpzBkr%2FPrWx%2FDkGBckRdv2ov%2FG9GqMRvlzQgjiA7uMUeZO%2FJlMcJbZ1FZukmxbyQ4S7lrUjyU37Pb7tY5T0i%2F6y1HKVt2I%2FojozGZnx8uhyIaDP0YArJp6TvorV2BYtd2KrzvYoaINaNtRlg7%2BCFgaBeRJlIFOFRd90kjh5D1ItO3b%2B4JOhwlQPciyWiv5QORC2Kz%2FRIdMlv&X-Amz-Signature=b85e7e0dad928dc5f0881b94738b0584ffd14ab0495edd81682f976de032d1c5&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466UXXYGIL7%2F20251207%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251207T040436Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjELf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDYnRV29a172%2FsR%2FARlXWA9jo5x2m0O6W%2Bo8%2FMLzE4ICQIgW%2F4ofEPGfUi9ED097NdQH0v%2FLcefZLh4I2Pn9K%2Bil9QqiAQIgP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDJZjq%2Bt3KbwxE7AACSrcA59vkzOhmQ4U2PNQY3Ajc7frrBIbi8wfrIMRoBV%2BqnK7tpyx1vRheMYpLfv1PFIWP7yVsCdh4yRSgRfQLX25tXxJI6GgPEqSzpfGnIZcX5bfQyhF7aZiVd%2FX46m6hC2DfdykJIy5rGjpEJombtRafDVUB2rqwAiAIyZvNFAx6pUuVv2S3qejeWdLom3%2BXxubz2INoOWD%2FhYeqUMrY2QeSYVUd0s6py%2BOdJAFn0Mtp%2BRuFO%2FoTKY8nkNvgUyDIpTat114iI6h8t9JaCLyDeF5E%2B%2BXCqJB0SfsQEqV62OvQ%2BX7RAVhy8H%2Fq%2Bwb0MYygwkZEwTXoqlrSeO7hyXCk2SBd6JiBvlCfUBTJM3nacTXHrre4PYVsFfNgYk58U2IlZzimcudJO4fl%2BbXdZejDyPm3XDXQ88x33r6siDIjfKXIpNOWB4O10fLUVOq7ee8bMfSNbO%2BywidBN6%2Fn7Z4BSIqrxHOTyptEL8h89Qw92aQ9n6V61anmezXKsTycielguOf3YT5q1Zb0DAkcN2j%2B3TfCDcmtOtan0gH0h7enHxoGwTaEvpKlvX0jQQdHAVS%2F7EOhcSXElSkTyzvj%2FnitP8%2BHz4kvkUQSfuPhW56%2BZR6coEN8HJA2YZX%2Fhwym2d%2FMNnq0skGOqUBDpkYxiHSj5ajYBgGBpzBkr%2FPrWx%2FDkGBckRdv2ov%2FG9GqMRvlzQgjiA7uMUeZO%2FJlMcJbZ1FZukmxbyQ4S7lrUjyU37Pb7tY5T0i%2F6y1HKVt2I%2FojozGZnx8uhyIaDP0YArJp6TvorV2BYtd2KrzvYoaINaNtRlg7%2BCFgaBeRJlIFOFRd90kjh5D1ItO3b%2B4JOhwlQPciyWiv5QORC2Kz%2FRIdMlv&X-Amz-Signature=cd46d6a8384fd61984cff903196d95b54b9204b74fb65dbd29bbcf31169d449f&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466UXXYGIL7%2F20251207%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251207T040436Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjELf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDYnRV29a172%2FsR%2FARlXWA9jo5x2m0O6W%2Bo8%2FMLzE4ICQIgW%2F4ofEPGfUi9ED097NdQH0v%2FLcefZLh4I2Pn9K%2Bil9QqiAQIgP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDJZjq%2Bt3KbwxE7AACSrcA59vkzOhmQ4U2PNQY3Ajc7frrBIbi8wfrIMRoBV%2BqnK7tpyx1vRheMYpLfv1PFIWP7yVsCdh4yRSgRfQLX25tXxJI6GgPEqSzpfGnIZcX5bfQyhF7aZiVd%2FX46m6hC2DfdykJIy5rGjpEJombtRafDVUB2rqwAiAIyZvNFAx6pUuVv2S3qejeWdLom3%2BXxubz2INoOWD%2FhYeqUMrY2QeSYVUd0s6py%2BOdJAFn0Mtp%2BRuFO%2FoTKY8nkNvgUyDIpTat114iI6h8t9JaCLyDeF5E%2B%2BXCqJB0SfsQEqV62OvQ%2BX7RAVhy8H%2Fq%2Bwb0MYygwkZEwTXoqlrSeO7hyXCk2SBd6JiBvlCfUBTJM3nacTXHrre4PYVsFfNgYk58U2IlZzimcudJO4fl%2BbXdZejDyPm3XDXQ88x33r6siDIjfKXIpNOWB4O10fLUVOq7ee8bMfSNbO%2BywidBN6%2Fn7Z4BSIqrxHOTyptEL8h89Qw92aQ9n6V61anmezXKsTycielguOf3YT5q1Zb0DAkcN2j%2B3TfCDcmtOtan0gH0h7enHxoGwTaEvpKlvX0jQQdHAVS%2F7EOhcSXElSkTyzvj%2FnitP8%2BHz4kvkUQSfuPhW56%2BZR6coEN8HJA2YZX%2Fhwym2d%2FMNnq0skGOqUBDpkYxiHSj5ajYBgGBpzBkr%2FPrWx%2FDkGBckRdv2ov%2FG9GqMRvlzQgjiA7uMUeZO%2FJlMcJbZ1FZukmxbyQ4S7lrUjyU37Pb7tY5T0i%2F6y1HKVt2I%2FojozGZnx8uhyIaDP0YArJp6TvorV2BYtd2KrzvYoaINaNtRlg7%2BCFgaBeRJlIFOFRd90kjh5D1ItO3b%2B4JOhwlQPciyWiv5QORC2Kz%2FRIdMlv&X-Amz-Signature=41ce9760fb8a9b22e08e09a8a96b552a970a2ae65292484357b7e7a04b021810&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466UXXYGIL7%2F20251207%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251207T040436Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjELf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDYnRV29a172%2FsR%2FARlXWA9jo5x2m0O6W%2Bo8%2FMLzE4ICQIgW%2F4ofEPGfUi9ED097NdQH0v%2FLcefZLh4I2Pn9K%2Bil9QqiAQIgP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDJZjq%2Bt3KbwxE7AACSrcA59vkzOhmQ4U2PNQY3Ajc7frrBIbi8wfrIMRoBV%2BqnK7tpyx1vRheMYpLfv1PFIWP7yVsCdh4yRSgRfQLX25tXxJI6GgPEqSzpfGnIZcX5bfQyhF7aZiVd%2FX46m6hC2DfdykJIy5rGjpEJombtRafDVUB2rqwAiAIyZvNFAx6pUuVv2S3qejeWdLom3%2BXxubz2INoOWD%2FhYeqUMrY2QeSYVUd0s6py%2BOdJAFn0Mtp%2BRuFO%2FoTKY8nkNvgUyDIpTat114iI6h8t9JaCLyDeF5E%2B%2BXCqJB0SfsQEqV62OvQ%2BX7RAVhy8H%2Fq%2Bwb0MYygwkZEwTXoqlrSeO7hyXCk2SBd6JiBvlCfUBTJM3nacTXHrre4PYVsFfNgYk58U2IlZzimcudJO4fl%2BbXdZejDyPm3XDXQ88x33r6siDIjfKXIpNOWB4O10fLUVOq7ee8bMfSNbO%2BywidBN6%2Fn7Z4BSIqrxHOTyptEL8h89Qw92aQ9n6V61anmezXKsTycielguOf3YT5q1Zb0DAkcN2j%2B3TfCDcmtOtan0gH0h7enHxoGwTaEvpKlvX0jQQdHAVS%2F7EOhcSXElSkTyzvj%2FnitP8%2BHz4kvkUQSfuPhW56%2BZR6coEN8HJA2YZX%2Fhwym2d%2FMNnq0skGOqUBDpkYxiHSj5ajYBgGBpzBkr%2FPrWx%2FDkGBckRdv2ov%2FG9GqMRvlzQgjiA7uMUeZO%2FJlMcJbZ1FZukmxbyQ4S7lrUjyU37Pb7tY5T0i%2F6y1HKVt2I%2FojozGZnx8uhyIaDP0YArJp6TvorV2BYtd2KrzvYoaINaNtRlg7%2BCFgaBeRJlIFOFRd90kjh5D1ItO3b%2B4JOhwlQPciyWiv5QORC2Kz%2FRIdMlv&X-Amz-Signature=f6bdcea4c68f9b487e50e8f51a1001b0792d899119b35fb10a4e3760f73c9ba8&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

