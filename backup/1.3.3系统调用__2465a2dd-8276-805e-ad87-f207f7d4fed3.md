
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466R3G6J3PB%2F20251214%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251214T040817Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEGQaCXVzLXdlc3QtMiJHMEUCIQClfiJyVeWCRoUa9Ng0PCQhX4VADRQt4Td1EfG6bCyBlgIgeB71HVu8xMfCIHoR%2BUXYl%2FSTsud%2F%2FWi9Qp60DCOM2z0q%2FwMILRAAGgw2Mzc0MjMxODM4MDUiDFO08%2FWmI%2FhzvkjoayrcA7evrOD04vDq7GoFxfNFU1hs2FYdrbkH9%2BI4RZ3sRctk%2B1oU7FdQWvIEotOeJrIE76X%2FHpNUqXWRaurK6sG3wj6wKkhtBkLz%2BiV79w2fZw141gueMJrJOkuo%2BzU9vFSHIo3lVDJKYZlEiElB5vg2LHB1B9mJqZV9Luj10zf7MkyalaHuaKNxBg%2B134qVUMiPiwLclj8bB9BQat90vgLgEv49lICN6CUoh%2F21W7aFryN2qXCqstA07i7mqyBoQg6KQgjmdY3KUz0GO6kfdASDYDTzNIl5K8iOdNgs8tx6xg9ci%2FcUyHdeRnP3fk71cdL9dabNv08%2FRZuOzbr6It1kpzKlBmyn4GOTvUY0SKq%2FMmh4d4oV9sxama2mKMbRD49kru44NqdIazXlyrPJ4R5N9jRyKPKBaOtw7siwviKEnVQm9aB0IndRWXbcMQVKMWoEM%2BueIC2GgvneiDlO4WzIPrJcxb3yphQY96TZ9%2FM8EMPtRhSDDBYX%2FTuaYuD%2F6zth5zveF1aSKKY0X1YrggsB8F%2Bn7W179PgjKOmsMxPwyBkikDFrSIeXpnlxLHTKLbpcefP%2BWxlS9wSuR2cEQ%2F7rLVluFdXmtsC%2BqSshvq4NdE5jqMidOiDvugSD3km%2FML3c%2BMkGOqUB1VMOO9EIjRp%2FYEO0ugb7VLSCmTZLQHQie5nw1BV3olvlR%2F8ruF5s9XKCZs%2BY%2FAbzO6a%2BzSHRolRTaJ0PlO%2FOUEam4529YB75%2FUrWziI5%2Fq2KBkw%2F1cs1BhbpQAmn1R0Bg4J%2BGlyKcb%2Fe0QxxLz6Y%2Bsmo4EIFvSR2rXYuu3wlN1VzqtYANIP4lgGCecIHCD21VgrxDAAyUwD3nj8qoj8L1HW7Lazp&X-Amz-Signature=8f82172c31a5a49087b2f3caf541b9f24467c2fb59c9492929e50b5c83a4e5ed&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466R3G6J3PB%2F20251214%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251214T040817Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEGQaCXVzLXdlc3QtMiJHMEUCIQClfiJyVeWCRoUa9Ng0PCQhX4VADRQt4Td1EfG6bCyBlgIgeB71HVu8xMfCIHoR%2BUXYl%2FSTsud%2F%2FWi9Qp60DCOM2z0q%2FwMILRAAGgw2Mzc0MjMxODM4MDUiDFO08%2FWmI%2FhzvkjoayrcA7evrOD04vDq7GoFxfNFU1hs2FYdrbkH9%2BI4RZ3sRctk%2B1oU7FdQWvIEotOeJrIE76X%2FHpNUqXWRaurK6sG3wj6wKkhtBkLz%2BiV79w2fZw141gueMJrJOkuo%2BzU9vFSHIo3lVDJKYZlEiElB5vg2LHB1B9mJqZV9Luj10zf7MkyalaHuaKNxBg%2B134qVUMiPiwLclj8bB9BQat90vgLgEv49lICN6CUoh%2F21W7aFryN2qXCqstA07i7mqyBoQg6KQgjmdY3KUz0GO6kfdASDYDTzNIl5K8iOdNgs8tx6xg9ci%2FcUyHdeRnP3fk71cdL9dabNv08%2FRZuOzbr6It1kpzKlBmyn4GOTvUY0SKq%2FMmh4d4oV9sxama2mKMbRD49kru44NqdIazXlyrPJ4R5N9jRyKPKBaOtw7siwviKEnVQm9aB0IndRWXbcMQVKMWoEM%2BueIC2GgvneiDlO4WzIPrJcxb3yphQY96TZ9%2FM8EMPtRhSDDBYX%2FTuaYuD%2F6zth5zveF1aSKKY0X1YrggsB8F%2Bn7W179PgjKOmsMxPwyBkikDFrSIeXpnlxLHTKLbpcefP%2BWxlS9wSuR2cEQ%2F7rLVluFdXmtsC%2BqSshvq4NdE5jqMidOiDvugSD3km%2FML3c%2BMkGOqUB1VMOO9EIjRp%2FYEO0ugb7VLSCmTZLQHQie5nw1BV3olvlR%2F8ruF5s9XKCZs%2BY%2FAbzO6a%2BzSHRolRTaJ0PlO%2FOUEam4529YB75%2FUrWziI5%2Fq2KBkw%2F1cs1BhbpQAmn1R0Bg4J%2BGlyKcb%2Fe0QxxLz6Y%2Bsmo4EIFvSR2rXYuu3wlN1VzqtYANIP4lgGCecIHCD21VgrxDAAyUwD3nj8qoj8L1HW7Lazp&X-Amz-Signature=b953f6fec75ce25ba1d30ca0806c70a9a01959edaf91b423d16e553e467b8958&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466R3G6J3PB%2F20251214%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251214T040817Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEGQaCXVzLXdlc3QtMiJHMEUCIQClfiJyVeWCRoUa9Ng0PCQhX4VADRQt4Td1EfG6bCyBlgIgeB71HVu8xMfCIHoR%2BUXYl%2FSTsud%2F%2FWi9Qp60DCOM2z0q%2FwMILRAAGgw2Mzc0MjMxODM4MDUiDFO08%2FWmI%2FhzvkjoayrcA7evrOD04vDq7GoFxfNFU1hs2FYdrbkH9%2BI4RZ3sRctk%2B1oU7FdQWvIEotOeJrIE76X%2FHpNUqXWRaurK6sG3wj6wKkhtBkLz%2BiV79w2fZw141gueMJrJOkuo%2BzU9vFSHIo3lVDJKYZlEiElB5vg2LHB1B9mJqZV9Luj10zf7MkyalaHuaKNxBg%2B134qVUMiPiwLclj8bB9BQat90vgLgEv49lICN6CUoh%2F21W7aFryN2qXCqstA07i7mqyBoQg6KQgjmdY3KUz0GO6kfdASDYDTzNIl5K8iOdNgs8tx6xg9ci%2FcUyHdeRnP3fk71cdL9dabNv08%2FRZuOzbr6It1kpzKlBmyn4GOTvUY0SKq%2FMmh4d4oV9sxama2mKMbRD49kru44NqdIazXlyrPJ4R5N9jRyKPKBaOtw7siwviKEnVQm9aB0IndRWXbcMQVKMWoEM%2BueIC2GgvneiDlO4WzIPrJcxb3yphQY96TZ9%2FM8EMPtRhSDDBYX%2FTuaYuD%2F6zth5zveF1aSKKY0X1YrggsB8F%2Bn7W179PgjKOmsMxPwyBkikDFrSIeXpnlxLHTKLbpcefP%2BWxlS9wSuR2cEQ%2F7rLVluFdXmtsC%2BqSshvq4NdE5jqMidOiDvugSD3km%2FML3c%2BMkGOqUB1VMOO9EIjRp%2FYEO0ugb7VLSCmTZLQHQie5nw1BV3olvlR%2F8ruF5s9XKCZs%2BY%2FAbzO6a%2BzSHRolRTaJ0PlO%2FOUEam4529YB75%2FUrWziI5%2Fq2KBkw%2F1cs1BhbpQAmn1R0Bg4J%2BGlyKcb%2Fe0QxxLz6Y%2Bsmo4EIFvSR2rXYuu3wlN1VzqtYANIP4lgGCecIHCD21VgrxDAAyUwD3nj8qoj8L1HW7Lazp&X-Amz-Signature=ea882c53842b1eb675f85a07257eb6b086dab9cc3faf10708f73d2d52f61da69&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466R3G6J3PB%2F20251214%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251214T040817Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEGQaCXVzLXdlc3QtMiJHMEUCIQClfiJyVeWCRoUa9Ng0PCQhX4VADRQt4Td1EfG6bCyBlgIgeB71HVu8xMfCIHoR%2BUXYl%2FSTsud%2F%2FWi9Qp60DCOM2z0q%2FwMILRAAGgw2Mzc0MjMxODM4MDUiDFO08%2FWmI%2FhzvkjoayrcA7evrOD04vDq7GoFxfNFU1hs2FYdrbkH9%2BI4RZ3sRctk%2B1oU7FdQWvIEotOeJrIE76X%2FHpNUqXWRaurK6sG3wj6wKkhtBkLz%2BiV79w2fZw141gueMJrJOkuo%2BzU9vFSHIo3lVDJKYZlEiElB5vg2LHB1B9mJqZV9Luj10zf7MkyalaHuaKNxBg%2B134qVUMiPiwLclj8bB9BQat90vgLgEv49lICN6CUoh%2F21W7aFryN2qXCqstA07i7mqyBoQg6KQgjmdY3KUz0GO6kfdASDYDTzNIl5K8iOdNgs8tx6xg9ci%2FcUyHdeRnP3fk71cdL9dabNv08%2FRZuOzbr6It1kpzKlBmyn4GOTvUY0SKq%2FMmh4d4oV9sxama2mKMbRD49kru44NqdIazXlyrPJ4R5N9jRyKPKBaOtw7siwviKEnVQm9aB0IndRWXbcMQVKMWoEM%2BueIC2GgvneiDlO4WzIPrJcxb3yphQY96TZ9%2FM8EMPtRhSDDBYX%2FTuaYuD%2F6zth5zveF1aSKKY0X1YrggsB8F%2Bn7W179PgjKOmsMxPwyBkikDFrSIeXpnlxLHTKLbpcefP%2BWxlS9wSuR2cEQ%2F7rLVluFdXmtsC%2BqSshvq4NdE5jqMidOiDvugSD3km%2FML3c%2BMkGOqUB1VMOO9EIjRp%2FYEO0ugb7VLSCmTZLQHQie5nw1BV3olvlR%2F8ruF5s9XKCZs%2BY%2FAbzO6a%2BzSHRolRTaJ0PlO%2FOUEam4529YB75%2FUrWziI5%2Fq2KBkw%2F1cs1BhbpQAmn1R0Bg4J%2BGlyKcb%2Fe0QxxLz6Y%2Bsmo4EIFvSR2rXYuu3wlN1VzqtYANIP4lgGCecIHCD21VgrxDAAyUwD3nj8qoj8L1HW7Lazp&X-Amz-Signature=206b329eda6ae6388042a9f7d81dcd5b5af2258d2b52a4fa1c071e264df125f3&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

