
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466SMRIXRSU%2F20251223%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251223T040914Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEDwaCXVzLXdlc3QtMiJIMEYCIQDXZ6O1jBQDfpkbiABVnuOkq%2BR5hd6n9RMD1YkxzmxmSwIhALMBQx0hzo1ZGWzovDdTvdA53NtQoTWCM4srQsK3nFKJKv8DCAUQABoMNjM3NDIzMTgzODA1Igy34qnICBc5UShIB7wq3ANLM5P2f9l%2F5RQe%2BDaSnDWre%2Byq%2Fn00bXZCOjE7dEM8xlKJvNKVpWYMgJYRL83p9ltaMGjOiU1gHy28VqEQILE%2FGNWZJq335SsT17mMOkhsMdk78NMBkDwmGLysiPKorEP%2BXme%2FCICbllAcsI0%2BjFE6JQCG1nk99Gr6va61GLhpeGERNTC6H4M3%2Bw4FVp4ps%2BByEUnE8JUZHzU%2FAIsO83GartYK%2FY8noZlfmqjj5jzhv6T%2F2i8KE%2BO9qL6HFCa%2FyE%2B3hxYUYrlmHruOj7LhKhqMjs%2FuuBz%2F9CbHILLfPOwN5GCRaWKghSSSxIoYSQWbM%2F0irjDs4PBEi2YKWpr36aR9ULG%2BMj1VC%2FXkD31wB1K4NjRs1%2BxiRYlmyaAeWItC8I5p5sVq4XI05C9JFA9zGnG63i4Rj6G4UbIcq2haOxScHzdWHkcMEIkE0jbR0bM9SVocLadW%2FrqM%2BuysH55T0akZLhNd%2BAn%2BvT8WYc3rZ%2B09UxOyF96%2BDN5pPxcJn3pjszE161NcC3Ow5g7K8PrP5gB3K2W0nAUPhUZLYtUUtUTRHTXlZGruQDevxTkk5nLSawi1AnOvjXiWO0GtLfoIP2hAkLXYP8RtKMdDvOHxA75RCDBhD7Mg2Jn%2Ba9ILDDCmnqjKBjqkAdR63uiJpq7vTrogtn0YBPmZdD6XzzFgysdcbAa%2BQmXTHhUGZRSODWJkWPdPPOxB7ztDC2UlfxXbueseSvdFORbpEnLMo8rpnmKgxKh6SmHbNNrpaNiv8l2YylvpnsRxk9rRF4CGHInSTwgRAarIet%2B0PQ3pfYmbMqsb8lQav6ch%2BEx2Tyx9PTFS%2F1%2BDwDHb3pIDA%2FyewvvR498KNaQeh%2Bc05KQj&X-Amz-Signature=e2618f9e8de6e39bab38aea6ab0c61631a1b6a8f0789d938e74ecbc1389cad43&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466SMRIXRSU%2F20251223%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251223T040914Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEDwaCXVzLXdlc3QtMiJIMEYCIQDXZ6O1jBQDfpkbiABVnuOkq%2BR5hd6n9RMD1YkxzmxmSwIhALMBQx0hzo1ZGWzovDdTvdA53NtQoTWCM4srQsK3nFKJKv8DCAUQABoMNjM3NDIzMTgzODA1Igy34qnICBc5UShIB7wq3ANLM5P2f9l%2F5RQe%2BDaSnDWre%2Byq%2Fn00bXZCOjE7dEM8xlKJvNKVpWYMgJYRL83p9ltaMGjOiU1gHy28VqEQILE%2FGNWZJq335SsT17mMOkhsMdk78NMBkDwmGLysiPKorEP%2BXme%2FCICbllAcsI0%2BjFE6JQCG1nk99Gr6va61GLhpeGERNTC6H4M3%2Bw4FVp4ps%2BByEUnE8JUZHzU%2FAIsO83GartYK%2FY8noZlfmqjj5jzhv6T%2F2i8KE%2BO9qL6HFCa%2FyE%2B3hxYUYrlmHruOj7LhKhqMjs%2FuuBz%2F9CbHILLfPOwN5GCRaWKghSSSxIoYSQWbM%2F0irjDs4PBEi2YKWpr36aR9ULG%2BMj1VC%2FXkD31wB1K4NjRs1%2BxiRYlmyaAeWItC8I5p5sVq4XI05C9JFA9zGnG63i4Rj6G4UbIcq2haOxScHzdWHkcMEIkE0jbR0bM9SVocLadW%2FrqM%2BuysH55T0akZLhNd%2BAn%2BvT8WYc3rZ%2B09UxOyF96%2BDN5pPxcJn3pjszE161NcC3Ow5g7K8PrP5gB3K2W0nAUPhUZLYtUUtUTRHTXlZGruQDevxTkk5nLSawi1AnOvjXiWO0GtLfoIP2hAkLXYP8RtKMdDvOHxA75RCDBhD7Mg2Jn%2Ba9ILDDCmnqjKBjqkAdR63uiJpq7vTrogtn0YBPmZdD6XzzFgysdcbAa%2BQmXTHhUGZRSODWJkWPdPPOxB7ztDC2UlfxXbueseSvdFORbpEnLMo8rpnmKgxKh6SmHbNNrpaNiv8l2YylvpnsRxk9rRF4CGHInSTwgRAarIet%2B0PQ3pfYmbMqsb8lQav6ch%2BEx2Tyx9PTFS%2F1%2BDwDHb3pIDA%2FyewvvR498KNaQeh%2Bc05KQj&X-Amz-Signature=5a3447ad00f6037e160ffaf1caa153f08fcd43e46bea181bb4cfac8065e9fef8&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466SMRIXRSU%2F20251223%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251223T040914Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEDwaCXVzLXdlc3QtMiJIMEYCIQDXZ6O1jBQDfpkbiABVnuOkq%2BR5hd6n9RMD1YkxzmxmSwIhALMBQx0hzo1ZGWzovDdTvdA53NtQoTWCM4srQsK3nFKJKv8DCAUQABoMNjM3NDIzMTgzODA1Igy34qnICBc5UShIB7wq3ANLM5P2f9l%2F5RQe%2BDaSnDWre%2Byq%2Fn00bXZCOjE7dEM8xlKJvNKVpWYMgJYRL83p9ltaMGjOiU1gHy28VqEQILE%2FGNWZJq335SsT17mMOkhsMdk78NMBkDwmGLysiPKorEP%2BXme%2FCICbllAcsI0%2BjFE6JQCG1nk99Gr6va61GLhpeGERNTC6H4M3%2Bw4FVp4ps%2BByEUnE8JUZHzU%2FAIsO83GartYK%2FY8noZlfmqjj5jzhv6T%2F2i8KE%2BO9qL6HFCa%2FyE%2B3hxYUYrlmHruOj7LhKhqMjs%2FuuBz%2F9CbHILLfPOwN5GCRaWKghSSSxIoYSQWbM%2F0irjDs4PBEi2YKWpr36aR9ULG%2BMj1VC%2FXkD31wB1K4NjRs1%2BxiRYlmyaAeWItC8I5p5sVq4XI05C9JFA9zGnG63i4Rj6G4UbIcq2haOxScHzdWHkcMEIkE0jbR0bM9SVocLadW%2FrqM%2BuysH55T0akZLhNd%2BAn%2BvT8WYc3rZ%2B09UxOyF96%2BDN5pPxcJn3pjszE161NcC3Ow5g7K8PrP5gB3K2W0nAUPhUZLYtUUtUTRHTXlZGruQDevxTkk5nLSawi1AnOvjXiWO0GtLfoIP2hAkLXYP8RtKMdDvOHxA75RCDBhD7Mg2Jn%2Ba9ILDDCmnqjKBjqkAdR63uiJpq7vTrogtn0YBPmZdD6XzzFgysdcbAa%2BQmXTHhUGZRSODWJkWPdPPOxB7ztDC2UlfxXbueseSvdFORbpEnLMo8rpnmKgxKh6SmHbNNrpaNiv8l2YylvpnsRxk9rRF4CGHInSTwgRAarIet%2B0PQ3pfYmbMqsb8lQav6ch%2BEx2Tyx9PTFS%2F1%2BDwDHb3pIDA%2FyewvvR498KNaQeh%2Bc05KQj&X-Amz-Signature=df6297f816c1d8c4df77e5e55a5188d19074b3c60eb2c87e6cf1d48236147d52&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466SMRIXRSU%2F20251223%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251223T040914Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEDwaCXVzLXdlc3QtMiJIMEYCIQDXZ6O1jBQDfpkbiABVnuOkq%2BR5hd6n9RMD1YkxzmxmSwIhALMBQx0hzo1ZGWzovDdTvdA53NtQoTWCM4srQsK3nFKJKv8DCAUQABoMNjM3NDIzMTgzODA1Igy34qnICBc5UShIB7wq3ANLM5P2f9l%2F5RQe%2BDaSnDWre%2Byq%2Fn00bXZCOjE7dEM8xlKJvNKVpWYMgJYRL83p9ltaMGjOiU1gHy28VqEQILE%2FGNWZJq335SsT17mMOkhsMdk78NMBkDwmGLysiPKorEP%2BXme%2FCICbllAcsI0%2BjFE6JQCG1nk99Gr6va61GLhpeGERNTC6H4M3%2Bw4FVp4ps%2BByEUnE8JUZHzU%2FAIsO83GartYK%2FY8noZlfmqjj5jzhv6T%2F2i8KE%2BO9qL6HFCa%2FyE%2B3hxYUYrlmHruOj7LhKhqMjs%2FuuBz%2F9CbHILLfPOwN5GCRaWKghSSSxIoYSQWbM%2F0irjDs4PBEi2YKWpr36aR9ULG%2BMj1VC%2FXkD31wB1K4NjRs1%2BxiRYlmyaAeWItC8I5p5sVq4XI05C9JFA9zGnG63i4Rj6G4UbIcq2haOxScHzdWHkcMEIkE0jbR0bM9SVocLadW%2FrqM%2BuysH55T0akZLhNd%2BAn%2BvT8WYc3rZ%2B09UxOyF96%2BDN5pPxcJn3pjszE161NcC3Ow5g7K8PrP5gB3K2W0nAUPhUZLYtUUtUTRHTXlZGruQDevxTkk5nLSawi1AnOvjXiWO0GtLfoIP2hAkLXYP8RtKMdDvOHxA75RCDBhD7Mg2Jn%2Ba9ILDDCmnqjKBjqkAdR63uiJpq7vTrogtn0YBPmZdD6XzzFgysdcbAa%2BQmXTHhUGZRSODWJkWPdPPOxB7ztDC2UlfxXbueseSvdFORbpEnLMo8rpnmKgxKh6SmHbNNrpaNiv8l2YylvpnsRxk9rRF4CGHInSTwgRAarIet%2B0PQ3pfYmbMqsb8lQav6ch%2BEx2Tyx9PTFS%2F1%2BDwDHb3pIDA%2FyewvvR498KNaQeh%2Bc05KQj&X-Amz-Signature=6c1e9a0ae5c2759cf0bd30d6b62cc5b855b6a7e5ec9bc13c395849b1725a2cfc&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

