
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466ZXQ4KRQC%2F20251213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251213T035614Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEEwaCXVzLXdlc3QtMiJHMEUCIQDH4tiBuBFUpJXExMzQHfsOWXg75zluKBBrUhJc8r66WAIgJCH8ykuYc2YzqL0OX8e5yCC%2FDEL8ij9M5WE%2BfKhoQ%2Fkq%2FwMIFBAAGgw2Mzc0MjMxODM4MDUiDAPX4Kipktb3oX0UBCrcA7BjgBlf6eZIQ97CQ5LE%2Fu07DkdZ4kgnzVDHhQ56OdMSlAD%2Bayq2%2BoTHryV1BgZ2lj9TC%2F5ThY%2FTLgUAcXfdMLDSo2I%2FB26WLSG2505vxs1POZ0qpbbHr37IyQ2hcUJXL2%2F2D22ImAoFLat99V6F6KX%2B8UwyyBtsgg8TyXLWYXBlMUtWrmS%2BOQLHYKF56yV6kFecC3Qlmgr6iloleqD5G%2BQJIOp1eRxp4cBmDkZIIfp04zvNRs0L2TMojf2UKLmvyDtaSxBPNIAVTZByVNcDvi91iZ5Hf63mIz7gh%2BpamFNHUcN9e2iFr4vnkqimDdrgpn5j2aI1LW5kDveRFCrWaWdpj7Txzib9fGZMa7faqg40JALCMFQOw8MkrCfRDahmX1lw6%2BOcNgrNBOSHGLbqSh%2B%2BrmQ4RLZ8yRDz6CHMX2riHttG5jEXDBDFIl0Wi4J6D3jD%2FZaUzAKV8VHbfMm4WpbC%2BCZOTtphliO65rCrm6O%2BPcBilqYrbsehpDB6m2ZNzNOehEvsUIQIzm17ZyQ612Z2tQRTwRgVKCMbJoCz%2FpUe4Zvi1zSDHtpjUWrP1dw8h8A02760ZEnaIb6H7GI6qKue4mEfnstjwo8DaA%2BrSpqbcV9G5bIAYqrUiXCjMJ%2B488kGOqUBNoK%2B1C68zO9VswzWsINfH3Zm3iNXgmrThxm1U5ec%2Ba6LUm8ocI2V6FyRC4RLNBC7i67HQF%2B7WVS5F2AWPoe1VXGbE1pD84C302%2FCK4JRkhMO9zYl6dlOrpYjfCr1V6E%2BLTR%2BxCbIW0mq16lYJMNE1Gkv9j5kBM3%2FFXvktQ8Ivo4mIV7kgAJcD4J6cl8JPi5lY141nHnhYYy8pysUuxF%2FfVW2%2F41G&X-Amz-Signature=ff2fbf28ab741f5da9df94749a0b668b7613615ce8ba7b3ced6ceb3dbacd3e27&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466ZXQ4KRQC%2F20251213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251213T035614Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEEwaCXVzLXdlc3QtMiJHMEUCIQDH4tiBuBFUpJXExMzQHfsOWXg75zluKBBrUhJc8r66WAIgJCH8ykuYc2YzqL0OX8e5yCC%2FDEL8ij9M5WE%2BfKhoQ%2Fkq%2FwMIFBAAGgw2Mzc0MjMxODM4MDUiDAPX4Kipktb3oX0UBCrcA7BjgBlf6eZIQ97CQ5LE%2Fu07DkdZ4kgnzVDHhQ56OdMSlAD%2Bayq2%2BoTHryV1BgZ2lj9TC%2F5ThY%2FTLgUAcXfdMLDSo2I%2FB26WLSG2505vxs1POZ0qpbbHr37IyQ2hcUJXL2%2F2D22ImAoFLat99V6F6KX%2B8UwyyBtsgg8TyXLWYXBlMUtWrmS%2BOQLHYKF56yV6kFecC3Qlmgr6iloleqD5G%2BQJIOp1eRxp4cBmDkZIIfp04zvNRs0L2TMojf2UKLmvyDtaSxBPNIAVTZByVNcDvi91iZ5Hf63mIz7gh%2BpamFNHUcN9e2iFr4vnkqimDdrgpn5j2aI1LW5kDveRFCrWaWdpj7Txzib9fGZMa7faqg40JALCMFQOw8MkrCfRDahmX1lw6%2BOcNgrNBOSHGLbqSh%2B%2BrmQ4RLZ8yRDz6CHMX2riHttG5jEXDBDFIl0Wi4J6D3jD%2FZaUzAKV8VHbfMm4WpbC%2BCZOTtphliO65rCrm6O%2BPcBilqYrbsehpDB6m2ZNzNOehEvsUIQIzm17ZyQ612Z2tQRTwRgVKCMbJoCz%2FpUe4Zvi1zSDHtpjUWrP1dw8h8A02760ZEnaIb6H7GI6qKue4mEfnstjwo8DaA%2BrSpqbcV9G5bIAYqrUiXCjMJ%2B488kGOqUBNoK%2B1C68zO9VswzWsINfH3Zm3iNXgmrThxm1U5ec%2Ba6LUm8ocI2V6FyRC4RLNBC7i67HQF%2B7WVS5F2AWPoe1VXGbE1pD84C302%2FCK4JRkhMO9zYl6dlOrpYjfCr1V6E%2BLTR%2BxCbIW0mq16lYJMNE1Gkv9j5kBM3%2FFXvktQ8Ivo4mIV7kgAJcD4J6cl8JPi5lY141nHnhYYy8pysUuxF%2FfVW2%2F41G&X-Amz-Signature=8081418fe6d1b53316f34f4177127e33667aabbaad5a1e418beae7b782d6cb51&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466ZXQ4KRQC%2F20251213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251213T035614Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEEwaCXVzLXdlc3QtMiJHMEUCIQDH4tiBuBFUpJXExMzQHfsOWXg75zluKBBrUhJc8r66WAIgJCH8ykuYc2YzqL0OX8e5yCC%2FDEL8ij9M5WE%2BfKhoQ%2Fkq%2FwMIFBAAGgw2Mzc0MjMxODM4MDUiDAPX4Kipktb3oX0UBCrcA7BjgBlf6eZIQ97CQ5LE%2Fu07DkdZ4kgnzVDHhQ56OdMSlAD%2Bayq2%2BoTHryV1BgZ2lj9TC%2F5ThY%2FTLgUAcXfdMLDSo2I%2FB26WLSG2505vxs1POZ0qpbbHr37IyQ2hcUJXL2%2F2D22ImAoFLat99V6F6KX%2B8UwyyBtsgg8TyXLWYXBlMUtWrmS%2BOQLHYKF56yV6kFecC3Qlmgr6iloleqD5G%2BQJIOp1eRxp4cBmDkZIIfp04zvNRs0L2TMojf2UKLmvyDtaSxBPNIAVTZByVNcDvi91iZ5Hf63mIz7gh%2BpamFNHUcN9e2iFr4vnkqimDdrgpn5j2aI1LW5kDveRFCrWaWdpj7Txzib9fGZMa7faqg40JALCMFQOw8MkrCfRDahmX1lw6%2BOcNgrNBOSHGLbqSh%2B%2BrmQ4RLZ8yRDz6CHMX2riHttG5jEXDBDFIl0Wi4J6D3jD%2FZaUzAKV8VHbfMm4WpbC%2BCZOTtphliO65rCrm6O%2BPcBilqYrbsehpDB6m2ZNzNOehEvsUIQIzm17ZyQ612Z2tQRTwRgVKCMbJoCz%2FpUe4Zvi1zSDHtpjUWrP1dw8h8A02760ZEnaIb6H7GI6qKue4mEfnstjwo8DaA%2BrSpqbcV9G5bIAYqrUiXCjMJ%2B488kGOqUBNoK%2B1C68zO9VswzWsINfH3Zm3iNXgmrThxm1U5ec%2Ba6LUm8ocI2V6FyRC4RLNBC7i67HQF%2B7WVS5F2AWPoe1VXGbE1pD84C302%2FCK4JRkhMO9zYl6dlOrpYjfCr1V6E%2BLTR%2BxCbIW0mq16lYJMNE1Gkv9j5kBM3%2FFXvktQ8Ivo4mIV7kgAJcD4J6cl8JPi5lY141nHnhYYy8pysUuxF%2FfVW2%2F41G&X-Amz-Signature=7422ca8566724f805f0ff8d480878ffcf1cc644f2681ced41b06a273d8a4f2a7&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466ZXQ4KRQC%2F20251213%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251213T035614Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEEwaCXVzLXdlc3QtMiJHMEUCIQDH4tiBuBFUpJXExMzQHfsOWXg75zluKBBrUhJc8r66WAIgJCH8ykuYc2YzqL0OX8e5yCC%2FDEL8ij9M5WE%2BfKhoQ%2Fkq%2FwMIFBAAGgw2Mzc0MjMxODM4MDUiDAPX4Kipktb3oX0UBCrcA7BjgBlf6eZIQ97CQ5LE%2Fu07DkdZ4kgnzVDHhQ56OdMSlAD%2Bayq2%2BoTHryV1BgZ2lj9TC%2F5ThY%2FTLgUAcXfdMLDSo2I%2FB26WLSG2505vxs1POZ0qpbbHr37IyQ2hcUJXL2%2F2D22ImAoFLat99V6F6KX%2B8UwyyBtsgg8TyXLWYXBlMUtWrmS%2BOQLHYKF56yV6kFecC3Qlmgr6iloleqD5G%2BQJIOp1eRxp4cBmDkZIIfp04zvNRs0L2TMojf2UKLmvyDtaSxBPNIAVTZByVNcDvi91iZ5Hf63mIz7gh%2BpamFNHUcN9e2iFr4vnkqimDdrgpn5j2aI1LW5kDveRFCrWaWdpj7Txzib9fGZMa7faqg40JALCMFQOw8MkrCfRDahmX1lw6%2BOcNgrNBOSHGLbqSh%2B%2BrmQ4RLZ8yRDz6CHMX2riHttG5jEXDBDFIl0Wi4J6D3jD%2FZaUzAKV8VHbfMm4WpbC%2BCZOTtphliO65rCrm6O%2BPcBilqYrbsehpDB6m2ZNzNOehEvsUIQIzm17ZyQ612Z2tQRTwRgVKCMbJoCz%2FpUe4Zvi1zSDHtpjUWrP1dw8h8A02760ZEnaIb6H7GI6qKue4mEfnstjwo8DaA%2BrSpqbcV9G5bIAYqrUiXCjMJ%2B488kGOqUBNoK%2B1C68zO9VswzWsINfH3Zm3iNXgmrThxm1U5ec%2Ba6LUm8ocI2V6FyRC4RLNBC7i67HQF%2B7WVS5F2AWPoe1VXGbE1pD84C302%2FCK4JRkhMO9zYl6dlOrpYjfCr1V6E%2BLTR%2BxCbIW0mq16lYJMNE1Gkv9j5kBM3%2FFXvktQ8Ivo4mIV7kgAJcD4J6cl8JPi5lY141nHnhYYy8pysUuxF%2FfVW2%2F41G&X-Amz-Signature=86ab601aa0a43ec8f225fd33ac4fa4a22f8e388a89b9216caa36c1e1a9a3af06&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

