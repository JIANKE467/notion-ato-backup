
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4663PMRZ3MJ%2F20251209%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251209T035951Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEOz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIGhObRkgaK2GoyfkQ92mFsuLkGEapJVQpk7SnZkgjUHqAiEA2maiO7DcH6GI0ruyAMyc9qNtZfUr1onUjXU9Fn0A15oqiAQItf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDCIYXIBIcKrv7%2BMt8SrcA81OfnDHMX4IC2YMPIZe6Hw0RoEQ5B4I81BngOpKZa%2BGPWCxhCpQbGlD2AmGTQ8fXzyUp2xZWDJ8FWr9fXnU%2BIouf4rXD9Ack7FjMM3v5NtHZwafQIPlBt7i%2ByggWw2bjSwq8fv8kYMmSAWHGdcbKLHPdGe9kaEB3x31d6sFvZi8SRlArjR2YzT89LP9sGXk6Z0NcncW1YGg%2Bq02BmL4Xp9oA76108v2Xs0Y9Duh%2FfpOy%2B2s2F%2FDOfKLr49wWA%2B6XuyMJm9y2TqZlSV%2BuGoAuxXw0hVQcIprx%2B86cZnwXoGQ8k%2BwfakP29JSaf%2FZKae3QFaRV0PmvIhYpUlg7jykiFy3pn6Yw%2B95zNUrwzoLLGQctNVCbrlkPOwVSdUg48bEKcmsqWOsZ2FOnxtIuFbMMDCHoRBPaRp68Keg8ZM2GBKl%2FB9PJg1wOxgblygn5VhC%2FSNdPmNLxVYo51MK9qhyRWixoIx4EAv5fZzK4WxF3VX20fXIkFRdCgH3LlnNpDAsEh7yFEH74dSGqXHsKIPbAYGAOaMCLVtkCa2iV8Un4CPBeL2etNdmwGmgHE7KKGx3%2FFCXVMxKtfD5GoTbfNtLBzKRuuDy%2B%2F9IiDGKO7ZZH5rIma981AEALfAPV%2BnQMIa33skGOqUBmDE6g4VDBmj61spyat5QeKdRIl0TTGVQttgLjOLyuUvrI1McqwoaL0el1wrI6L3NyXIPR3W9xNj8ZrWdNMOkRf5CLiV8jpHF0%2BoA%2F19rQt5h%2BRs%2FdiU2KMur7fm268x8%2Bn6SZXXXY00yTcdZabhY%2BQEd4auJEeGV%2FFI4yWqKx3VwYeDOMq%2Fl31gJzoDNqGixvxdf3FiihxOuJfr3TYvQGWqUR9j9&X-Amz-Signature=b7a3840fabd7573af03467c25a25ec2cfc81a156424350be33133b7c5e6fe269&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4663PMRZ3MJ%2F20251209%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251209T035951Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEOz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIGhObRkgaK2GoyfkQ92mFsuLkGEapJVQpk7SnZkgjUHqAiEA2maiO7DcH6GI0ruyAMyc9qNtZfUr1onUjXU9Fn0A15oqiAQItf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDCIYXIBIcKrv7%2BMt8SrcA81OfnDHMX4IC2YMPIZe6Hw0RoEQ5B4I81BngOpKZa%2BGPWCxhCpQbGlD2AmGTQ8fXzyUp2xZWDJ8FWr9fXnU%2BIouf4rXD9Ack7FjMM3v5NtHZwafQIPlBt7i%2ByggWw2bjSwq8fv8kYMmSAWHGdcbKLHPdGe9kaEB3x31d6sFvZi8SRlArjR2YzT89LP9sGXk6Z0NcncW1YGg%2Bq02BmL4Xp9oA76108v2Xs0Y9Duh%2FfpOy%2B2s2F%2FDOfKLr49wWA%2B6XuyMJm9y2TqZlSV%2BuGoAuxXw0hVQcIprx%2B86cZnwXoGQ8k%2BwfakP29JSaf%2FZKae3QFaRV0PmvIhYpUlg7jykiFy3pn6Yw%2B95zNUrwzoLLGQctNVCbrlkPOwVSdUg48bEKcmsqWOsZ2FOnxtIuFbMMDCHoRBPaRp68Keg8ZM2GBKl%2FB9PJg1wOxgblygn5VhC%2FSNdPmNLxVYo51MK9qhyRWixoIx4EAv5fZzK4WxF3VX20fXIkFRdCgH3LlnNpDAsEh7yFEH74dSGqXHsKIPbAYGAOaMCLVtkCa2iV8Un4CPBeL2etNdmwGmgHE7KKGx3%2FFCXVMxKtfD5GoTbfNtLBzKRuuDy%2B%2F9IiDGKO7ZZH5rIma981AEALfAPV%2BnQMIa33skGOqUBmDE6g4VDBmj61spyat5QeKdRIl0TTGVQttgLjOLyuUvrI1McqwoaL0el1wrI6L3NyXIPR3W9xNj8ZrWdNMOkRf5CLiV8jpHF0%2BoA%2F19rQt5h%2BRs%2FdiU2KMur7fm268x8%2Bn6SZXXXY00yTcdZabhY%2BQEd4auJEeGV%2FFI4yWqKx3VwYeDOMq%2Fl31gJzoDNqGixvxdf3FiihxOuJfr3TYvQGWqUR9j9&X-Amz-Signature=0f010c2bd98bda43c66b9f4aa37f3d7a7930f4412f9547202b28bf773a47ac7e&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4663PMRZ3MJ%2F20251209%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251209T035951Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEOz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIGhObRkgaK2GoyfkQ92mFsuLkGEapJVQpk7SnZkgjUHqAiEA2maiO7DcH6GI0ruyAMyc9qNtZfUr1onUjXU9Fn0A15oqiAQItf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDCIYXIBIcKrv7%2BMt8SrcA81OfnDHMX4IC2YMPIZe6Hw0RoEQ5B4I81BngOpKZa%2BGPWCxhCpQbGlD2AmGTQ8fXzyUp2xZWDJ8FWr9fXnU%2BIouf4rXD9Ack7FjMM3v5NtHZwafQIPlBt7i%2ByggWw2bjSwq8fv8kYMmSAWHGdcbKLHPdGe9kaEB3x31d6sFvZi8SRlArjR2YzT89LP9sGXk6Z0NcncW1YGg%2Bq02BmL4Xp9oA76108v2Xs0Y9Duh%2FfpOy%2B2s2F%2FDOfKLr49wWA%2B6XuyMJm9y2TqZlSV%2BuGoAuxXw0hVQcIprx%2B86cZnwXoGQ8k%2BwfakP29JSaf%2FZKae3QFaRV0PmvIhYpUlg7jykiFy3pn6Yw%2B95zNUrwzoLLGQctNVCbrlkPOwVSdUg48bEKcmsqWOsZ2FOnxtIuFbMMDCHoRBPaRp68Keg8ZM2GBKl%2FB9PJg1wOxgblygn5VhC%2FSNdPmNLxVYo51MK9qhyRWixoIx4EAv5fZzK4WxF3VX20fXIkFRdCgH3LlnNpDAsEh7yFEH74dSGqXHsKIPbAYGAOaMCLVtkCa2iV8Un4CPBeL2etNdmwGmgHE7KKGx3%2FFCXVMxKtfD5GoTbfNtLBzKRuuDy%2B%2F9IiDGKO7ZZH5rIma981AEALfAPV%2BnQMIa33skGOqUBmDE6g4VDBmj61spyat5QeKdRIl0TTGVQttgLjOLyuUvrI1McqwoaL0el1wrI6L3NyXIPR3W9xNj8ZrWdNMOkRf5CLiV8jpHF0%2BoA%2F19rQt5h%2BRs%2FdiU2KMur7fm268x8%2Bn6SZXXXY00yTcdZabhY%2BQEd4auJEeGV%2FFI4yWqKx3VwYeDOMq%2Fl31gJzoDNqGixvxdf3FiihxOuJfr3TYvQGWqUR9j9&X-Amz-Signature=1886a9fb18652b4e5f985eb7bb63a402b49afc8e9e33279d86a9df299ebe44e4&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4663PMRZ3MJ%2F20251209%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251209T035951Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEOz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIGhObRkgaK2GoyfkQ92mFsuLkGEapJVQpk7SnZkgjUHqAiEA2maiO7DcH6GI0ruyAMyc9qNtZfUr1onUjXU9Fn0A15oqiAQItf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDCIYXIBIcKrv7%2BMt8SrcA81OfnDHMX4IC2YMPIZe6Hw0RoEQ5B4I81BngOpKZa%2BGPWCxhCpQbGlD2AmGTQ8fXzyUp2xZWDJ8FWr9fXnU%2BIouf4rXD9Ack7FjMM3v5NtHZwafQIPlBt7i%2ByggWw2bjSwq8fv8kYMmSAWHGdcbKLHPdGe9kaEB3x31d6sFvZi8SRlArjR2YzT89LP9sGXk6Z0NcncW1YGg%2Bq02BmL4Xp9oA76108v2Xs0Y9Duh%2FfpOy%2B2s2F%2FDOfKLr49wWA%2B6XuyMJm9y2TqZlSV%2BuGoAuxXw0hVQcIprx%2B86cZnwXoGQ8k%2BwfakP29JSaf%2FZKae3QFaRV0PmvIhYpUlg7jykiFy3pn6Yw%2B95zNUrwzoLLGQctNVCbrlkPOwVSdUg48bEKcmsqWOsZ2FOnxtIuFbMMDCHoRBPaRp68Keg8ZM2GBKl%2FB9PJg1wOxgblygn5VhC%2FSNdPmNLxVYo51MK9qhyRWixoIx4EAv5fZzK4WxF3VX20fXIkFRdCgH3LlnNpDAsEh7yFEH74dSGqXHsKIPbAYGAOaMCLVtkCa2iV8Un4CPBeL2etNdmwGmgHE7KKGx3%2FFCXVMxKtfD5GoTbfNtLBzKRuuDy%2B%2F9IiDGKO7ZZH5rIma981AEALfAPV%2BnQMIa33skGOqUBmDE6g4VDBmj61spyat5QeKdRIl0TTGVQttgLjOLyuUvrI1McqwoaL0el1wrI6L3NyXIPR3W9xNj8ZrWdNMOkRf5CLiV8jpHF0%2BoA%2F19rQt5h%2BRs%2FdiU2KMur7fm268x8%2Bn6SZXXXY00yTcdZabhY%2BQEd4auJEeGV%2FFI4yWqKx3VwYeDOMq%2Fl31gJzoDNqGixvxdf3FiihxOuJfr3TYvQGWqUR9j9&X-Amz-Signature=3a0c24a885f95bd2718e85c93045ae3b191d70a19777568d3e6e2c608737afc5&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

