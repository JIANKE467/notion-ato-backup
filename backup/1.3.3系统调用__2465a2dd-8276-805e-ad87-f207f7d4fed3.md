
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4667HC2IIV2%2F20251217%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251217T040317Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDN2Q69EuZM1DIcH9Sb%2FLrUJOfBScjIOyjZP8y9%2B0hvFQIgWXhOUJ5s1OyR5pGnN2pRWADbIqQnKiABG787zdM6Lwsq%2FwMIdBAAGgw2Mzc0MjMxODM4MDUiDM4w3qnqYmm8NxeCvyrcA%2FSjK1Sy4ovVmlzEoPJMEIVNrfzgMSEAb8hA6%2BI6nAOmxt8MO7I4oPWaYPZD84mvelDQ%2BrwAXrER9sW1sWyrdgaD7RdmPsfR%2BcQajvjuJJbllh83NaO5P6LNM4KziHjGbExBW1VQP%2Fs5kzXjuLOI2vo8QH3MlrnFNbpyzCjz%2FS%2F1ZPbF%2BcGnZOX%2FsPGlCJWOROKsjziwH4j9GpmcdVZJDuGR%2FLY%2BjFu1cHPwWHCDXXhUdLH8GqoDnCezg6v%2B6mENNWlDotAx7jFd5iUaE7%2BDyexh7z9%2FNLjjIpGu3K4A038k8Ga2UiDjn5WclO5G6IjQR1ckHvchUdjKaoUqepZ8TCgffD8Nu2N%2BKzmECkiLQDq45dxZ5yhurpL%2B1TajPv4FIY5I7JJbnsN20E%2BL6N7dBQiJclbnhF5mJPnkf6E%2BXhYp6xd5luvrib15jdn5JzIoep5FTz7SyHJOSJhD4j%2BCtTn3RK3QIbx8jJEqMVwTceTr6EOmNI%2BtmsYP93fScodMPpalxiNLInljqR1tAlk4b7PNCAG%2FxJ%2FN6KranNfGZj%2BctnfBSndMUvQghYI%2FtiEjtAauMF2amwJl3AyDIwIaeVhanPpDa5yVIRHBITULVRLxVs%2BPD9D5thFv9M%2BRMMG8iMoGOqUBqNCnSXXf8r1ShGbS5WXChLEDoYV%2F7HBSXaO4J7RykjFSom7MBUGX%2B6tZLPj%2Fn3aAIvf2qMVCMfigaRXnCVCa0jM%2Bt9ZQnt2j8rFCunxsNn63%2FTTO1KUmyt4eBFkUBneFFfB1HRJYHcogDdQuEm9Ho3cuyXrP%2FSq2xV%2FrkH3o6OCnDZfrtQyQGTl%2BqO8w9VgoLJY02yM9gtFfowr%2BB60WKu77kaqf&X-Amz-Signature=f1d4cb1821e8fbf6444fde2608ccc60041bec6b2a454038125a32083fe3ea755&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4667HC2IIV2%2F20251217%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251217T040317Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDN2Q69EuZM1DIcH9Sb%2FLrUJOfBScjIOyjZP8y9%2B0hvFQIgWXhOUJ5s1OyR5pGnN2pRWADbIqQnKiABG787zdM6Lwsq%2FwMIdBAAGgw2Mzc0MjMxODM4MDUiDM4w3qnqYmm8NxeCvyrcA%2FSjK1Sy4ovVmlzEoPJMEIVNrfzgMSEAb8hA6%2BI6nAOmxt8MO7I4oPWaYPZD84mvelDQ%2BrwAXrER9sW1sWyrdgaD7RdmPsfR%2BcQajvjuJJbllh83NaO5P6LNM4KziHjGbExBW1VQP%2Fs5kzXjuLOI2vo8QH3MlrnFNbpyzCjz%2FS%2F1ZPbF%2BcGnZOX%2FsPGlCJWOROKsjziwH4j9GpmcdVZJDuGR%2FLY%2BjFu1cHPwWHCDXXhUdLH8GqoDnCezg6v%2B6mENNWlDotAx7jFd5iUaE7%2BDyexh7z9%2FNLjjIpGu3K4A038k8Ga2UiDjn5WclO5G6IjQR1ckHvchUdjKaoUqepZ8TCgffD8Nu2N%2BKzmECkiLQDq45dxZ5yhurpL%2B1TajPv4FIY5I7JJbnsN20E%2BL6N7dBQiJclbnhF5mJPnkf6E%2BXhYp6xd5luvrib15jdn5JzIoep5FTz7SyHJOSJhD4j%2BCtTn3RK3QIbx8jJEqMVwTceTr6EOmNI%2BtmsYP93fScodMPpalxiNLInljqR1tAlk4b7PNCAG%2FxJ%2FN6KranNfGZj%2BctnfBSndMUvQghYI%2FtiEjtAauMF2amwJl3AyDIwIaeVhanPpDa5yVIRHBITULVRLxVs%2BPD9D5thFv9M%2BRMMG8iMoGOqUBqNCnSXXf8r1ShGbS5WXChLEDoYV%2F7HBSXaO4J7RykjFSom7MBUGX%2B6tZLPj%2Fn3aAIvf2qMVCMfigaRXnCVCa0jM%2Bt9ZQnt2j8rFCunxsNn63%2FTTO1KUmyt4eBFkUBneFFfB1HRJYHcogDdQuEm9Ho3cuyXrP%2FSq2xV%2FrkH3o6OCnDZfrtQyQGTl%2BqO8w9VgoLJY02yM9gtFfowr%2BB60WKu77kaqf&X-Amz-Signature=1a21c1a182dd15c540aaf176d9a60a90809ba4dfcae1924a3348a128b2569be1&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4667HC2IIV2%2F20251217%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251217T040317Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDN2Q69EuZM1DIcH9Sb%2FLrUJOfBScjIOyjZP8y9%2B0hvFQIgWXhOUJ5s1OyR5pGnN2pRWADbIqQnKiABG787zdM6Lwsq%2FwMIdBAAGgw2Mzc0MjMxODM4MDUiDM4w3qnqYmm8NxeCvyrcA%2FSjK1Sy4ovVmlzEoPJMEIVNrfzgMSEAb8hA6%2BI6nAOmxt8MO7I4oPWaYPZD84mvelDQ%2BrwAXrER9sW1sWyrdgaD7RdmPsfR%2BcQajvjuJJbllh83NaO5P6LNM4KziHjGbExBW1VQP%2Fs5kzXjuLOI2vo8QH3MlrnFNbpyzCjz%2FS%2F1ZPbF%2BcGnZOX%2FsPGlCJWOROKsjziwH4j9GpmcdVZJDuGR%2FLY%2BjFu1cHPwWHCDXXhUdLH8GqoDnCezg6v%2B6mENNWlDotAx7jFd5iUaE7%2BDyexh7z9%2FNLjjIpGu3K4A038k8Ga2UiDjn5WclO5G6IjQR1ckHvchUdjKaoUqepZ8TCgffD8Nu2N%2BKzmECkiLQDq45dxZ5yhurpL%2B1TajPv4FIY5I7JJbnsN20E%2BL6N7dBQiJclbnhF5mJPnkf6E%2BXhYp6xd5luvrib15jdn5JzIoep5FTz7SyHJOSJhD4j%2BCtTn3RK3QIbx8jJEqMVwTceTr6EOmNI%2BtmsYP93fScodMPpalxiNLInljqR1tAlk4b7PNCAG%2FxJ%2FN6KranNfGZj%2BctnfBSndMUvQghYI%2FtiEjtAauMF2amwJl3AyDIwIaeVhanPpDa5yVIRHBITULVRLxVs%2BPD9D5thFv9M%2BRMMG8iMoGOqUBqNCnSXXf8r1ShGbS5WXChLEDoYV%2F7HBSXaO4J7RykjFSom7MBUGX%2B6tZLPj%2Fn3aAIvf2qMVCMfigaRXnCVCa0jM%2Bt9ZQnt2j8rFCunxsNn63%2FTTO1KUmyt4eBFkUBneFFfB1HRJYHcogDdQuEm9Ho3cuyXrP%2FSq2xV%2FrkH3o6OCnDZfrtQyQGTl%2BqO8w9VgoLJY02yM9gtFfowr%2BB60WKu77kaqf&X-Amz-Signature=21c5a91aacb1ed85885934f2c159c3d7b31f079babf5a2ec3a3c82b7ebcc8c59&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4667HC2IIV2%2F20251217%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251217T040317Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDN2Q69EuZM1DIcH9Sb%2FLrUJOfBScjIOyjZP8y9%2B0hvFQIgWXhOUJ5s1OyR5pGnN2pRWADbIqQnKiABG787zdM6Lwsq%2FwMIdBAAGgw2Mzc0MjMxODM4MDUiDM4w3qnqYmm8NxeCvyrcA%2FSjK1Sy4ovVmlzEoPJMEIVNrfzgMSEAb8hA6%2BI6nAOmxt8MO7I4oPWaYPZD84mvelDQ%2BrwAXrER9sW1sWyrdgaD7RdmPsfR%2BcQajvjuJJbllh83NaO5P6LNM4KziHjGbExBW1VQP%2Fs5kzXjuLOI2vo8QH3MlrnFNbpyzCjz%2FS%2F1ZPbF%2BcGnZOX%2FsPGlCJWOROKsjziwH4j9GpmcdVZJDuGR%2FLY%2BjFu1cHPwWHCDXXhUdLH8GqoDnCezg6v%2B6mENNWlDotAx7jFd5iUaE7%2BDyexh7z9%2FNLjjIpGu3K4A038k8Ga2UiDjn5WclO5G6IjQR1ckHvchUdjKaoUqepZ8TCgffD8Nu2N%2BKzmECkiLQDq45dxZ5yhurpL%2B1TajPv4FIY5I7JJbnsN20E%2BL6N7dBQiJclbnhF5mJPnkf6E%2BXhYp6xd5luvrib15jdn5JzIoep5FTz7SyHJOSJhD4j%2BCtTn3RK3QIbx8jJEqMVwTceTr6EOmNI%2BtmsYP93fScodMPpalxiNLInljqR1tAlk4b7PNCAG%2FxJ%2FN6KranNfGZj%2BctnfBSndMUvQghYI%2FtiEjtAauMF2amwJl3AyDIwIaeVhanPpDa5yVIRHBITULVRLxVs%2BPD9D5thFv9M%2BRMMG8iMoGOqUBqNCnSXXf8r1ShGbS5WXChLEDoYV%2F7HBSXaO4J7RykjFSom7MBUGX%2B6tZLPj%2Fn3aAIvf2qMVCMfigaRXnCVCa0jM%2Bt9ZQnt2j8rFCunxsNn63%2FTTO1KUmyt4eBFkUBneFFfB1HRJYHcogDdQuEm9Ho3cuyXrP%2FSq2xV%2FrkH3o6OCnDZfrtQyQGTl%2BqO8w9VgoLJY02yM9gtFfowr%2BB60WKu77kaqf&X-Amz-Signature=15ede3dff62000f84eb2e728dec44e22211e8c9bea869a59dbb91ae33eb3033f&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

