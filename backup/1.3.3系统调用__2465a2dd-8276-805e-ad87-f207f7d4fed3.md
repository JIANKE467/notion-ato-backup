
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466TNW7PD57%2F20251218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251218T040428Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEMT%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQC5OQmVSbDWkHt5KwgdQKxrXdqfpMcmKYsO%2BxE0rTtv7gIgI%2B3Dh%2BzshpmRm6fj2bGHsZsljun8LfZFymj957bqTkwqiAQIjf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDK4K0mGGIIvUb0gHrSrcA4OsdHropsSrQdvkag%2BJjnjziZrqwWDMLg52YfnuIYjK%2Bxuh1ANliA3OyLaEzu8XTVAaD%2Bcb1ybcvYvOAeuCdoTQ6KsWLr5bglfsrpwR0H5nAtjsMlatJwOtMH2nzL1CIneqYwWrRRqCYmL1OXr%2FQCsSNIejkxJm41cFCb%2BBVaKrTs8YR6OUrjxM3QI8OPeQcDljZbZTu9M9qwEJbOFOhhfv3bBsz0%2BUVpqjJCW5RaNs837wnCPHIayIVd5bc3yyyh8btF9ne8WwAZPahk12Encp4MZWsTIP%2BSjwXEnAn0vylM3yQouEfwYUjOWjklYx6F9J1kfTE5aN3Kv1Bhu2lgCMv4sEbUn222m5dvC%2FVLb30VIgOBfi23XlxjTTyKDZ5U4Yq56Dn2buOTSRoWwNzdlLO2JDFXgm%2ByV2zMas6Lh%2BYXM80Y9Qbe2Eli2flpN0QT%2F%2F5DfUT43TMzaeZsV5QEn%2By6jSOvOK04zDT9f4qvmD1MsYEGmBIilUP41jQM9dQqrtqM1Iblw961im7WrxdFAkAhpS47WGUH3JtFq9KHqdmSd2Xm9yRot29BvQ2Q7jgyweM5iTF3ur45FWGDXIIwsX9C0hT9xsDffkgqvqVQ6WEpK7XOcbxDjZsN5BMLTwjcoGOqUBuyLx5f%2BWzfawCWbB1fqgYkWQBVPRbgT3nXDC7l81jrlA74bPapPZDfiA5ZJNP8IpUHOK1OK%2BooEXJTrxdAzj%2FGSfFDDcf1YAFqRrIFn%2BJ534EiGPoxOj496s9uZsfs7QvDVEpaJNu6gPNy%2BL1HlVI2hFZhQoFrQL7xqPY%2B3DswbiWjORIWhGyusF8CwzqrWn7ZVOukBNheIY97W2%2FA4asVRViIwa&X-Amz-Signature=e869d422cc919a64465147cf6ddbb14e7e1a3ce24b456f40c306aed15bf0874a&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466TNW7PD57%2F20251218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251218T040428Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEMT%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQC5OQmVSbDWkHt5KwgdQKxrXdqfpMcmKYsO%2BxE0rTtv7gIgI%2B3Dh%2BzshpmRm6fj2bGHsZsljun8LfZFymj957bqTkwqiAQIjf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDK4K0mGGIIvUb0gHrSrcA4OsdHropsSrQdvkag%2BJjnjziZrqwWDMLg52YfnuIYjK%2Bxuh1ANliA3OyLaEzu8XTVAaD%2Bcb1ybcvYvOAeuCdoTQ6KsWLr5bglfsrpwR0H5nAtjsMlatJwOtMH2nzL1CIneqYwWrRRqCYmL1OXr%2FQCsSNIejkxJm41cFCb%2BBVaKrTs8YR6OUrjxM3QI8OPeQcDljZbZTu9M9qwEJbOFOhhfv3bBsz0%2BUVpqjJCW5RaNs837wnCPHIayIVd5bc3yyyh8btF9ne8WwAZPahk12Encp4MZWsTIP%2BSjwXEnAn0vylM3yQouEfwYUjOWjklYx6F9J1kfTE5aN3Kv1Bhu2lgCMv4sEbUn222m5dvC%2FVLb30VIgOBfi23XlxjTTyKDZ5U4Yq56Dn2buOTSRoWwNzdlLO2JDFXgm%2ByV2zMas6Lh%2BYXM80Y9Qbe2Eli2flpN0QT%2F%2F5DfUT43TMzaeZsV5QEn%2By6jSOvOK04zDT9f4qvmD1MsYEGmBIilUP41jQM9dQqrtqM1Iblw961im7WrxdFAkAhpS47WGUH3JtFq9KHqdmSd2Xm9yRot29BvQ2Q7jgyweM5iTF3ur45FWGDXIIwsX9C0hT9xsDffkgqvqVQ6WEpK7XOcbxDjZsN5BMLTwjcoGOqUBuyLx5f%2BWzfawCWbB1fqgYkWQBVPRbgT3nXDC7l81jrlA74bPapPZDfiA5ZJNP8IpUHOK1OK%2BooEXJTrxdAzj%2FGSfFDDcf1YAFqRrIFn%2BJ534EiGPoxOj496s9uZsfs7QvDVEpaJNu6gPNy%2BL1HlVI2hFZhQoFrQL7xqPY%2B3DswbiWjORIWhGyusF8CwzqrWn7ZVOukBNheIY97W2%2FA4asVRViIwa&X-Amz-Signature=ea4f8133eff556c39f446e5ee51cc2abdfeefcf37902d9af8d9c97e7dabcfc05&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466TNW7PD57%2F20251218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251218T040428Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEMT%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQC5OQmVSbDWkHt5KwgdQKxrXdqfpMcmKYsO%2BxE0rTtv7gIgI%2B3Dh%2BzshpmRm6fj2bGHsZsljun8LfZFymj957bqTkwqiAQIjf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDK4K0mGGIIvUb0gHrSrcA4OsdHropsSrQdvkag%2BJjnjziZrqwWDMLg52YfnuIYjK%2Bxuh1ANliA3OyLaEzu8XTVAaD%2Bcb1ybcvYvOAeuCdoTQ6KsWLr5bglfsrpwR0H5nAtjsMlatJwOtMH2nzL1CIneqYwWrRRqCYmL1OXr%2FQCsSNIejkxJm41cFCb%2BBVaKrTs8YR6OUrjxM3QI8OPeQcDljZbZTu9M9qwEJbOFOhhfv3bBsz0%2BUVpqjJCW5RaNs837wnCPHIayIVd5bc3yyyh8btF9ne8WwAZPahk12Encp4MZWsTIP%2BSjwXEnAn0vylM3yQouEfwYUjOWjklYx6F9J1kfTE5aN3Kv1Bhu2lgCMv4sEbUn222m5dvC%2FVLb30VIgOBfi23XlxjTTyKDZ5U4Yq56Dn2buOTSRoWwNzdlLO2JDFXgm%2ByV2zMas6Lh%2BYXM80Y9Qbe2Eli2flpN0QT%2F%2F5DfUT43TMzaeZsV5QEn%2By6jSOvOK04zDT9f4qvmD1MsYEGmBIilUP41jQM9dQqrtqM1Iblw961im7WrxdFAkAhpS47WGUH3JtFq9KHqdmSd2Xm9yRot29BvQ2Q7jgyweM5iTF3ur45FWGDXIIwsX9C0hT9xsDffkgqvqVQ6WEpK7XOcbxDjZsN5BMLTwjcoGOqUBuyLx5f%2BWzfawCWbB1fqgYkWQBVPRbgT3nXDC7l81jrlA74bPapPZDfiA5ZJNP8IpUHOK1OK%2BooEXJTrxdAzj%2FGSfFDDcf1YAFqRrIFn%2BJ534EiGPoxOj496s9uZsfs7QvDVEpaJNu6gPNy%2BL1HlVI2hFZhQoFrQL7xqPY%2B3DswbiWjORIWhGyusF8CwzqrWn7ZVOukBNheIY97W2%2FA4asVRViIwa&X-Amz-Signature=ad18a83dba7bba1116f3b2f36b0a6c8659d841aa5c26fa8ed297457186156a16&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466TNW7PD57%2F20251218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251218T040428Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEMT%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQC5OQmVSbDWkHt5KwgdQKxrXdqfpMcmKYsO%2BxE0rTtv7gIgI%2B3Dh%2BzshpmRm6fj2bGHsZsljun8LfZFymj957bqTkwqiAQIjf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDK4K0mGGIIvUb0gHrSrcA4OsdHropsSrQdvkag%2BJjnjziZrqwWDMLg52YfnuIYjK%2Bxuh1ANliA3OyLaEzu8XTVAaD%2Bcb1ybcvYvOAeuCdoTQ6KsWLr5bglfsrpwR0H5nAtjsMlatJwOtMH2nzL1CIneqYwWrRRqCYmL1OXr%2FQCsSNIejkxJm41cFCb%2BBVaKrTs8YR6OUrjxM3QI8OPeQcDljZbZTu9M9qwEJbOFOhhfv3bBsz0%2BUVpqjJCW5RaNs837wnCPHIayIVd5bc3yyyh8btF9ne8WwAZPahk12Encp4MZWsTIP%2BSjwXEnAn0vylM3yQouEfwYUjOWjklYx6F9J1kfTE5aN3Kv1Bhu2lgCMv4sEbUn222m5dvC%2FVLb30VIgOBfi23XlxjTTyKDZ5U4Yq56Dn2buOTSRoWwNzdlLO2JDFXgm%2ByV2zMas6Lh%2BYXM80Y9Qbe2Eli2flpN0QT%2F%2F5DfUT43TMzaeZsV5QEn%2By6jSOvOK04zDT9f4qvmD1MsYEGmBIilUP41jQM9dQqrtqM1Iblw961im7WrxdFAkAhpS47WGUH3JtFq9KHqdmSd2Xm9yRot29BvQ2Q7jgyweM5iTF3ur45FWGDXIIwsX9C0hT9xsDffkgqvqVQ6WEpK7XOcbxDjZsN5BMLTwjcoGOqUBuyLx5f%2BWzfawCWbB1fqgYkWQBVPRbgT3nXDC7l81jrlA74bPapPZDfiA5ZJNP8IpUHOK1OK%2BooEXJTrxdAzj%2FGSfFDDcf1YAFqRrIFn%2BJ534EiGPoxOj496s9uZsfs7QvDVEpaJNu6gPNy%2BL1HlVI2hFZhQoFrQL7xqPY%2B3DswbiWjORIWhGyusF8CwzqrWn7ZVOukBNheIY97W2%2FA4asVRViIwa&X-Amz-Signature=46ff96831a7deb06fe64ad9b29f82319e9d758b55aedfd956e84b436186dbfef&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

