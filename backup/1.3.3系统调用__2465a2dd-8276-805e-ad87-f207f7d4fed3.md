
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466ZP6KUCCO%2F20251226%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251226T040754Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEIH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCKzOKkWCy4A0W2dhcymb6ZMSBVLxqhgCgkkecjnv%2BnFAIgFX0rEMWHQ4A5%2F4iJpkcdybeyMWbz6x2mhYNowFWbmjgq%2FwMIShAAGgw2Mzc0MjMxODM4MDUiDJj6oM0rR9IAEFuOgyrcA18EkemWa2pQA2kk4ebGy1AAXWw8jnBReIpCET%2FdFzskZ1a4jD6q3TCHA%2BMAULD7SqfwsazeHS7eRDfN9yp09WpD%2BJZsCCxOiiHf7rGWAvqFo9VW34Bw%2BYu5S84%2BpqlHT1uTvoFZ%2ByQnP4IboQYbRaP%2FMogoQRdkdVKhD0AONcb4RIUiso8MmiS6oy8cqZmNRZWvszUJS1al0BD%2FtqjcdZonFh6yhj07iXEPr5R3kKfsstGWTQv5zIV25ulBF4DxsylSlaQQ%2FvHw%2BrTxpZ5DhXvMrI7RAIkEb9z256p7utO5Di92hirpnd1cztG3keUQxVYBnXm75Z0M4G0Np4Rj%2Bj9UjUzt%2F%2F%2BsObro1EC99%2BkFgJzsO7w21ganRJDS1dOovwmZTZvrus50yMS9%2B5e5JPzcqAdUJh174NrBG7WSKgPyEgLsLsHZ8TP5X%2BdO5GUOqyfO8jh5b7jus1KkIEENYYAb6zuzB2lZEs3mRcG661SEnVg2TY5p7z5ZW7tARF0xYrXlz%2Fc3TqQZKOh7l8I%2FIQVzHRJlYuBXVhnB7tHdoRXi3pJZILxjSwg81YSNuSxWAKjcezd5S9tQoCXkkReZ8n5hhvnd8HGf6Pl3mFJzEONE1c5PKGFCujp%2FBNxJMPi%2Ft8oGOqUBdW3yhdAvyJ9TZBzMg%2Bg5Noqcht4xcfqhKz5JavBqCp4mXuCCU%2BJXZ65MMU3ezvhdpO1zXw4ZilQmHrCmbUHZ1j3RjhWanItMdL5ikycqjhIg1rHR3wts%2FdFwZzaCGGLddS7CqBnZmeguzs0mfoWjXhhvbytPRc4Aci0j5s4MXmIOcTWcLckZ3UnhxqDm0AeqgzvgFgas%2FyamT7lc9kQ6eGoH%2FLyP&X-Amz-Signature=dc47433001d499ec4b91024ad869d9e17b41eadf8325b3f11423ba0c54ce0583&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466ZP6KUCCO%2F20251226%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251226T040754Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEIH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCKzOKkWCy4A0W2dhcymb6ZMSBVLxqhgCgkkecjnv%2BnFAIgFX0rEMWHQ4A5%2F4iJpkcdybeyMWbz6x2mhYNowFWbmjgq%2FwMIShAAGgw2Mzc0MjMxODM4MDUiDJj6oM0rR9IAEFuOgyrcA18EkemWa2pQA2kk4ebGy1AAXWw8jnBReIpCET%2FdFzskZ1a4jD6q3TCHA%2BMAULD7SqfwsazeHS7eRDfN9yp09WpD%2BJZsCCxOiiHf7rGWAvqFo9VW34Bw%2BYu5S84%2BpqlHT1uTvoFZ%2ByQnP4IboQYbRaP%2FMogoQRdkdVKhD0AONcb4RIUiso8MmiS6oy8cqZmNRZWvszUJS1al0BD%2FtqjcdZonFh6yhj07iXEPr5R3kKfsstGWTQv5zIV25ulBF4DxsylSlaQQ%2FvHw%2BrTxpZ5DhXvMrI7RAIkEb9z256p7utO5Di92hirpnd1cztG3keUQxVYBnXm75Z0M4G0Np4Rj%2Bj9UjUzt%2F%2F%2BsObro1EC99%2BkFgJzsO7w21ganRJDS1dOovwmZTZvrus50yMS9%2B5e5JPzcqAdUJh174NrBG7WSKgPyEgLsLsHZ8TP5X%2BdO5GUOqyfO8jh5b7jus1KkIEENYYAb6zuzB2lZEs3mRcG661SEnVg2TY5p7z5ZW7tARF0xYrXlz%2Fc3TqQZKOh7l8I%2FIQVzHRJlYuBXVhnB7tHdoRXi3pJZILxjSwg81YSNuSxWAKjcezd5S9tQoCXkkReZ8n5hhvnd8HGf6Pl3mFJzEONE1c5PKGFCujp%2FBNxJMPi%2Ft8oGOqUBdW3yhdAvyJ9TZBzMg%2Bg5Noqcht4xcfqhKz5JavBqCp4mXuCCU%2BJXZ65MMU3ezvhdpO1zXw4ZilQmHrCmbUHZ1j3RjhWanItMdL5ikycqjhIg1rHR3wts%2FdFwZzaCGGLddS7CqBnZmeguzs0mfoWjXhhvbytPRc4Aci0j5s4MXmIOcTWcLckZ3UnhxqDm0AeqgzvgFgas%2FyamT7lc9kQ6eGoH%2FLyP&X-Amz-Signature=9022d5ee6df2c17deb6826b993ebd89da73e304403b29e83ad2dbdad636e15fa&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466ZP6KUCCO%2F20251226%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251226T040754Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEIH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCKzOKkWCy4A0W2dhcymb6ZMSBVLxqhgCgkkecjnv%2BnFAIgFX0rEMWHQ4A5%2F4iJpkcdybeyMWbz6x2mhYNowFWbmjgq%2FwMIShAAGgw2Mzc0MjMxODM4MDUiDJj6oM0rR9IAEFuOgyrcA18EkemWa2pQA2kk4ebGy1AAXWw8jnBReIpCET%2FdFzskZ1a4jD6q3TCHA%2BMAULD7SqfwsazeHS7eRDfN9yp09WpD%2BJZsCCxOiiHf7rGWAvqFo9VW34Bw%2BYu5S84%2BpqlHT1uTvoFZ%2ByQnP4IboQYbRaP%2FMogoQRdkdVKhD0AONcb4RIUiso8MmiS6oy8cqZmNRZWvszUJS1al0BD%2FtqjcdZonFh6yhj07iXEPr5R3kKfsstGWTQv5zIV25ulBF4DxsylSlaQQ%2FvHw%2BrTxpZ5DhXvMrI7RAIkEb9z256p7utO5Di92hirpnd1cztG3keUQxVYBnXm75Z0M4G0Np4Rj%2Bj9UjUzt%2F%2F%2BsObro1EC99%2BkFgJzsO7w21ganRJDS1dOovwmZTZvrus50yMS9%2B5e5JPzcqAdUJh174NrBG7WSKgPyEgLsLsHZ8TP5X%2BdO5GUOqyfO8jh5b7jus1KkIEENYYAb6zuzB2lZEs3mRcG661SEnVg2TY5p7z5ZW7tARF0xYrXlz%2Fc3TqQZKOh7l8I%2FIQVzHRJlYuBXVhnB7tHdoRXi3pJZILxjSwg81YSNuSxWAKjcezd5S9tQoCXkkReZ8n5hhvnd8HGf6Pl3mFJzEONE1c5PKGFCujp%2FBNxJMPi%2Ft8oGOqUBdW3yhdAvyJ9TZBzMg%2Bg5Noqcht4xcfqhKz5JavBqCp4mXuCCU%2BJXZ65MMU3ezvhdpO1zXw4ZilQmHrCmbUHZ1j3RjhWanItMdL5ikycqjhIg1rHR3wts%2FdFwZzaCGGLddS7CqBnZmeguzs0mfoWjXhhvbytPRc4Aci0j5s4MXmIOcTWcLckZ3UnhxqDm0AeqgzvgFgas%2FyamT7lc9kQ6eGoH%2FLyP&X-Amz-Signature=d04078031e5039df126e3fdabe1745815c4f37ce5adeac774f46acd0b1551af0&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466ZP6KUCCO%2F20251226%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251226T040754Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEIH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCKzOKkWCy4A0W2dhcymb6ZMSBVLxqhgCgkkecjnv%2BnFAIgFX0rEMWHQ4A5%2F4iJpkcdybeyMWbz6x2mhYNowFWbmjgq%2FwMIShAAGgw2Mzc0MjMxODM4MDUiDJj6oM0rR9IAEFuOgyrcA18EkemWa2pQA2kk4ebGy1AAXWw8jnBReIpCET%2FdFzskZ1a4jD6q3TCHA%2BMAULD7SqfwsazeHS7eRDfN9yp09WpD%2BJZsCCxOiiHf7rGWAvqFo9VW34Bw%2BYu5S84%2BpqlHT1uTvoFZ%2ByQnP4IboQYbRaP%2FMogoQRdkdVKhD0AONcb4RIUiso8MmiS6oy8cqZmNRZWvszUJS1al0BD%2FtqjcdZonFh6yhj07iXEPr5R3kKfsstGWTQv5zIV25ulBF4DxsylSlaQQ%2FvHw%2BrTxpZ5DhXvMrI7RAIkEb9z256p7utO5Di92hirpnd1cztG3keUQxVYBnXm75Z0M4G0Np4Rj%2Bj9UjUzt%2F%2F%2BsObro1EC99%2BkFgJzsO7w21ganRJDS1dOovwmZTZvrus50yMS9%2B5e5JPzcqAdUJh174NrBG7WSKgPyEgLsLsHZ8TP5X%2BdO5GUOqyfO8jh5b7jus1KkIEENYYAb6zuzB2lZEs3mRcG661SEnVg2TY5p7z5ZW7tARF0xYrXlz%2Fc3TqQZKOh7l8I%2FIQVzHRJlYuBXVhnB7tHdoRXi3pJZILxjSwg81YSNuSxWAKjcezd5S9tQoCXkkReZ8n5hhvnd8HGf6Pl3mFJzEONE1c5PKGFCujp%2FBNxJMPi%2Ft8oGOqUBdW3yhdAvyJ9TZBzMg%2Bg5Noqcht4xcfqhKz5JavBqCp4mXuCCU%2BJXZ65MMU3ezvhdpO1zXw4ZilQmHrCmbUHZ1j3RjhWanItMdL5ikycqjhIg1rHR3wts%2FdFwZzaCGGLddS7CqBnZmeguzs0mfoWjXhhvbytPRc4Aci0j5s4MXmIOcTWcLckZ3UnhxqDm0AeqgzvgFgas%2FyamT7lc9kQ6eGoH%2FLyP&X-Amz-Signature=6f27d34171d914e9cf1ce41b0386b8f00e3535b4fe4cd3fd21304409cc935b7f&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

