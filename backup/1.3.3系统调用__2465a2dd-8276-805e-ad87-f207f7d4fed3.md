
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466UZS4RDJT%2F20260120%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260120T041814Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjENz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDBzAExZMtN5QSi7KH8c3QYElsAu%2FCcLgxcKAoHj2y9GQIgRs%2FnSMfMvkGj9c3rHb%2FKt3mIemm3QOhFiFmIOJDzG68qiAQIpf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDPK%2BURriKRi7vGUnsyrcA%2FuNhsiIZGuk8WLY0ERFZjJO1i%2FUjzN348eDbixOhue%2BOKZ5beVnXaKEh8hpHJ45OOeqATsKnprhOInSiVCCGHMotuGoQjcfPh7fGCq0fD%2BODgd%2BxXKKg%2F3UxNeR2P8UlFr2A7LQzyvsmmA83jc%2FPo6dq4pYnBISlvqSAWpJiNfcHR%2FJsVUVq3ECJjQ6oXaXPBobcD7JmGXS2WvI6u6rsSJ2PQ9NdYDHImbln7hQ8CW4WrZLDdfg8nOpvGnHAzfddde2Qv%2FX811cpGEDwCaurPhiSQr46NNm5o8wxKw%2BK%2BRHJ3He%2F%2BwQp1Sfs0tz93BBWhr6ejfydG6LHM7Y2wR12O0NMmwxhtmH%2FRI5yK6%2BXIc1Vu7f%2FekDMOTDPBp7dO0rjqTv7MfGKkbncsltFAUG3w9av6V%2Frukb5mf2tGRnkd0OLRAKgj31XFiI%2FyIrcyaH7ta6UK2y83GminPxN5i7XatT3cPBnMUn7jtqMGQ5knCsaD5E0aZTU9yK%2BxFZmx0jkj2HyIzAyZWAISWoCRyisQlvhhLE5oC4fMEwtIgqZwc9kLv2pG85SGdrO5adTsZQ9EgRynHR3iftSDEFU%2BuGSwWsUgYKmud8yJJLlGAwpjwUym0%2FG5B3WtNNzuYlMI74u8sGOqUBX0Iy2CSpFzyh1zZSSuktKR5wzbx%2FwgOD9UcYl4gKQ609WlShSbipsnORjIIo4lnbCv1xgO19g5UOiwKgNkJ%2F3DWvRGC2Jv3r%2BQZn8C3Qb972u0UdMGv9UEK3l6cCniQqemICAQyO1rnSTpMCqs4QQICKH%2BxLd%2Fyi3ObGyFWQpBacys%2FOYzw7ejq%2Fssqs49J0f6DFTsP4aSq3fQNiMbbUqbh2v60s&X-Amz-Signature=a038843cc22fd9f1d99cd65c2198f443f5da88203533d922d23c530cd768dceb&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466UZS4RDJT%2F20260120%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260120T041814Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjENz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDBzAExZMtN5QSi7KH8c3QYElsAu%2FCcLgxcKAoHj2y9GQIgRs%2FnSMfMvkGj9c3rHb%2FKt3mIemm3QOhFiFmIOJDzG68qiAQIpf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDPK%2BURriKRi7vGUnsyrcA%2FuNhsiIZGuk8WLY0ERFZjJO1i%2FUjzN348eDbixOhue%2BOKZ5beVnXaKEh8hpHJ45OOeqATsKnprhOInSiVCCGHMotuGoQjcfPh7fGCq0fD%2BODgd%2BxXKKg%2F3UxNeR2P8UlFr2A7LQzyvsmmA83jc%2FPo6dq4pYnBISlvqSAWpJiNfcHR%2FJsVUVq3ECJjQ6oXaXPBobcD7JmGXS2WvI6u6rsSJ2PQ9NdYDHImbln7hQ8CW4WrZLDdfg8nOpvGnHAzfddde2Qv%2FX811cpGEDwCaurPhiSQr46NNm5o8wxKw%2BK%2BRHJ3He%2F%2BwQp1Sfs0tz93BBWhr6ejfydG6LHM7Y2wR12O0NMmwxhtmH%2FRI5yK6%2BXIc1Vu7f%2FekDMOTDPBp7dO0rjqTv7MfGKkbncsltFAUG3w9av6V%2Frukb5mf2tGRnkd0OLRAKgj31XFiI%2FyIrcyaH7ta6UK2y83GminPxN5i7XatT3cPBnMUn7jtqMGQ5knCsaD5E0aZTU9yK%2BxFZmx0jkj2HyIzAyZWAISWoCRyisQlvhhLE5oC4fMEwtIgqZwc9kLv2pG85SGdrO5adTsZQ9EgRynHR3iftSDEFU%2BuGSwWsUgYKmud8yJJLlGAwpjwUym0%2FG5B3WtNNzuYlMI74u8sGOqUBX0Iy2CSpFzyh1zZSSuktKR5wzbx%2FwgOD9UcYl4gKQ609WlShSbipsnORjIIo4lnbCv1xgO19g5UOiwKgNkJ%2F3DWvRGC2Jv3r%2BQZn8C3Qb972u0UdMGv9UEK3l6cCniQqemICAQyO1rnSTpMCqs4QQICKH%2BxLd%2Fyi3ObGyFWQpBacys%2FOYzw7ejq%2Fssqs49J0f6DFTsP4aSq3fQNiMbbUqbh2v60s&X-Amz-Signature=d430897b93efe8e5441dc41835f755cdbc45e829aa476d83da1a3aee418b979a&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466UZS4RDJT%2F20260120%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260120T041814Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjENz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDBzAExZMtN5QSi7KH8c3QYElsAu%2FCcLgxcKAoHj2y9GQIgRs%2FnSMfMvkGj9c3rHb%2FKt3mIemm3QOhFiFmIOJDzG68qiAQIpf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDPK%2BURriKRi7vGUnsyrcA%2FuNhsiIZGuk8WLY0ERFZjJO1i%2FUjzN348eDbixOhue%2BOKZ5beVnXaKEh8hpHJ45OOeqATsKnprhOInSiVCCGHMotuGoQjcfPh7fGCq0fD%2BODgd%2BxXKKg%2F3UxNeR2P8UlFr2A7LQzyvsmmA83jc%2FPo6dq4pYnBISlvqSAWpJiNfcHR%2FJsVUVq3ECJjQ6oXaXPBobcD7JmGXS2WvI6u6rsSJ2PQ9NdYDHImbln7hQ8CW4WrZLDdfg8nOpvGnHAzfddde2Qv%2FX811cpGEDwCaurPhiSQr46NNm5o8wxKw%2BK%2BRHJ3He%2F%2BwQp1Sfs0tz93BBWhr6ejfydG6LHM7Y2wR12O0NMmwxhtmH%2FRI5yK6%2BXIc1Vu7f%2FekDMOTDPBp7dO0rjqTv7MfGKkbncsltFAUG3w9av6V%2Frukb5mf2tGRnkd0OLRAKgj31XFiI%2FyIrcyaH7ta6UK2y83GminPxN5i7XatT3cPBnMUn7jtqMGQ5knCsaD5E0aZTU9yK%2BxFZmx0jkj2HyIzAyZWAISWoCRyisQlvhhLE5oC4fMEwtIgqZwc9kLv2pG85SGdrO5adTsZQ9EgRynHR3iftSDEFU%2BuGSwWsUgYKmud8yJJLlGAwpjwUym0%2FG5B3WtNNzuYlMI74u8sGOqUBX0Iy2CSpFzyh1zZSSuktKR5wzbx%2FwgOD9UcYl4gKQ609WlShSbipsnORjIIo4lnbCv1xgO19g5UOiwKgNkJ%2F3DWvRGC2Jv3r%2BQZn8C3Qb972u0UdMGv9UEK3l6cCniQqemICAQyO1rnSTpMCqs4QQICKH%2BxLd%2Fyi3ObGyFWQpBacys%2FOYzw7ejq%2Fssqs49J0f6DFTsP4aSq3fQNiMbbUqbh2v60s&X-Amz-Signature=309b355fbebef4b626d1ae229a2e1018c9ed7ad12ef97d021c5fc5111d943010&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466UZS4RDJT%2F20260120%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260120T041814Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjENz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDBzAExZMtN5QSi7KH8c3QYElsAu%2FCcLgxcKAoHj2y9GQIgRs%2FnSMfMvkGj9c3rHb%2FKt3mIemm3QOhFiFmIOJDzG68qiAQIpf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDPK%2BURriKRi7vGUnsyrcA%2FuNhsiIZGuk8WLY0ERFZjJO1i%2FUjzN348eDbixOhue%2BOKZ5beVnXaKEh8hpHJ45OOeqATsKnprhOInSiVCCGHMotuGoQjcfPh7fGCq0fD%2BODgd%2BxXKKg%2F3UxNeR2P8UlFr2A7LQzyvsmmA83jc%2FPo6dq4pYnBISlvqSAWpJiNfcHR%2FJsVUVq3ECJjQ6oXaXPBobcD7JmGXS2WvI6u6rsSJ2PQ9NdYDHImbln7hQ8CW4WrZLDdfg8nOpvGnHAzfddde2Qv%2FX811cpGEDwCaurPhiSQr46NNm5o8wxKw%2BK%2BRHJ3He%2F%2BwQp1Sfs0tz93BBWhr6ejfydG6LHM7Y2wR12O0NMmwxhtmH%2FRI5yK6%2BXIc1Vu7f%2FekDMOTDPBp7dO0rjqTv7MfGKkbncsltFAUG3w9av6V%2Frukb5mf2tGRnkd0OLRAKgj31XFiI%2FyIrcyaH7ta6UK2y83GminPxN5i7XatT3cPBnMUn7jtqMGQ5knCsaD5E0aZTU9yK%2BxFZmx0jkj2HyIzAyZWAISWoCRyisQlvhhLE5oC4fMEwtIgqZwc9kLv2pG85SGdrO5adTsZQ9EgRynHR3iftSDEFU%2BuGSwWsUgYKmud8yJJLlGAwpjwUym0%2FG5B3WtNNzuYlMI74u8sGOqUBX0Iy2CSpFzyh1zZSSuktKR5wzbx%2FwgOD9UcYl4gKQ609WlShSbipsnORjIIo4lnbCv1xgO19g5UOiwKgNkJ%2F3DWvRGC2Jv3r%2BQZn8C3Qb972u0UdMGv9UEK3l6cCniQqemICAQyO1rnSTpMCqs4QQICKH%2BxLd%2Fyi3ObGyFWQpBacys%2FOYzw7ejq%2Fssqs49J0f6DFTsP4aSq3fQNiMbbUqbh2v60s&X-Amz-Signature=5adf9a0b9a2e7a8a498f4e7da8ab05a71bb7e7e604f03fc593ce892af4c2ad03&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

