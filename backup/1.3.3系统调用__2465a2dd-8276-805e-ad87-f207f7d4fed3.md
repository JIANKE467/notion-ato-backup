
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4663DJJIULX%2F20251220%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251220T035612Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEPP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQC7MgBgv2DxW2SohqU3aD%2FiR5%2BUfrKq02ifadDOHeVnzgIhAPlYMSDJXEHvHu4GtUs74B%2FOjM0rIaxzjT7T46kQ6PHjKogECLz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1IgzGSNMYCYGVY%2BPT81Qq3AM%2Fy7ob%2BD%2B68WZo3buA4QgwOv0k%2FDSpHZCq8KhYRNNooaRmNL%2BQkSGjj0zXpQX%2BzXDQySpUnzP5%2FeXzcjYki6ojf1QUcVJI7D9q%2FmhgcqeXRvS80KqqaRwreJoRi18XXdQ2n2XuW3lLxte1L2q24ACS0xNjOALMIQ0dlBbo7Uh9Hp5D6HhibvcnOAHR8l10LTnU3xZMxfxZoL7jlc2CWvR5f5%2BD7knCyINZIK0vreTJszj3u4U3I2UUqm8NCyXywKOeRRxnQTHhjaRXWqZEE3OP3QL0PqMP5sPN%2FocBlHEyjpG%2F3jD7XpES0STr0VQDkvylLQ47zDL2ebOPvbC5GVN4Y8HUBFauBlL8WJCPAKgNj1CDofxXjwlVVmD2urHdpS9W%2Biok2I%2FdupqTX8Of%2F7IXdRMTeatwMPqz4xwHn8J2OMIrxJQHm3IbU5MqBe6yAdY8pAg7Vmei15haZImISaUXgAO6BQRhtTKE3P%2BkaHXy9LxQwHBrFU88KccNidXZB8vEHcE2QGsmBtOPpp66iZyGNcZ7%2Bqb8wF52QTTpP6f2Ep57hIcjZH3MDRmdbfOgx3BXOSUEMU34nkJ88QAbCPyU2eaG8F%2BJMAvsxUiuTHhJufeb1uiQgzncaIMouTDYqpjKBjqkAWxkso%2B0LWX9uEzdGBnt1sSAbAaq0buYTGS%2BmtxdSJ0OniOYlXWsyW3WjU23l5BWm9HajMBhf95u9OOvm5Dni8q%2FFvpf2ZcoS%2BN4OPvTw2D3vjgbe5JaEWWPv5vSm1hTb4SC3tt209ITpTQfTEf8ROlEAbLkD9IgSQ0rJ8LzYvfA%2B0MU0YFL%2BvMshSrW46yFwgkcXF7xgiOzkbwsL6gV4jo2nsk0&X-Amz-Signature=07e4449eef73d1cf4c82f9cdd6913a2618435724c55c6fb033ebaa9cb4a0d650&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4663DJJIULX%2F20251220%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251220T035612Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEPP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQC7MgBgv2DxW2SohqU3aD%2FiR5%2BUfrKq02ifadDOHeVnzgIhAPlYMSDJXEHvHu4GtUs74B%2FOjM0rIaxzjT7T46kQ6PHjKogECLz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1IgzGSNMYCYGVY%2BPT81Qq3AM%2Fy7ob%2BD%2B68WZo3buA4QgwOv0k%2FDSpHZCq8KhYRNNooaRmNL%2BQkSGjj0zXpQX%2BzXDQySpUnzP5%2FeXzcjYki6ojf1QUcVJI7D9q%2FmhgcqeXRvS80KqqaRwreJoRi18XXdQ2n2XuW3lLxte1L2q24ACS0xNjOALMIQ0dlBbo7Uh9Hp5D6HhibvcnOAHR8l10LTnU3xZMxfxZoL7jlc2CWvR5f5%2BD7knCyINZIK0vreTJszj3u4U3I2UUqm8NCyXywKOeRRxnQTHhjaRXWqZEE3OP3QL0PqMP5sPN%2FocBlHEyjpG%2F3jD7XpES0STr0VQDkvylLQ47zDL2ebOPvbC5GVN4Y8HUBFauBlL8WJCPAKgNj1CDofxXjwlVVmD2urHdpS9W%2Biok2I%2FdupqTX8Of%2F7IXdRMTeatwMPqz4xwHn8J2OMIrxJQHm3IbU5MqBe6yAdY8pAg7Vmei15haZImISaUXgAO6BQRhtTKE3P%2BkaHXy9LxQwHBrFU88KccNidXZB8vEHcE2QGsmBtOPpp66iZyGNcZ7%2Bqb8wF52QTTpP6f2Ep57hIcjZH3MDRmdbfOgx3BXOSUEMU34nkJ88QAbCPyU2eaG8F%2BJMAvsxUiuTHhJufeb1uiQgzncaIMouTDYqpjKBjqkAWxkso%2B0LWX9uEzdGBnt1sSAbAaq0buYTGS%2BmtxdSJ0OniOYlXWsyW3WjU23l5BWm9HajMBhf95u9OOvm5Dni8q%2FFvpf2ZcoS%2BN4OPvTw2D3vjgbe5JaEWWPv5vSm1hTb4SC3tt209ITpTQfTEf8ROlEAbLkD9IgSQ0rJ8LzYvfA%2B0MU0YFL%2BvMshSrW46yFwgkcXF7xgiOzkbwsL6gV4jo2nsk0&X-Amz-Signature=cd5bfdb913cec9403b1d4b72591b4c8b0b68a11df737fa3a33b134509f55eb3e&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4663DJJIULX%2F20251220%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251220T035612Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEPP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQC7MgBgv2DxW2SohqU3aD%2FiR5%2BUfrKq02ifadDOHeVnzgIhAPlYMSDJXEHvHu4GtUs74B%2FOjM0rIaxzjT7T46kQ6PHjKogECLz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1IgzGSNMYCYGVY%2BPT81Qq3AM%2Fy7ob%2BD%2B68WZo3buA4QgwOv0k%2FDSpHZCq8KhYRNNooaRmNL%2BQkSGjj0zXpQX%2BzXDQySpUnzP5%2FeXzcjYki6ojf1QUcVJI7D9q%2FmhgcqeXRvS80KqqaRwreJoRi18XXdQ2n2XuW3lLxte1L2q24ACS0xNjOALMIQ0dlBbo7Uh9Hp5D6HhibvcnOAHR8l10LTnU3xZMxfxZoL7jlc2CWvR5f5%2BD7knCyINZIK0vreTJszj3u4U3I2UUqm8NCyXywKOeRRxnQTHhjaRXWqZEE3OP3QL0PqMP5sPN%2FocBlHEyjpG%2F3jD7XpES0STr0VQDkvylLQ47zDL2ebOPvbC5GVN4Y8HUBFauBlL8WJCPAKgNj1CDofxXjwlVVmD2urHdpS9W%2Biok2I%2FdupqTX8Of%2F7IXdRMTeatwMPqz4xwHn8J2OMIrxJQHm3IbU5MqBe6yAdY8pAg7Vmei15haZImISaUXgAO6BQRhtTKE3P%2BkaHXy9LxQwHBrFU88KccNidXZB8vEHcE2QGsmBtOPpp66iZyGNcZ7%2Bqb8wF52QTTpP6f2Ep57hIcjZH3MDRmdbfOgx3BXOSUEMU34nkJ88QAbCPyU2eaG8F%2BJMAvsxUiuTHhJufeb1uiQgzncaIMouTDYqpjKBjqkAWxkso%2B0LWX9uEzdGBnt1sSAbAaq0buYTGS%2BmtxdSJ0OniOYlXWsyW3WjU23l5BWm9HajMBhf95u9OOvm5Dni8q%2FFvpf2ZcoS%2BN4OPvTw2D3vjgbe5JaEWWPv5vSm1hTb4SC3tt209ITpTQfTEf8ROlEAbLkD9IgSQ0rJ8LzYvfA%2B0MU0YFL%2BvMshSrW46yFwgkcXF7xgiOzkbwsL6gV4jo2nsk0&X-Amz-Signature=da2ebc3604538ca3b994b38de2d84bb94f5e85f0f04ef6b9520a4cfb6b605fad&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4663DJJIULX%2F20251220%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251220T035612Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEPP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQC7MgBgv2DxW2SohqU3aD%2FiR5%2BUfrKq02ifadDOHeVnzgIhAPlYMSDJXEHvHu4GtUs74B%2FOjM0rIaxzjT7T46kQ6PHjKogECLz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1IgzGSNMYCYGVY%2BPT81Qq3AM%2Fy7ob%2BD%2B68WZo3buA4QgwOv0k%2FDSpHZCq8KhYRNNooaRmNL%2BQkSGjj0zXpQX%2BzXDQySpUnzP5%2FeXzcjYki6ojf1QUcVJI7D9q%2FmhgcqeXRvS80KqqaRwreJoRi18XXdQ2n2XuW3lLxte1L2q24ACS0xNjOALMIQ0dlBbo7Uh9Hp5D6HhibvcnOAHR8l10LTnU3xZMxfxZoL7jlc2CWvR5f5%2BD7knCyINZIK0vreTJszj3u4U3I2UUqm8NCyXywKOeRRxnQTHhjaRXWqZEE3OP3QL0PqMP5sPN%2FocBlHEyjpG%2F3jD7XpES0STr0VQDkvylLQ47zDL2ebOPvbC5GVN4Y8HUBFauBlL8WJCPAKgNj1CDofxXjwlVVmD2urHdpS9W%2Biok2I%2FdupqTX8Of%2F7IXdRMTeatwMPqz4xwHn8J2OMIrxJQHm3IbU5MqBe6yAdY8pAg7Vmei15haZImISaUXgAO6BQRhtTKE3P%2BkaHXy9LxQwHBrFU88KccNidXZB8vEHcE2QGsmBtOPpp66iZyGNcZ7%2Bqb8wF52QTTpP6f2Ep57hIcjZH3MDRmdbfOgx3BXOSUEMU34nkJ88QAbCPyU2eaG8F%2BJMAvsxUiuTHhJufeb1uiQgzncaIMouTDYqpjKBjqkAWxkso%2B0LWX9uEzdGBnt1sSAbAaq0buYTGS%2BmtxdSJ0OniOYlXWsyW3WjU23l5BWm9HajMBhf95u9OOvm5Dni8q%2FFvpf2ZcoS%2BN4OPvTw2D3vjgbe5JaEWWPv5vSm1hTb4SC3tt209ITpTQfTEf8ROlEAbLkD9IgSQ0rJ8LzYvfA%2B0MU0YFL%2BvMshSrW46yFwgkcXF7xgiOzkbwsL6gV4jo2nsk0&X-Amz-Signature=a803f5c4f458c05ecbdd61eeb902ab767ea98382c632cab95a98dae1149e46c7&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

