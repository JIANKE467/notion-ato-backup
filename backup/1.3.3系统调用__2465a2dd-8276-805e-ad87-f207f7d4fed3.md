
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466WJADHO7N%2F20251231%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251231T040918Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEPn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDgvv9XuwANjTVRchrfVuChJf%2FRU1S%2FOfQo3rZZpGzH%2FQIgF7TjjIujdkaVvqF%2B%2FkXWTfvWvgMAZyulSeOqoqnjF50qiAQIwv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDEU5nafFrSqrsKgDtyrcA3hRpvtXmzjKFo7yKKP0sp1iL3qEwt2PGVGbeu1%2BVOoTaBtK%2FBCeEf%2BDYZb3tfizf59MjyJDn3sO1%2FWPwqysPrZUVXRDEGFNdy1UsZpBnYbjQ1dnhoLBYmSt5ZfyM0%2Bky3htmnzOMDy8GQuYKGCtEJb0nFLeZ8Tz6s20kd0Zdxta2Voqq1yBSfhwY1dYT6nvL1KqL8i3PKS2y0eR91u%2BJ%2F4%2Fk2J4UilvUIykRC0SREomqb85icIma2H8ZyHTT%2F%2BrGTEE4phyRu4Q58Vu2ohd14Grqz1276uvoEmVXHTY3PyOULxdMfq1xc%2FjieQotPByBRgCszXUQy51cU4Ar%2B6liqnwa6jtDEW380NP4KRnGMBJOiyxSItQ7VDM4yvU1%2FNqoiVyBhdB4Qgm010%2BV6Ah6%2FKv%2B%2FJyiMrbmFVl9m1nnyZYuCt0CnKcQ%2Bs3yo%2Be4cCmv1NPdMiai7HcbAV8iZBdRBsieq5aDjxOYCP2su3kdt3v5kEzUjDUp3wMJqfBmS%2BASOawfXtakAZtLKrheLKZijD39ggCpQjWgofceDp4wcDg%2B1%2Bkjd9t8SkfWHUCzAguXXHQBWUZjYp9SwFObJDhg3NDHVje79tMyKq431EzhwNWlp6dsaKoMft%2B2rJJMNjn0coGOqUB8zFM2PbH%2Bad7I3aFBBLjyHyr2FJ%2B2XuSQXl9EiRqePZ6oh6hMl6jWUZ4%2Fvuoz6Gf%2FUChazxe27EzvRG10vcWzCkq56ci7qOyU47%2F5L%2Bf9gGARHSbwWq%2Fu%2B%2BAE25NfNHCvp0OMR0EdjRjj481T75O2tWD%2BWXh%2BFXaB0VUOepyV8AQ4TzOF0f51U8aVBqMj%2FwXZpOBhmQ0dsLDd2leVNdcrESpJJ%2Bn&X-Amz-Signature=52638e8cf5b7db2ea1c6d8413ac5095ab87cda60fabba737a6fa07c81b79689c&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466WJADHO7N%2F20251231%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251231T040918Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEPn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDgvv9XuwANjTVRchrfVuChJf%2FRU1S%2FOfQo3rZZpGzH%2FQIgF7TjjIujdkaVvqF%2B%2FkXWTfvWvgMAZyulSeOqoqnjF50qiAQIwv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDEU5nafFrSqrsKgDtyrcA3hRpvtXmzjKFo7yKKP0sp1iL3qEwt2PGVGbeu1%2BVOoTaBtK%2FBCeEf%2BDYZb3tfizf59MjyJDn3sO1%2FWPwqysPrZUVXRDEGFNdy1UsZpBnYbjQ1dnhoLBYmSt5ZfyM0%2Bky3htmnzOMDy8GQuYKGCtEJb0nFLeZ8Tz6s20kd0Zdxta2Voqq1yBSfhwY1dYT6nvL1KqL8i3PKS2y0eR91u%2BJ%2F4%2Fk2J4UilvUIykRC0SREomqb85icIma2H8ZyHTT%2F%2BrGTEE4phyRu4Q58Vu2ohd14Grqz1276uvoEmVXHTY3PyOULxdMfq1xc%2FjieQotPByBRgCszXUQy51cU4Ar%2B6liqnwa6jtDEW380NP4KRnGMBJOiyxSItQ7VDM4yvU1%2FNqoiVyBhdB4Qgm010%2BV6Ah6%2FKv%2B%2FJyiMrbmFVl9m1nnyZYuCt0CnKcQ%2Bs3yo%2Be4cCmv1NPdMiai7HcbAV8iZBdRBsieq5aDjxOYCP2su3kdt3v5kEzUjDUp3wMJqfBmS%2BASOawfXtakAZtLKrheLKZijD39ggCpQjWgofceDp4wcDg%2B1%2Bkjd9t8SkfWHUCzAguXXHQBWUZjYp9SwFObJDhg3NDHVje79tMyKq431EzhwNWlp6dsaKoMft%2B2rJJMNjn0coGOqUB8zFM2PbH%2Bad7I3aFBBLjyHyr2FJ%2B2XuSQXl9EiRqePZ6oh6hMl6jWUZ4%2Fvuoz6Gf%2FUChazxe27EzvRG10vcWzCkq56ci7qOyU47%2F5L%2Bf9gGARHSbwWq%2Fu%2B%2BAE25NfNHCvp0OMR0EdjRjj481T75O2tWD%2BWXh%2BFXaB0VUOepyV8AQ4TzOF0f51U8aVBqMj%2FwXZpOBhmQ0dsLDd2leVNdcrESpJJ%2Bn&X-Amz-Signature=f011ee45dfed111d4d271f091270ee4436a1ff3aa83c9fc36ace2316417341e7&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466WJADHO7N%2F20251231%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251231T040918Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEPn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDgvv9XuwANjTVRchrfVuChJf%2FRU1S%2FOfQo3rZZpGzH%2FQIgF7TjjIujdkaVvqF%2B%2FkXWTfvWvgMAZyulSeOqoqnjF50qiAQIwv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDEU5nafFrSqrsKgDtyrcA3hRpvtXmzjKFo7yKKP0sp1iL3qEwt2PGVGbeu1%2BVOoTaBtK%2FBCeEf%2BDYZb3tfizf59MjyJDn3sO1%2FWPwqysPrZUVXRDEGFNdy1UsZpBnYbjQ1dnhoLBYmSt5ZfyM0%2Bky3htmnzOMDy8GQuYKGCtEJb0nFLeZ8Tz6s20kd0Zdxta2Voqq1yBSfhwY1dYT6nvL1KqL8i3PKS2y0eR91u%2BJ%2F4%2Fk2J4UilvUIykRC0SREomqb85icIma2H8ZyHTT%2F%2BrGTEE4phyRu4Q58Vu2ohd14Grqz1276uvoEmVXHTY3PyOULxdMfq1xc%2FjieQotPByBRgCszXUQy51cU4Ar%2B6liqnwa6jtDEW380NP4KRnGMBJOiyxSItQ7VDM4yvU1%2FNqoiVyBhdB4Qgm010%2BV6Ah6%2FKv%2B%2FJyiMrbmFVl9m1nnyZYuCt0CnKcQ%2Bs3yo%2Be4cCmv1NPdMiai7HcbAV8iZBdRBsieq5aDjxOYCP2su3kdt3v5kEzUjDUp3wMJqfBmS%2BASOawfXtakAZtLKrheLKZijD39ggCpQjWgofceDp4wcDg%2B1%2Bkjd9t8SkfWHUCzAguXXHQBWUZjYp9SwFObJDhg3NDHVje79tMyKq431EzhwNWlp6dsaKoMft%2B2rJJMNjn0coGOqUB8zFM2PbH%2Bad7I3aFBBLjyHyr2FJ%2B2XuSQXl9EiRqePZ6oh6hMl6jWUZ4%2Fvuoz6Gf%2FUChazxe27EzvRG10vcWzCkq56ci7qOyU47%2F5L%2Bf9gGARHSbwWq%2Fu%2B%2BAE25NfNHCvp0OMR0EdjRjj481T75O2tWD%2BWXh%2BFXaB0VUOepyV8AQ4TzOF0f51U8aVBqMj%2FwXZpOBhmQ0dsLDd2leVNdcrESpJJ%2Bn&X-Amz-Signature=89e8a0c70e57906277a97e9bd88bf4ce1b81ac8fbc9108f60e797ba34c010ae0&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466WJADHO7N%2F20251231%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251231T040918Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEPn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDgvv9XuwANjTVRchrfVuChJf%2FRU1S%2FOfQo3rZZpGzH%2FQIgF7TjjIujdkaVvqF%2B%2FkXWTfvWvgMAZyulSeOqoqnjF50qiAQIwv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDEU5nafFrSqrsKgDtyrcA3hRpvtXmzjKFo7yKKP0sp1iL3qEwt2PGVGbeu1%2BVOoTaBtK%2FBCeEf%2BDYZb3tfizf59MjyJDn3sO1%2FWPwqysPrZUVXRDEGFNdy1UsZpBnYbjQ1dnhoLBYmSt5ZfyM0%2Bky3htmnzOMDy8GQuYKGCtEJb0nFLeZ8Tz6s20kd0Zdxta2Voqq1yBSfhwY1dYT6nvL1KqL8i3PKS2y0eR91u%2BJ%2F4%2Fk2J4UilvUIykRC0SREomqb85icIma2H8ZyHTT%2F%2BrGTEE4phyRu4Q58Vu2ohd14Grqz1276uvoEmVXHTY3PyOULxdMfq1xc%2FjieQotPByBRgCszXUQy51cU4Ar%2B6liqnwa6jtDEW380NP4KRnGMBJOiyxSItQ7VDM4yvU1%2FNqoiVyBhdB4Qgm010%2BV6Ah6%2FKv%2B%2FJyiMrbmFVl9m1nnyZYuCt0CnKcQ%2Bs3yo%2Be4cCmv1NPdMiai7HcbAV8iZBdRBsieq5aDjxOYCP2su3kdt3v5kEzUjDUp3wMJqfBmS%2BASOawfXtakAZtLKrheLKZijD39ggCpQjWgofceDp4wcDg%2B1%2Bkjd9t8SkfWHUCzAguXXHQBWUZjYp9SwFObJDhg3NDHVje79tMyKq431EzhwNWlp6dsaKoMft%2B2rJJMNjn0coGOqUB8zFM2PbH%2Bad7I3aFBBLjyHyr2FJ%2B2XuSQXl9EiRqePZ6oh6hMl6jWUZ4%2Fvuoz6Gf%2FUChazxe27EzvRG10vcWzCkq56ci7qOyU47%2F5L%2Bf9gGARHSbwWq%2Fu%2B%2BAE25NfNHCvp0OMR0EdjRjj481T75O2tWD%2BWXh%2BFXaB0VUOepyV8AQ4TzOF0f51U8aVBqMj%2FwXZpOBhmQ0dsLDd2leVNdcrESpJJ%2Bn&X-Amz-Signature=335b762658d88a9d5b39a11a51670425ca3ab2f7e5bb01b7d8348012f0f46cd6&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

