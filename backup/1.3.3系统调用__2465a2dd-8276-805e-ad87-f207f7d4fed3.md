
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466VMNGLSJR%2F20260121%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260121T041800Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEPT%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCiQwp2lYhl6nn%2FAHsS2SSMVSPdCsllSuQDSd9omKwDNgIgI02z2HiuDDxu%2B2GDN2%2BWLLb38%2FoqJwx5Gx6iffZKilcqiAQIvf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDJc%2FtOnOA5t3kGyWnircAxFneNCEYVX4DQZqENhATqTj8RPyLMhn8uVH2Zb%2BmWqIZtm0mGfweu%2BpF5nWAQJOEalZ20X92Ixy8aIcWFpRFhIKLjLqnR%2BxEx0IE1MXdbEROk2vp6JfcCnsoR4JzlIzyI%2BB59P3zPoWiLABlgCv99WZg%2FSoVSK49rBcp2WmszVFKe9BLH%2BWtdlBuua4lx2rzddm1VOG4RHM0VQANeW3vTXK7NFxGJHPJlgbTuGMMSgyjJj3qIsmhkpNIqpbRTKFjuq4ytjQczzNdwUoNfKjNYn9de5rzffu%2BQgl34560qqvRxrNhJKukSP6ca6L9sz202fkZa1Dz3g1CHkXYGbCtZCBWVcDPZeQ1%2FB3tCNr2ClwUQhBp7yTMdHrF8qaV4tvNA5ZLyjNI02BECF6MZQ0QS8XbPZJ5RDMYdU4XjlV%2F7zSJAr%2BvYwsa5jQUdUfNwYdJkOJhuUEDiSbkqQeMQ7MnCM6%2Br47tYQFjGh6u4V2aHdmcmxrSUdyycUHH1MrLXad4u3sSvvdVTSbp9AalXL3FJ0l5DFWIMmt9SiJ7bsiYb47RdzRAVUe7IPJ7SHF258aFOFda7MCvFoepzZ3dl8FKySdSBaJX7KgrkQDPPtsk1GxtfIyt3cPz16PTymzMPSPwcsGOqUBE%2FRri43PFB2I%2Fg0AIYlKaAZCLT8XxmysoJqa4WFkHZL8HfIO1RXunmj7BTQUz8O349QFKtThTsiSYZPS3%2Fkbu5XiGUPO42rb4rele%2BOrKW3Lwn0eg%2FNm%2FGlcX4T8LVylg4Iw%2BJcn3BPvnUfsmIzha2y%2F%2F%2FWr8mNHvhXNZjSEH98Iwz163SQ%2F4KT49u%2Bcmy5QdSpgs3dSjrCOLj%2FpgWM3YXZR4ENO&X-Amz-Signature=162b99622f131491b180349846022d83d476435dbbc63e2030407feb9b623560&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466VMNGLSJR%2F20260121%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260121T041800Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEPT%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCiQwp2lYhl6nn%2FAHsS2SSMVSPdCsllSuQDSd9omKwDNgIgI02z2HiuDDxu%2B2GDN2%2BWLLb38%2FoqJwx5Gx6iffZKilcqiAQIvf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDJc%2FtOnOA5t3kGyWnircAxFneNCEYVX4DQZqENhATqTj8RPyLMhn8uVH2Zb%2BmWqIZtm0mGfweu%2BpF5nWAQJOEalZ20X92Ixy8aIcWFpRFhIKLjLqnR%2BxEx0IE1MXdbEROk2vp6JfcCnsoR4JzlIzyI%2BB59P3zPoWiLABlgCv99WZg%2FSoVSK49rBcp2WmszVFKe9BLH%2BWtdlBuua4lx2rzddm1VOG4RHM0VQANeW3vTXK7NFxGJHPJlgbTuGMMSgyjJj3qIsmhkpNIqpbRTKFjuq4ytjQczzNdwUoNfKjNYn9de5rzffu%2BQgl34560qqvRxrNhJKukSP6ca6L9sz202fkZa1Dz3g1CHkXYGbCtZCBWVcDPZeQ1%2FB3tCNr2ClwUQhBp7yTMdHrF8qaV4tvNA5ZLyjNI02BECF6MZQ0QS8XbPZJ5RDMYdU4XjlV%2F7zSJAr%2BvYwsa5jQUdUfNwYdJkOJhuUEDiSbkqQeMQ7MnCM6%2Br47tYQFjGh6u4V2aHdmcmxrSUdyycUHH1MrLXad4u3sSvvdVTSbp9AalXL3FJ0l5DFWIMmt9SiJ7bsiYb47RdzRAVUe7IPJ7SHF258aFOFda7MCvFoepzZ3dl8FKySdSBaJX7KgrkQDPPtsk1GxtfIyt3cPz16PTymzMPSPwcsGOqUBE%2FRri43PFB2I%2Fg0AIYlKaAZCLT8XxmysoJqa4WFkHZL8HfIO1RXunmj7BTQUz8O349QFKtThTsiSYZPS3%2Fkbu5XiGUPO42rb4rele%2BOrKW3Lwn0eg%2FNm%2FGlcX4T8LVylg4Iw%2BJcn3BPvnUfsmIzha2y%2F%2F%2FWr8mNHvhXNZjSEH98Iwz163SQ%2F4KT49u%2Bcmy5QdSpgs3dSjrCOLj%2FpgWM3YXZR4ENO&X-Amz-Signature=75ef357611f2acdefe383e041569dfbd99125bad0d334cc3f5b74ebdaa504333&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466VMNGLSJR%2F20260121%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260121T041800Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEPT%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCiQwp2lYhl6nn%2FAHsS2SSMVSPdCsllSuQDSd9omKwDNgIgI02z2HiuDDxu%2B2GDN2%2BWLLb38%2FoqJwx5Gx6iffZKilcqiAQIvf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDJc%2FtOnOA5t3kGyWnircAxFneNCEYVX4DQZqENhATqTj8RPyLMhn8uVH2Zb%2BmWqIZtm0mGfweu%2BpF5nWAQJOEalZ20X92Ixy8aIcWFpRFhIKLjLqnR%2BxEx0IE1MXdbEROk2vp6JfcCnsoR4JzlIzyI%2BB59P3zPoWiLABlgCv99WZg%2FSoVSK49rBcp2WmszVFKe9BLH%2BWtdlBuua4lx2rzddm1VOG4RHM0VQANeW3vTXK7NFxGJHPJlgbTuGMMSgyjJj3qIsmhkpNIqpbRTKFjuq4ytjQczzNdwUoNfKjNYn9de5rzffu%2BQgl34560qqvRxrNhJKukSP6ca6L9sz202fkZa1Dz3g1CHkXYGbCtZCBWVcDPZeQ1%2FB3tCNr2ClwUQhBp7yTMdHrF8qaV4tvNA5ZLyjNI02BECF6MZQ0QS8XbPZJ5RDMYdU4XjlV%2F7zSJAr%2BvYwsa5jQUdUfNwYdJkOJhuUEDiSbkqQeMQ7MnCM6%2Br47tYQFjGh6u4V2aHdmcmxrSUdyycUHH1MrLXad4u3sSvvdVTSbp9AalXL3FJ0l5DFWIMmt9SiJ7bsiYb47RdzRAVUe7IPJ7SHF258aFOFda7MCvFoepzZ3dl8FKySdSBaJX7KgrkQDPPtsk1GxtfIyt3cPz16PTymzMPSPwcsGOqUBE%2FRri43PFB2I%2Fg0AIYlKaAZCLT8XxmysoJqa4WFkHZL8HfIO1RXunmj7BTQUz8O349QFKtThTsiSYZPS3%2Fkbu5XiGUPO42rb4rele%2BOrKW3Lwn0eg%2FNm%2FGlcX4T8LVylg4Iw%2BJcn3BPvnUfsmIzha2y%2F%2F%2FWr8mNHvhXNZjSEH98Iwz163SQ%2F4KT49u%2Bcmy5QdSpgs3dSjrCOLj%2FpgWM3YXZR4ENO&X-Amz-Signature=d93d89283a589a6530c1ae2c28b38ee1fa452a6b440ee8d1bd8f49606a8de6ec&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466VMNGLSJR%2F20260121%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260121T041800Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEPT%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCiQwp2lYhl6nn%2FAHsS2SSMVSPdCsllSuQDSd9omKwDNgIgI02z2HiuDDxu%2B2GDN2%2BWLLb38%2FoqJwx5Gx6iffZKilcqiAQIvf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDJc%2FtOnOA5t3kGyWnircAxFneNCEYVX4DQZqENhATqTj8RPyLMhn8uVH2Zb%2BmWqIZtm0mGfweu%2BpF5nWAQJOEalZ20X92Ixy8aIcWFpRFhIKLjLqnR%2BxEx0IE1MXdbEROk2vp6JfcCnsoR4JzlIzyI%2BB59P3zPoWiLABlgCv99WZg%2FSoVSK49rBcp2WmszVFKe9BLH%2BWtdlBuua4lx2rzddm1VOG4RHM0VQANeW3vTXK7NFxGJHPJlgbTuGMMSgyjJj3qIsmhkpNIqpbRTKFjuq4ytjQczzNdwUoNfKjNYn9de5rzffu%2BQgl34560qqvRxrNhJKukSP6ca6L9sz202fkZa1Dz3g1CHkXYGbCtZCBWVcDPZeQ1%2FB3tCNr2ClwUQhBp7yTMdHrF8qaV4tvNA5ZLyjNI02BECF6MZQ0QS8XbPZJ5RDMYdU4XjlV%2F7zSJAr%2BvYwsa5jQUdUfNwYdJkOJhuUEDiSbkqQeMQ7MnCM6%2Br47tYQFjGh6u4V2aHdmcmxrSUdyycUHH1MrLXad4u3sSvvdVTSbp9AalXL3FJ0l5DFWIMmt9SiJ7bsiYb47RdzRAVUe7IPJ7SHF258aFOFda7MCvFoepzZ3dl8FKySdSBaJX7KgrkQDPPtsk1GxtfIyt3cPz16PTymzMPSPwcsGOqUBE%2FRri43PFB2I%2Fg0AIYlKaAZCLT8XxmysoJqa4WFkHZL8HfIO1RXunmj7BTQUz8O349QFKtThTsiSYZPS3%2Fkbu5XiGUPO42rb4rele%2BOrKW3Lwn0eg%2FNm%2FGlcX4T8LVylg4Iw%2BJcn3BPvnUfsmIzha2y%2F%2F%2FWr8mNHvhXNZjSEH98Iwz163SQ%2F4KT49u%2Bcmy5QdSpgs3dSjrCOLj%2FpgWM3YXZR4ENO&X-Amz-Signature=6191c49d6e35407c1b1ee9d639957953ca98411b5a82d1b66f58f6d1c69eb4a8&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

