
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466YOZ6YC6F%2F20251212%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251212T040531Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEDQaCXVzLXdlc3QtMiJHMEUCIQCHPV9%2BkAfRLNWdjDvWJ%2BsLtGKjrsUXo6GINSOy6T97VwIgcSARe1IXstWcvjXTb2KpKtw20w0CDWHhI7H89QBkmJIqiAQI%2Ff%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDFfSZJ3a8midIEEIRyrcAznvZvE04f75rVQiFSWjMyUbgKo5HY9QMBnzVDids%2Bc%2BRez5rTLqsgNn9Y725Z%2BPjCrIxgV0VtaLOXjC%2FJyr7BAiz8hLMpeksOL9fiBYQK4QJ%2F5CDk1RfEqirEgpe9HLQOmV%2BU1x7ohIVZPWaoMjoIWfvZa08cKM%2F1tBT4qqwx2kZMGxeNSdumuS%2FvLh8GsmWDBEbeoa%2B4UeSYSkS%2FGu1mL1sH7PB36TcQKdnaK%2FlwCurCEIrZpX46CuUqqpGWMAUVnsl0BWfkm6f4RYvMJAf7mC6cqoc0q4J3loP7T%2FBOOqY2BARBvSsHM%2F5hKXbAt3jpzJO8zumcf316ibMRf8KeYbJotA%2BuJUuOjViAkhNSLNqJMy1GdgLvf4mvzdkbLqy18pYMQjWDg%2BDkCeCQmx3qBCSoLWqudgx3CF9KR1YDbhJEIVhmZr7ktK9n664cq9D9uQkLKNpTuSQVN5CK8rfDwzflQ3NqGX4y8a2iSwTI%2FY4dPQRcehlIkiLrj3DAcSweK1b7m%2FmxnGhiZLVC0mjICevj5C%2BDVBC8XdInqz7JhPHR0P8f%2B%2FXDGkUUHLmKYnQy4xRlzxxJsZ402S%2Bl%2F8GGeFSbFPHXbJ%2BcJ8I72WhCy7%2FCKoCfPCVGDCuCwgMPan7skGOqUBAjCvjeG8GSROSLh%2BJyGBfWA3iFHH4A2axgkjcvhg06RQf4hCWrb6yPP%2F51dySNN99aYtah5DzWs7tVd7GJuKom10bhwgQw5WAucsP48Z%2BhBnA8ajc4rfZY9fWoxJY9FXE37RskexpGz9jhXAeWYs37xHcNsa%2B5lyeQkK4O2dBMXDUcqwEE20cDNJJFgAq2qIHxhG5GX0zKh6Wzzk2TN3GMRDkfsX&X-Amz-Signature=647d78a44493d23e85898aaf9c0091e7849043adcebcf202ffed89b030dc92d4&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466YOZ6YC6F%2F20251212%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251212T040531Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEDQaCXVzLXdlc3QtMiJHMEUCIQCHPV9%2BkAfRLNWdjDvWJ%2BsLtGKjrsUXo6GINSOy6T97VwIgcSARe1IXstWcvjXTb2KpKtw20w0CDWHhI7H89QBkmJIqiAQI%2Ff%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDFfSZJ3a8midIEEIRyrcAznvZvE04f75rVQiFSWjMyUbgKo5HY9QMBnzVDids%2Bc%2BRez5rTLqsgNn9Y725Z%2BPjCrIxgV0VtaLOXjC%2FJyr7BAiz8hLMpeksOL9fiBYQK4QJ%2F5CDk1RfEqirEgpe9HLQOmV%2BU1x7ohIVZPWaoMjoIWfvZa08cKM%2F1tBT4qqwx2kZMGxeNSdumuS%2FvLh8GsmWDBEbeoa%2B4UeSYSkS%2FGu1mL1sH7PB36TcQKdnaK%2FlwCurCEIrZpX46CuUqqpGWMAUVnsl0BWfkm6f4RYvMJAf7mC6cqoc0q4J3loP7T%2FBOOqY2BARBvSsHM%2F5hKXbAt3jpzJO8zumcf316ibMRf8KeYbJotA%2BuJUuOjViAkhNSLNqJMy1GdgLvf4mvzdkbLqy18pYMQjWDg%2BDkCeCQmx3qBCSoLWqudgx3CF9KR1YDbhJEIVhmZr7ktK9n664cq9D9uQkLKNpTuSQVN5CK8rfDwzflQ3NqGX4y8a2iSwTI%2FY4dPQRcehlIkiLrj3DAcSweK1b7m%2FmxnGhiZLVC0mjICevj5C%2BDVBC8XdInqz7JhPHR0P8f%2B%2FXDGkUUHLmKYnQy4xRlzxxJsZ402S%2Bl%2F8GGeFSbFPHXbJ%2BcJ8I72WhCy7%2FCKoCfPCVGDCuCwgMPan7skGOqUBAjCvjeG8GSROSLh%2BJyGBfWA3iFHH4A2axgkjcvhg06RQf4hCWrb6yPP%2F51dySNN99aYtah5DzWs7tVd7GJuKom10bhwgQw5WAucsP48Z%2BhBnA8ajc4rfZY9fWoxJY9FXE37RskexpGz9jhXAeWYs37xHcNsa%2B5lyeQkK4O2dBMXDUcqwEE20cDNJJFgAq2qIHxhG5GX0zKh6Wzzk2TN3GMRDkfsX&X-Amz-Signature=849a95423a91e875c3234e2077080ffbce7611b92bd7df8c69b45fdb971df968&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466YOZ6YC6F%2F20251212%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251212T040531Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEDQaCXVzLXdlc3QtMiJHMEUCIQCHPV9%2BkAfRLNWdjDvWJ%2BsLtGKjrsUXo6GINSOy6T97VwIgcSARe1IXstWcvjXTb2KpKtw20w0CDWHhI7H89QBkmJIqiAQI%2Ff%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDFfSZJ3a8midIEEIRyrcAznvZvE04f75rVQiFSWjMyUbgKo5HY9QMBnzVDids%2Bc%2BRez5rTLqsgNn9Y725Z%2BPjCrIxgV0VtaLOXjC%2FJyr7BAiz8hLMpeksOL9fiBYQK4QJ%2F5CDk1RfEqirEgpe9HLQOmV%2BU1x7ohIVZPWaoMjoIWfvZa08cKM%2F1tBT4qqwx2kZMGxeNSdumuS%2FvLh8GsmWDBEbeoa%2B4UeSYSkS%2FGu1mL1sH7PB36TcQKdnaK%2FlwCurCEIrZpX46CuUqqpGWMAUVnsl0BWfkm6f4RYvMJAf7mC6cqoc0q4J3loP7T%2FBOOqY2BARBvSsHM%2F5hKXbAt3jpzJO8zumcf316ibMRf8KeYbJotA%2BuJUuOjViAkhNSLNqJMy1GdgLvf4mvzdkbLqy18pYMQjWDg%2BDkCeCQmx3qBCSoLWqudgx3CF9KR1YDbhJEIVhmZr7ktK9n664cq9D9uQkLKNpTuSQVN5CK8rfDwzflQ3NqGX4y8a2iSwTI%2FY4dPQRcehlIkiLrj3DAcSweK1b7m%2FmxnGhiZLVC0mjICevj5C%2BDVBC8XdInqz7JhPHR0P8f%2B%2FXDGkUUHLmKYnQy4xRlzxxJsZ402S%2Bl%2F8GGeFSbFPHXbJ%2BcJ8I72WhCy7%2FCKoCfPCVGDCuCwgMPan7skGOqUBAjCvjeG8GSROSLh%2BJyGBfWA3iFHH4A2axgkjcvhg06RQf4hCWrb6yPP%2F51dySNN99aYtah5DzWs7tVd7GJuKom10bhwgQw5WAucsP48Z%2BhBnA8ajc4rfZY9fWoxJY9FXE37RskexpGz9jhXAeWYs37xHcNsa%2B5lyeQkK4O2dBMXDUcqwEE20cDNJJFgAq2qIHxhG5GX0zKh6Wzzk2TN3GMRDkfsX&X-Amz-Signature=8e6bb2317e507a0314969e245a904551f5d2157658763b8038b68730e3e059cb&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466YOZ6YC6F%2F20251212%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251212T040531Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEDQaCXVzLXdlc3QtMiJHMEUCIQCHPV9%2BkAfRLNWdjDvWJ%2BsLtGKjrsUXo6GINSOy6T97VwIgcSARe1IXstWcvjXTb2KpKtw20w0CDWHhI7H89QBkmJIqiAQI%2Ff%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDFfSZJ3a8midIEEIRyrcAznvZvE04f75rVQiFSWjMyUbgKo5HY9QMBnzVDids%2Bc%2BRez5rTLqsgNn9Y725Z%2BPjCrIxgV0VtaLOXjC%2FJyr7BAiz8hLMpeksOL9fiBYQK4QJ%2F5CDk1RfEqirEgpe9HLQOmV%2BU1x7ohIVZPWaoMjoIWfvZa08cKM%2F1tBT4qqwx2kZMGxeNSdumuS%2FvLh8GsmWDBEbeoa%2B4UeSYSkS%2FGu1mL1sH7PB36TcQKdnaK%2FlwCurCEIrZpX46CuUqqpGWMAUVnsl0BWfkm6f4RYvMJAf7mC6cqoc0q4J3loP7T%2FBOOqY2BARBvSsHM%2F5hKXbAt3jpzJO8zumcf316ibMRf8KeYbJotA%2BuJUuOjViAkhNSLNqJMy1GdgLvf4mvzdkbLqy18pYMQjWDg%2BDkCeCQmx3qBCSoLWqudgx3CF9KR1YDbhJEIVhmZr7ktK9n664cq9D9uQkLKNpTuSQVN5CK8rfDwzflQ3NqGX4y8a2iSwTI%2FY4dPQRcehlIkiLrj3DAcSweK1b7m%2FmxnGhiZLVC0mjICevj5C%2BDVBC8XdInqz7JhPHR0P8f%2B%2FXDGkUUHLmKYnQy4xRlzxxJsZ402S%2Bl%2F8GGeFSbFPHXbJ%2BcJ8I72WhCy7%2FCKoCfPCVGDCuCwgMPan7skGOqUBAjCvjeG8GSROSLh%2BJyGBfWA3iFHH4A2axgkjcvhg06RQf4hCWrb6yPP%2F51dySNN99aYtah5DzWs7tVd7GJuKom10bhwgQw5WAucsP48Z%2BhBnA8ajc4rfZY9fWoxJY9FXE37RskexpGz9jhXAeWYs37xHcNsa%2B5lyeQkK4O2dBMXDUcqwEE20cDNJJFgAq2qIHxhG5GX0zKh6Wzzk2TN3GMRDkfsX&X-Amz-Signature=14f8441163757a3d1b722e2c14792f9aee1716fc709078d23089fb0c1a40531d&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

