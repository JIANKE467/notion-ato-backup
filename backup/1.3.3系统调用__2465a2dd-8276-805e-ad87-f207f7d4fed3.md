
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466T2AXLY2Y%2F20260128%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260128T041941Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIHLdT9riCLXsJ9QatLllB6kQNR%2FDlvKx7n1TsBhjVgIDAiAEPj7PlC%2FnxxUkJncRkZpDexdl8J7kuzH7qxk0Q0OxrSr%2FAwhlEAAaDDYzNzQyMzE4MzgwNSIM0lz3VNW76xD9l5FAKtwDk56ZUKTSl4i%2BoYCNpiRHIvtmdopop0tXTnph45xfaKY5I87A13tg59BdKzxRItxXDBkmpjo9xDQlpWTIAKRFVfgVRxJ62PQ5ImSne7%2Fr6Z4SDztf%2F5o6FktB0QDsYCx%2FCli3GBsbaQah3k2RipZOoNd9JJXna8DHxOMnlCckI%2BYKjksyC6Lo5AqUluMhE9QG3bqd5HjyN5amlQjV1XEx52Us%2BIJoSCLkxLPYMi3YJ4yqpO6o4Bvr%2BkXq1Pe9KIgesLYLFtRWhVonn%2FcCWEqk53MzcAVcWoQyIGeqhbJwulos9oixQLp3KigxTzH40jqkMtB4qZWbGDMKGNFxokBmRGaQV%2BDk4Vlo9gxR9Q0I8gOkINqDANcGH%2FSvq3YsDPs6DW5VfglT2SZLK6%2BVnwOcTKy37N%2FkskY4sVnQ%2Fg8%2F2BqQbeljSA%2Fhk47cTYlrXXi2mxYZ9x3jiCOJutf9x%2FWcGReH2mHOMLNXb6t%2BXUiqrm7jAeTYr5SCE13Bkm0oerAujTejBeZhgXX3u5YIbmtOr9s8I0AnhntXqYLK3IdfcDJ78LAcjDR4ue8lxXY7xeU4MgMPJ4dcKqtbS%2BoykGaqUOkDiyrgpanRgwIP9EIS0VJJhcfkqh7URQe48Oww45jmywY6pgG3MpAStA4PJB03zb2dXoGFnvvZbLKRWo2BFga0Nhd1H%2FDQHF2ANZQY4D5L4HVC4YOtfcNtyDV%2FjD0mo50UnQyTyQ%2BFk9tiYPudMBsorkfox%2F0yO%2FCqYs3EmyiYGALi1kpq8upTAOud00uj4TQtuO88Rq2KTSkGYbme%2BgLwMvO8vdAyQtY15dtaCMgYFig7AYCB%2FCjncaf5XpVVPOPFhW%2Bwnt%2FPv6s6&X-Amz-Signature=64360f13187e1990d990700858b518ded09f5aa53f9c965b7c4e1a6c2b308df0&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466T2AXLY2Y%2F20260128%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260128T041941Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIHLdT9riCLXsJ9QatLllB6kQNR%2FDlvKx7n1TsBhjVgIDAiAEPj7PlC%2FnxxUkJncRkZpDexdl8J7kuzH7qxk0Q0OxrSr%2FAwhlEAAaDDYzNzQyMzE4MzgwNSIM0lz3VNW76xD9l5FAKtwDk56ZUKTSl4i%2BoYCNpiRHIvtmdopop0tXTnph45xfaKY5I87A13tg59BdKzxRItxXDBkmpjo9xDQlpWTIAKRFVfgVRxJ62PQ5ImSne7%2Fr6Z4SDztf%2F5o6FktB0QDsYCx%2FCli3GBsbaQah3k2RipZOoNd9JJXna8DHxOMnlCckI%2BYKjksyC6Lo5AqUluMhE9QG3bqd5HjyN5amlQjV1XEx52Us%2BIJoSCLkxLPYMi3YJ4yqpO6o4Bvr%2BkXq1Pe9KIgesLYLFtRWhVonn%2FcCWEqk53MzcAVcWoQyIGeqhbJwulos9oixQLp3KigxTzH40jqkMtB4qZWbGDMKGNFxokBmRGaQV%2BDk4Vlo9gxR9Q0I8gOkINqDANcGH%2FSvq3YsDPs6DW5VfglT2SZLK6%2BVnwOcTKy37N%2FkskY4sVnQ%2Fg8%2F2BqQbeljSA%2Fhk47cTYlrXXi2mxYZ9x3jiCOJutf9x%2FWcGReH2mHOMLNXb6t%2BXUiqrm7jAeTYr5SCE13Bkm0oerAujTejBeZhgXX3u5YIbmtOr9s8I0AnhntXqYLK3IdfcDJ78LAcjDR4ue8lxXY7xeU4MgMPJ4dcKqtbS%2BoykGaqUOkDiyrgpanRgwIP9EIS0VJJhcfkqh7URQe48Oww45jmywY6pgG3MpAStA4PJB03zb2dXoGFnvvZbLKRWo2BFga0Nhd1H%2FDQHF2ANZQY4D5L4HVC4YOtfcNtyDV%2FjD0mo50UnQyTyQ%2BFk9tiYPudMBsorkfox%2F0yO%2FCqYs3EmyiYGALi1kpq8upTAOud00uj4TQtuO88Rq2KTSkGYbme%2BgLwMvO8vdAyQtY15dtaCMgYFig7AYCB%2FCjncaf5XpVVPOPFhW%2Bwnt%2FPv6s6&X-Amz-Signature=5aa86b04cd37c6b5199e9f3d46a46d3bfdb4383c909bae7ea145f4af6c0cf598&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466T2AXLY2Y%2F20260128%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260128T041941Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIHLdT9riCLXsJ9QatLllB6kQNR%2FDlvKx7n1TsBhjVgIDAiAEPj7PlC%2FnxxUkJncRkZpDexdl8J7kuzH7qxk0Q0OxrSr%2FAwhlEAAaDDYzNzQyMzE4MzgwNSIM0lz3VNW76xD9l5FAKtwDk56ZUKTSl4i%2BoYCNpiRHIvtmdopop0tXTnph45xfaKY5I87A13tg59BdKzxRItxXDBkmpjo9xDQlpWTIAKRFVfgVRxJ62PQ5ImSne7%2Fr6Z4SDztf%2F5o6FktB0QDsYCx%2FCli3GBsbaQah3k2RipZOoNd9JJXna8DHxOMnlCckI%2BYKjksyC6Lo5AqUluMhE9QG3bqd5HjyN5amlQjV1XEx52Us%2BIJoSCLkxLPYMi3YJ4yqpO6o4Bvr%2BkXq1Pe9KIgesLYLFtRWhVonn%2FcCWEqk53MzcAVcWoQyIGeqhbJwulos9oixQLp3KigxTzH40jqkMtB4qZWbGDMKGNFxokBmRGaQV%2BDk4Vlo9gxR9Q0I8gOkINqDANcGH%2FSvq3YsDPs6DW5VfglT2SZLK6%2BVnwOcTKy37N%2FkskY4sVnQ%2Fg8%2F2BqQbeljSA%2Fhk47cTYlrXXi2mxYZ9x3jiCOJutf9x%2FWcGReH2mHOMLNXb6t%2BXUiqrm7jAeTYr5SCE13Bkm0oerAujTejBeZhgXX3u5YIbmtOr9s8I0AnhntXqYLK3IdfcDJ78LAcjDR4ue8lxXY7xeU4MgMPJ4dcKqtbS%2BoykGaqUOkDiyrgpanRgwIP9EIS0VJJhcfkqh7URQe48Oww45jmywY6pgG3MpAStA4PJB03zb2dXoGFnvvZbLKRWo2BFga0Nhd1H%2FDQHF2ANZQY4D5L4HVC4YOtfcNtyDV%2FjD0mo50UnQyTyQ%2BFk9tiYPudMBsorkfox%2F0yO%2FCqYs3EmyiYGALi1kpq8upTAOud00uj4TQtuO88Rq2KTSkGYbme%2BgLwMvO8vdAyQtY15dtaCMgYFig7AYCB%2FCjncaf5XpVVPOPFhW%2Bwnt%2FPv6s6&X-Amz-Signature=22f31d6fe4a6ba11e1463d8bd3b0ee8ef27f9154f7b9db52800fcb9b079dd5d3&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466T2AXLY2Y%2F20260128%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260128T041941Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIHLdT9riCLXsJ9QatLllB6kQNR%2FDlvKx7n1TsBhjVgIDAiAEPj7PlC%2FnxxUkJncRkZpDexdl8J7kuzH7qxk0Q0OxrSr%2FAwhlEAAaDDYzNzQyMzE4MzgwNSIM0lz3VNW76xD9l5FAKtwDk56ZUKTSl4i%2BoYCNpiRHIvtmdopop0tXTnph45xfaKY5I87A13tg59BdKzxRItxXDBkmpjo9xDQlpWTIAKRFVfgVRxJ62PQ5ImSne7%2Fr6Z4SDztf%2F5o6FktB0QDsYCx%2FCli3GBsbaQah3k2RipZOoNd9JJXna8DHxOMnlCckI%2BYKjksyC6Lo5AqUluMhE9QG3bqd5HjyN5amlQjV1XEx52Us%2BIJoSCLkxLPYMi3YJ4yqpO6o4Bvr%2BkXq1Pe9KIgesLYLFtRWhVonn%2FcCWEqk53MzcAVcWoQyIGeqhbJwulos9oixQLp3KigxTzH40jqkMtB4qZWbGDMKGNFxokBmRGaQV%2BDk4Vlo9gxR9Q0I8gOkINqDANcGH%2FSvq3YsDPs6DW5VfglT2SZLK6%2BVnwOcTKy37N%2FkskY4sVnQ%2Fg8%2F2BqQbeljSA%2Fhk47cTYlrXXi2mxYZ9x3jiCOJutf9x%2FWcGReH2mHOMLNXb6t%2BXUiqrm7jAeTYr5SCE13Bkm0oerAujTejBeZhgXX3u5YIbmtOr9s8I0AnhntXqYLK3IdfcDJ78LAcjDR4ue8lxXY7xeU4MgMPJ4dcKqtbS%2BoykGaqUOkDiyrgpanRgwIP9EIS0VJJhcfkqh7URQe48Oww45jmywY6pgG3MpAStA4PJB03zb2dXoGFnvvZbLKRWo2BFga0Nhd1H%2FDQHF2ANZQY4D5L4HVC4YOtfcNtyDV%2FjD0mo50UnQyTyQ%2BFk9tiYPudMBsorkfox%2F0yO%2FCqYs3EmyiYGALi1kpq8upTAOud00uj4TQtuO88Rq2KTSkGYbme%2BgLwMvO8vdAyQtY15dtaCMgYFig7AYCB%2FCjncaf5XpVVPOPFhW%2Bwnt%2FPv6s6&X-Amz-Signature=6a31e7f4f3d36b48eb9915a280b330636b135c9e24691a7d69bb0adb489f4b15&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

