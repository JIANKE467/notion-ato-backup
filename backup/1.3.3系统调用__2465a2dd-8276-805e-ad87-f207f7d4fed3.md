
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466VC6YBIT2%2F20260125%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260125T042557Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEFQaCXVzLXdlc3QtMiJHMEUCIQCPTzjJNyC%2BZP0rjZgUgiFg9TU%2FVf1gKaY4AAkD2%2BR7DAIgaSLQ0EO8qHDjXd3wXy6k4SiZ7YaeFyS5RhE8Cq41XXYq%2FwMIHRAAGgw2Mzc0MjMxODM4MDUiDAN0JSzNwOfDyetiYSrcA0f9Wj3%2Boeqo3Qmq1XNf6TxPx3UKZLmouP%2Bi6jChM0yblxDWUG%2B%2FY5m5m35tYo%2Fc%2BcgOrZg1FVwbupnMOSrCrIbNV94snFoQL8mhOhGgEjJFPws8%2BNb0xWf9IrdQABcAoYb7HqP5PDmyTt%2F2DS22v5n5o6aM3S6zLoUbwNR4IsTNoEaBjCZ1MwP253Yh1jaDeFJ73Kc8sNBM8DTKoq969jcgZzlXY2WgMOcG%2Fu%2BcWYxoFJ4ce8bHM6W1eAyMsfc09grtlhTvKJY%2FLPXb%2Fm5vU22MOb1MMtxmlrgZGnepE%2B5kyubtzRlRF2c1ZYVqBCoUPzc%2Fzjo2aR7XLTLFKS6rl1dKUv3cSuwZM1oczGTXKQ6KRMRnqia6yqKkRGCRBdlI7SA2%2FJbXwszvHzuCWPMde9e3yzWZZneQe5grK3rgFJK88l7u0KYHLJ%2F4j1OPdCt0%2FrA0mjTDI0wjPgFx0hvKMRQZ%2FwuxI4wx5iHDl2F6A6DFVyZGVR%2By9lKjgxcE4aNYpvzvy20EZAjW6JvG7XmCnDg%2FeZ11fhiPGEDifadeOj0h%2FfvPrFzEuLJzyQURnUss3Ds%2Bu%2FfMz1hLJakWGiBrknZYCOqTFj8ykWFU19gCkfM6YFJLbr%2F%2BBZWl%2BFdaMOyw1ssGOqUBdsi7z4fzeD7pA0qYDMY5MjKWVdpf6n8GSCr2zcO0im2pz7VJHXruud2MEDvslk01PiaZe4e5AFTCzNOyDDIxxECjkILdSimvd%2BoKsAR9jIDHqVH9M6y2p74xqGTsLg3aet6jLTPKJyAM7KY46%2Fkdugn%2FxPYrxAUTi4LdBkymvG0rW6wcmdfJiWmOQf%2BAGl5ISidzTY9VnvB83ZYq8ru8cFXrGpbz&X-Amz-Signature=a777744fed201f8c913d342c3e2271baf1e0e03767e5aad26b405de335a83996&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466VC6YBIT2%2F20260125%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260125T042557Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEFQaCXVzLXdlc3QtMiJHMEUCIQCPTzjJNyC%2BZP0rjZgUgiFg9TU%2FVf1gKaY4AAkD2%2BR7DAIgaSLQ0EO8qHDjXd3wXy6k4SiZ7YaeFyS5RhE8Cq41XXYq%2FwMIHRAAGgw2Mzc0MjMxODM4MDUiDAN0JSzNwOfDyetiYSrcA0f9Wj3%2Boeqo3Qmq1XNf6TxPx3UKZLmouP%2Bi6jChM0yblxDWUG%2B%2FY5m5m35tYo%2Fc%2BcgOrZg1FVwbupnMOSrCrIbNV94snFoQL8mhOhGgEjJFPws8%2BNb0xWf9IrdQABcAoYb7HqP5PDmyTt%2F2DS22v5n5o6aM3S6zLoUbwNR4IsTNoEaBjCZ1MwP253Yh1jaDeFJ73Kc8sNBM8DTKoq969jcgZzlXY2WgMOcG%2Fu%2BcWYxoFJ4ce8bHM6W1eAyMsfc09grtlhTvKJY%2FLPXb%2Fm5vU22MOb1MMtxmlrgZGnepE%2B5kyubtzRlRF2c1ZYVqBCoUPzc%2Fzjo2aR7XLTLFKS6rl1dKUv3cSuwZM1oczGTXKQ6KRMRnqia6yqKkRGCRBdlI7SA2%2FJbXwszvHzuCWPMde9e3yzWZZneQe5grK3rgFJK88l7u0KYHLJ%2F4j1OPdCt0%2FrA0mjTDI0wjPgFx0hvKMRQZ%2FwuxI4wx5iHDl2F6A6DFVyZGVR%2By9lKjgxcE4aNYpvzvy20EZAjW6JvG7XmCnDg%2FeZ11fhiPGEDifadeOj0h%2FfvPrFzEuLJzyQURnUss3Ds%2Bu%2FfMz1hLJakWGiBrknZYCOqTFj8ykWFU19gCkfM6YFJLbr%2F%2BBZWl%2BFdaMOyw1ssGOqUBdsi7z4fzeD7pA0qYDMY5MjKWVdpf6n8GSCr2zcO0im2pz7VJHXruud2MEDvslk01PiaZe4e5AFTCzNOyDDIxxECjkILdSimvd%2BoKsAR9jIDHqVH9M6y2p74xqGTsLg3aet6jLTPKJyAM7KY46%2Fkdugn%2FxPYrxAUTi4LdBkymvG0rW6wcmdfJiWmOQf%2BAGl5ISidzTY9VnvB83ZYq8ru8cFXrGpbz&X-Amz-Signature=666dafc4949170934bf73b392905c31eabfd2e81fa2081096c096c0836e79e9f&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466VC6YBIT2%2F20260125%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260125T042557Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEFQaCXVzLXdlc3QtMiJHMEUCIQCPTzjJNyC%2BZP0rjZgUgiFg9TU%2FVf1gKaY4AAkD2%2BR7DAIgaSLQ0EO8qHDjXd3wXy6k4SiZ7YaeFyS5RhE8Cq41XXYq%2FwMIHRAAGgw2Mzc0MjMxODM4MDUiDAN0JSzNwOfDyetiYSrcA0f9Wj3%2Boeqo3Qmq1XNf6TxPx3UKZLmouP%2Bi6jChM0yblxDWUG%2B%2FY5m5m35tYo%2Fc%2BcgOrZg1FVwbupnMOSrCrIbNV94snFoQL8mhOhGgEjJFPws8%2BNb0xWf9IrdQABcAoYb7HqP5PDmyTt%2F2DS22v5n5o6aM3S6zLoUbwNR4IsTNoEaBjCZ1MwP253Yh1jaDeFJ73Kc8sNBM8DTKoq969jcgZzlXY2WgMOcG%2Fu%2BcWYxoFJ4ce8bHM6W1eAyMsfc09grtlhTvKJY%2FLPXb%2Fm5vU22MOb1MMtxmlrgZGnepE%2B5kyubtzRlRF2c1ZYVqBCoUPzc%2Fzjo2aR7XLTLFKS6rl1dKUv3cSuwZM1oczGTXKQ6KRMRnqia6yqKkRGCRBdlI7SA2%2FJbXwszvHzuCWPMde9e3yzWZZneQe5grK3rgFJK88l7u0KYHLJ%2F4j1OPdCt0%2FrA0mjTDI0wjPgFx0hvKMRQZ%2FwuxI4wx5iHDl2F6A6DFVyZGVR%2By9lKjgxcE4aNYpvzvy20EZAjW6JvG7XmCnDg%2FeZ11fhiPGEDifadeOj0h%2FfvPrFzEuLJzyQURnUss3Ds%2Bu%2FfMz1hLJakWGiBrknZYCOqTFj8ykWFU19gCkfM6YFJLbr%2F%2BBZWl%2BFdaMOyw1ssGOqUBdsi7z4fzeD7pA0qYDMY5MjKWVdpf6n8GSCr2zcO0im2pz7VJHXruud2MEDvslk01PiaZe4e5AFTCzNOyDDIxxECjkILdSimvd%2BoKsAR9jIDHqVH9M6y2p74xqGTsLg3aet6jLTPKJyAM7KY46%2Fkdugn%2FxPYrxAUTi4LdBkymvG0rW6wcmdfJiWmOQf%2BAGl5ISidzTY9VnvB83ZYq8ru8cFXrGpbz&X-Amz-Signature=ed0b84ba44811322e7769d1d78fa62158207addfc85889e282ff4443f23a0176&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466VC6YBIT2%2F20260125%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260125T042557Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEFQaCXVzLXdlc3QtMiJHMEUCIQCPTzjJNyC%2BZP0rjZgUgiFg9TU%2FVf1gKaY4AAkD2%2BR7DAIgaSLQ0EO8qHDjXd3wXy6k4SiZ7YaeFyS5RhE8Cq41XXYq%2FwMIHRAAGgw2Mzc0MjMxODM4MDUiDAN0JSzNwOfDyetiYSrcA0f9Wj3%2Boeqo3Qmq1XNf6TxPx3UKZLmouP%2Bi6jChM0yblxDWUG%2B%2FY5m5m35tYo%2Fc%2BcgOrZg1FVwbupnMOSrCrIbNV94snFoQL8mhOhGgEjJFPws8%2BNb0xWf9IrdQABcAoYb7HqP5PDmyTt%2F2DS22v5n5o6aM3S6zLoUbwNR4IsTNoEaBjCZ1MwP253Yh1jaDeFJ73Kc8sNBM8DTKoq969jcgZzlXY2WgMOcG%2Fu%2BcWYxoFJ4ce8bHM6W1eAyMsfc09grtlhTvKJY%2FLPXb%2Fm5vU22MOb1MMtxmlrgZGnepE%2B5kyubtzRlRF2c1ZYVqBCoUPzc%2Fzjo2aR7XLTLFKS6rl1dKUv3cSuwZM1oczGTXKQ6KRMRnqia6yqKkRGCRBdlI7SA2%2FJbXwszvHzuCWPMde9e3yzWZZneQe5grK3rgFJK88l7u0KYHLJ%2F4j1OPdCt0%2FrA0mjTDI0wjPgFx0hvKMRQZ%2FwuxI4wx5iHDl2F6A6DFVyZGVR%2By9lKjgxcE4aNYpvzvy20EZAjW6JvG7XmCnDg%2FeZ11fhiPGEDifadeOj0h%2FfvPrFzEuLJzyQURnUss3Ds%2Bu%2FfMz1hLJakWGiBrknZYCOqTFj8ykWFU19gCkfM6YFJLbr%2F%2BBZWl%2BFdaMOyw1ssGOqUBdsi7z4fzeD7pA0qYDMY5MjKWVdpf6n8GSCr2zcO0im2pz7VJHXruud2MEDvslk01PiaZe4e5AFTCzNOyDDIxxECjkILdSimvd%2BoKsAR9jIDHqVH9M6y2p74xqGTsLg3aet6jLTPKJyAM7KY46%2Fkdugn%2FxPYrxAUTi4LdBkymvG0rW6wcmdfJiWmOQf%2BAGl5ISidzTY9VnvB83ZYq8ru8cFXrGpbz&X-Amz-Signature=14a26382f56a20d1544b2e50a283c3db5fd2ae950f9b8ef8655a0b804a973f87&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

