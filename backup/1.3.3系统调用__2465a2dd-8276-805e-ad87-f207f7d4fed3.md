
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466TUQT7Q6C%2F20260116%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260116T041323Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHwaCXVzLXdlc3QtMiJHMEUCIBbP1ahvvCUgFoHkE1oLI2P%2FhY%2BNwgEjIdv57pHoxA%2FjAiEA62n%2BCFFEbfaq0ByFoVHEXL7wC%2FGCRA6QOBv0%2F58W1MQq%2FwMIRRAAGgw2Mzc0MjMxODM4MDUiDFXErj82inGfWtJcmSrcA31Eu2sH0lDKYixTKWa2OPibtYNY849s%2FO6Ia1YqOuX8DG19ShfzgVKsMfOM4fnLyCHCxK7TDpVG%2Fs42N5KL6GCE7re565LtLSqFkHeHcphtv74DNieawAwixNguWZYHRya0BXnOQNjUltvKCISSgUURjJMdM91aJeiYrnoyVRbnEaFusDBFDi5Df9VjcyJt1fcuJc1DY5i3YsWgVTesWo6oOw9tzh%2BDHvndR4p3WmCmPr39wdJzepCGU1%2FN91YYqv%2FoSyFrwcvMLQEfzzZNolzJoQlXTg2PGClKTUpN9jltU75UbhEoOFyo6rnP8%2BGNSkfiYkGsyHkjl7gNEJ8sKs7L3%2BUdrfVr6wqpbkulzMzKqz37dkEhIEStblZ8q5AKTxp7sR4xJNK%2Bzbm2YzWop%2FOFWtxhBc66oQMx5fEftG6sx6wTWPo4Grl0i4hrRnk2onATFmpifpL5trsA2T2thQWW2n9hDDBIT1DvyrkkVpI04LzueOiNj%2FNDtAa2oDY4qS2dsnYku1yCfKqLDZF6dr%2BflL6KR3ZBC0R2btgPg2kIdBWI8D7B0NCAsAQQ2gYuXMHLf4j1hPOniUWmbGIraAxXrsgCh%2BoarGNAe9ZkujGyv%2FWYtiid2nS7Gk1BMMPtpssGOqUB9quDC5W0B8PHD14PuqFUCLV5rsMWAYcvMsNj%2Fe3MDSm%2FVcurMPR7ygvQTmJStwwRKMHX4XH5IToPqoYw8JHk8XUyO3B8jfbTreIpUWed%2BOV5x1QDbZH5v3gkIBA3eaxWnVTGO8yCe5jTEchRd5fN3Oau8HZpHkkj1IDB4rSj2Nn6KzH4PVCsfuXmCRDloqDtPuqBRKduvsmx3tr0qqSiM4YwV1m8&X-Amz-Signature=35bf8922416d1e7beca71e85eb7ccec55b2a2b76212400b42c3a67f8fcc76c87&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466TUQT7Q6C%2F20260116%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260116T041323Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHwaCXVzLXdlc3QtMiJHMEUCIBbP1ahvvCUgFoHkE1oLI2P%2FhY%2BNwgEjIdv57pHoxA%2FjAiEA62n%2BCFFEbfaq0ByFoVHEXL7wC%2FGCRA6QOBv0%2F58W1MQq%2FwMIRRAAGgw2Mzc0MjMxODM4MDUiDFXErj82inGfWtJcmSrcA31Eu2sH0lDKYixTKWa2OPibtYNY849s%2FO6Ia1YqOuX8DG19ShfzgVKsMfOM4fnLyCHCxK7TDpVG%2Fs42N5KL6GCE7re565LtLSqFkHeHcphtv74DNieawAwixNguWZYHRya0BXnOQNjUltvKCISSgUURjJMdM91aJeiYrnoyVRbnEaFusDBFDi5Df9VjcyJt1fcuJc1DY5i3YsWgVTesWo6oOw9tzh%2BDHvndR4p3WmCmPr39wdJzepCGU1%2FN91YYqv%2FoSyFrwcvMLQEfzzZNolzJoQlXTg2PGClKTUpN9jltU75UbhEoOFyo6rnP8%2BGNSkfiYkGsyHkjl7gNEJ8sKs7L3%2BUdrfVr6wqpbkulzMzKqz37dkEhIEStblZ8q5AKTxp7sR4xJNK%2Bzbm2YzWop%2FOFWtxhBc66oQMx5fEftG6sx6wTWPo4Grl0i4hrRnk2onATFmpifpL5trsA2T2thQWW2n9hDDBIT1DvyrkkVpI04LzueOiNj%2FNDtAa2oDY4qS2dsnYku1yCfKqLDZF6dr%2BflL6KR3ZBC0R2btgPg2kIdBWI8D7B0NCAsAQQ2gYuXMHLf4j1hPOniUWmbGIraAxXrsgCh%2BoarGNAe9ZkujGyv%2FWYtiid2nS7Gk1BMMPtpssGOqUB9quDC5W0B8PHD14PuqFUCLV5rsMWAYcvMsNj%2Fe3MDSm%2FVcurMPR7ygvQTmJStwwRKMHX4XH5IToPqoYw8JHk8XUyO3B8jfbTreIpUWed%2BOV5x1QDbZH5v3gkIBA3eaxWnVTGO8yCe5jTEchRd5fN3Oau8HZpHkkj1IDB4rSj2Nn6KzH4PVCsfuXmCRDloqDtPuqBRKduvsmx3tr0qqSiM4YwV1m8&X-Amz-Signature=3d14842eddc7b857ec66379ad01b3c9d6c4bca0d122e652df6d038d328e9dd61&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466TUQT7Q6C%2F20260116%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260116T041323Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHwaCXVzLXdlc3QtMiJHMEUCIBbP1ahvvCUgFoHkE1oLI2P%2FhY%2BNwgEjIdv57pHoxA%2FjAiEA62n%2BCFFEbfaq0ByFoVHEXL7wC%2FGCRA6QOBv0%2F58W1MQq%2FwMIRRAAGgw2Mzc0MjMxODM4MDUiDFXErj82inGfWtJcmSrcA31Eu2sH0lDKYixTKWa2OPibtYNY849s%2FO6Ia1YqOuX8DG19ShfzgVKsMfOM4fnLyCHCxK7TDpVG%2Fs42N5KL6GCE7re565LtLSqFkHeHcphtv74DNieawAwixNguWZYHRya0BXnOQNjUltvKCISSgUURjJMdM91aJeiYrnoyVRbnEaFusDBFDi5Df9VjcyJt1fcuJc1DY5i3YsWgVTesWo6oOw9tzh%2BDHvndR4p3WmCmPr39wdJzepCGU1%2FN91YYqv%2FoSyFrwcvMLQEfzzZNolzJoQlXTg2PGClKTUpN9jltU75UbhEoOFyo6rnP8%2BGNSkfiYkGsyHkjl7gNEJ8sKs7L3%2BUdrfVr6wqpbkulzMzKqz37dkEhIEStblZ8q5AKTxp7sR4xJNK%2Bzbm2YzWop%2FOFWtxhBc66oQMx5fEftG6sx6wTWPo4Grl0i4hrRnk2onATFmpifpL5trsA2T2thQWW2n9hDDBIT1DvyrkkVpI04LzueOiNj%2FNDtAa2oDY4qS2dsnYku1yCfKqLDZF6dr%2BflL6KR3ZBC0R2btgPg2kIdBWI8D7B0NCAsAQQ2gYuXMHLf4j1hPOniUWmbGIraAxXrsgCh%2BoarGNAe9ZkujGyv%2FWYtiid2nS7Gk1BMMPtpssGOqUB9quDC5W0B8PHD14PuqFUCLV5rsMWAYcvMsNj%2Fe3MDSm%2FVcurMPR7ygvQTmJStwwRKMHX4XH5IToPqoYw8JHk8XUyO3B8jfbTreIpUWed%2BOV5x1QDbZH5v3gkIBA3eaxWnVTGO8yCe5jTEchRd5fN3Oau8HZpHkkj1IDB4rSj2Nn6KzH4PVCsfuXmCRDloqDtPuqBRKduvsmx3tr0qqSiM4YwV1m8&X-Amz-Signature=e221300e47cddfc44c28fcc53f3316efb2972360fb18a95aa4fad3a41ce5e4d0&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466TUQT7Q6C%2F20260116%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260116T041323Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHwaCXVzLXdlc3QtMiJHMEUCIBbP1ahvvCUgFoHkE1oLI2P%2FhY%2BNwgEjIdv57pHoxA%2FjAiEA62n%2BCFFEbfaq0ByFoVHEXL7wC%2FGCRA6QOBv0%2F58W1MQq%2FwMIRRAAGgw2Mzc0MjMxODM4MDUiDFXErj82inGfWtJcmSrcA31Eu2sH0lDKYixTKWa2OPibtYNY849s%2FO6Ia1YqOuX8DG19ShfzgVKsMfOM4fnLyCHCxK7TDpVG%2Fs42N5KL6GCE7re565LtLSqFkHeHcphtv74DNieawAwixNguWZYHRya0BXnOQNjUltvKCISSgUURjJMdM91aJeiYrnoyVRbnEaFusDBFDi5Df9VjcyJt1fcuJc1DY5i3YsWgVTesWo6oOw9tzh%2BDHvndR4p3WmCmPr39wdJzepCGU1%2FN91YYqv%2FoSyFrwcvMLQEfzzZNolzJoQlXTg2PGClKTUpN9jltU75UbhEoOFyo6rnP8%2BGNSkfiYkGsyHkjl7gNEJ8sKs7L3%2BUdrfVr6wqpbkulzMzKqz37dkEhIEStblZ8q5AKTxp7sR4xJNK%2Bzbm2YzWop%2FOFWtxhBc66oQMx5fEftG6sx6wTWPo4Grl0i4hrRnk2onATFmpifpL5trsA2T2thQWW2n9hDDBIT1DvyrkkVpI04LzueOiNj%2FNDtAa2oDY4qS2dsnYku1yCfKqLDZF6dr%2BflL6KR3ZBC0R2btgPg2kIdBWI8D7B0NCAsAQQ2gYuXMHLf4j1hPOniUWmbGIraAxXrsgCh%2BoarGNAe9ZkujGyv%2FWYtiid2nS7Gk1BMMPtpssGOqUB9quDC5W0B8PHD14PuqFUCLV5rsMWAYcvMsNj%2Fe3MDSm%2FVcurMPR7ygvQTmJStwwRKMHX4XH5IToPqoYw8JHk8XUyO3B8jfbTreIpUWed%2BOV5x1QDbZH5v3gkIBA3eaxWnVTGO8yCe5jTEchRd5fN3Oau8HZpHkkj1IDB4rSj2Nn6KzH4PVCsfuXmCRDloqDtPuqBRKduvsmx3tr0qqSiM4YwV1m8&X-Amz-Signature=cb62851c7051fe78db345a9d36efaabe46f8646d137b3b2a8cd0f98fdc510859&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

