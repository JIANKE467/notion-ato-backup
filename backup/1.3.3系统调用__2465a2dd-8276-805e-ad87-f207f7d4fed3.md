
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466Y7USTHKO%2F20251221%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251221T112840Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBEaCXVzLXdlc3QtMiJGMEQCIDgGb9HhMlzbf0w7vZ3w%2FnC0y%2B7MPjcNQ243glEoTU7rAiAWL6vwq0SGPjIMj3NUrDc5InodiGis3UiuASO3MSz9JCqIBAja%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDYzNzQyMzE4MzgwNSIMEWWgu590MLgHrzAEKtwDl%2BNBfnc%2Fq85XzDgw%2FAB8o1irvka5XogyD%2Fw9%2FJtDrzHrqzjF77KK1UIj4Lem83E6ur9ZevEzbMDtSjxorAtZQtkIMfvDD87ajtLm3PC3dCNqSJ8oyeRJXWjO5pKF9tTN24CtppbyeSMPpnmBQR4ToBPnuJWnTbn7f9sPtxE1cLcNpDTw47iiorB1Wbiw4Q892GcVS1sPpPbyaTMt%2BPk6w2SH%2BlxtUEIiI1xDHV2%2BO1e2g%2BVHgGfmqGWAuDynM1SJmUkfDe2Do%2FUkLTSDb4kohzsuIU9yBLzcvfmF37Lz%2BszZ8hGun%2FDTkrKKnFZKeqbuy6Nh1RujF5%2Fo2i1mMk%2FsspRUjPR%2Fkdi8ghpxVkiJTpQWWAMcaB2ePl6F0jSC%2Fhj7h%2FxHg3DeCY2xD33ublIDIIVVzjSyrrjPWMfg%2FLFOgHYUd9XqHJkeRscqnPca1NEn6JTZNqtVPFjUC93LeA4TfnD66tOIrRT1wDFv8666v%2BX41p3EF6OB1UXKa7V0T75IQ%2FmcFGPRzDiKXcsLutzuFH1cYk%2BEQNlPqlPpHm%2BTxfccTVCicZnOrDto22bKVxAZE6zjvhheBfMMEzUqgEzmVSMTTYCPEPDlhPn5Bfrr08faFzXB6DDflb2es9owjPOeygY6pgGK96qfaBZwssS8ByZcJUxngNLrF8Z3hIHxbUsXXFKlGkd80TuooLZc6drj22qgbCvs3GMX5IACRytFbEmBBHqMXO7NUR%2BDEXSatcoRMxTXUMRWXmmcauuga0Q5%2BlgIE4V4NH1%2BllvpHeEWcN5vKc2tpZvCWrTfXktd%2FkgigVzFTYasENm8dLrJu%2B25bNIKKB2AwJ4qTEzfEBDN2TbralGWYkm7BCHf&X-Amz-Signature=2f05627d0ac38f1027b2120a15527b0c5a60e01fda85e062dc4b74007bcc874b&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466Y7USTHKO%2F20251221%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251221T112840Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBEaCXVzLXdlc3QtMiJGMEQCIDgGb9HhMlzbf0w7vZ3w%2FnC0y%2B7MPjcNQ243glEoTU7rAiAWL6vwq0SGPjIMj3NUrDc5InodiGis3UiuASO3MSz9JCqIBAja%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDYzNzQyMzE4MzgwNSIMEWWgu590MLgHrzAEKtwDl%2BNBfnc%2Fq85XzDgw%2FAB8o1irvka5XogyD%2Fw9%2FJtDrzHrqzjF77KK1UIj4Lem83E6ur9ZevEzbMDtSjxorAtZQtkIMfvDD87ajtLm3PC3dCNqSJ8oyeRJXWjO5pKF9tTN24CtppbyeSMPpnmBQR4ToBPnuJWnTbn7f9sPtxE1cLcNpDTw47iiorB1Wbiw4Q892GcVS1sPpPbyaTMt%2BPk6w2SH%2BlxtUEIiI1xDHV2%2BO1e2g%2BVHgGfmqGWAuDynM1SJmUkfDe2Do%2FUkLTSDb4kohzsuIU9yBLzcvfmF37Lz%2BszZ8hGun%2FDTkrKKnFZKeqbuy6Nh1RujF5%2Fo2i1mMk%2FsspRUjPR%2Fkdi8ghpxVkiJTpQWWAMcaB2ePl6F0jSC%2Fhj7h%2FxHg3DeCY2xD33ublIDIIVVzjSyrrjPWMfg%2FLFOgHYUd9XqHJkeRscqnPca1NEn6JTZNqtVPFjUC93LeA4TfnD66tOIrRT1wDFv8666v%2BX41p3EF6OB1UXKa7V0T75IQ%2FmcFGPRzDiKXcsLutzuFH1cYk%2BEQNlPqlPpHm%2BTxfccTVCicZnOrDto22bKVxAZE6zjvhheBfMMEzUqgEzmVSMTTYCPEPDlhPn5Bfrr08faFzXB6DDflb2es9owjPOeygY6pgGK96qfaBZwssS8ByZcJUxngNLrF8Z3hIHxbUsXXFKlGkd80TuooLZc6drj22qgbCvs3GMX5IACRytFbEmBBHqMXO7NUR%2BDEXSatcoRMxTXUMRWXmmcauuga0Q5%2BlgIE4V4NH1%2BllvpHeEWcN5vKc2tpZvCWrTfXktd%2FkgigVzFTYasENm8dLrJu%2B25bNIKKB2AwJ4qTEzfEBDN2TbralGWYkm7BCHf&X-Amz-Signature=8fdc6663a88ba7c6ff9bb930a7fc055284c9f0828e9265cf49d414a54801d83d&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466Y7USTHKO%2F20251221%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251221T112840Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBEaCXVzLXdlc3QtMiJGMEQCIDgGb9HhMlzbf0w7vZ3w%2FnC0y%2B7MPjcNQ243glEoTU7rAiAWL6vwq0SGPjIMj3NUrDc5InodiGis3UiuASO3MSz9JCqIBAja%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDYzNzQyMzE4MzgwNSIMEWWgu590MLgHrzAEKtwDl%2BNBfnc%2Fq85XzDgw%2FAB8o1irvka5XogyD%2Fw9%2FJtDrzHrqzjF77KK1UIj4Lem83E6ur9ZevEzbMDtSjxorAtZQtkIMfvDD87ajtLm3PC3dCNqSJ8oyeRJXWjO5pKF9tTN24CtppbyeSMPpnmBQR4ToBPnuJWnTbn7f9sPtxE1cLcNpDTw47iiorB1Wbiw4Q892GcVS1sPpPbyaTMt%2BPk6w2SH%2BlxtUEIiI1xDHV2%2BO1e2g%2BVHgGfmqGWAuDynM1SJmUkfDe2Do%2FUkLTSDb4kohzsuIU9yBLzcvfmF37Lz%2BszZ8hGun%2FDTkrKKnFZKeqbuy6Nh1RujF5%2Fo2i1mMk%2FsspRUjPR%2Fkdi8ghpxVkiJTpQWWAMcaB2ePl6F0jSC%2Fhj7h%2FxHg3DeCY2xD33ublIDIIVVzjSyrrjPWMfg%2FLFOgHYUd9XqHJkeRscqnPca1NEn6JTZNqtVPFjUC93LeA4TfnD66tOIrRT1wDFv8666v%2BX41p3EF6OB1UXKa7V0T75IQ%2FmcFGPRzDiKXcsLutzuFH1cYk%2BEQNlPqlPpHm%2BTxfccTVCicZnOrDto22bKVxAZE6zjvhheBfMMEzUqgEzmVSMTTYCPEPDlhPn5Bfrr08faFzXB6DDflb2es9owjPOeygY6pgGK96qfaBZwssS8ByZcJUxngNLrF8Z3hIHxbUsXXFKlGkd80TuooLZc6drj22qgbCvs3GMX5IACRytFbEmBBHqMXO7NUR%2BDEXSatcoRMxTXUMRWXmmcauuga0Q5%2BlgIE4V4NH1%2BllvpHeEWcN5vKc2tpZvCWrTfXktd%2FkgigVzFTYasENm8dLrJu%2B25bNIKKB2AwJ4qTEzfEBDN2TbralGWYkm7BCHf&X-Amz-Signature=ef4f2c8ff1478f5febf211582f6dbfb3ed7ee08749d73fe998723fc11395d106&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466Y7USTHKO%2F20251221%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251221T112840Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBEaCXVzLXdlc3QtMiJGMEQCIDgGb9HhMlzbf0w7vZ3w%2FnC0y%2B7MPjcNQ243glEoTU7rAiAWL6vwq0SGPjIMj3NUrDc5InodiGis3UiuASO3MSz9JCqIBAja%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDYzNzQyMzE4MzgwNSIMEWWgu590MLgHrzAEKtwDl%2BNBfnc%2Fq85XzDgw%2FAB8o1irvka5XogyD%2Fw9%2FJtDrzHrqzjF77KK1UIj4Lem83E6ur9ZevEzbMDtSjxorAtZQtkIMfvDD87ajtLm3PC3dCNqSJ8oyeRJXWjO5pKF9tTN24CtppbyeSMPpnmBQR4ToBPnuJWnTbn7f9sPtxE1cLcNpDTw47iiorB1Wbiw4Q892GcVS1sPpPbyaTMt%2BPk6w2SH%2BlxtUEIiI1xDHV2%2BO1e2g%2BVHgGfmqGWAuDynM1SJmUkfDe2Do%2FUkLTSDb4kohzsuIU9yBLzcvfmF37Lz%2BszZ8hGun%2FDTkrKKnFZKeqbuy6Nh1RujF5%2Fo2i1mMk%2FsspRUjPR%2Fkdi8ghpxVkiJTpQWWAMcaB2ePl6F0jSC%2Fhj7h%2FxHg3DeCY2xD33ublIDIIVVzjSyrrjPWMfg%2FLFOgHYUd9XqHJkeRscqnPca1NEn6JTZNqtVPFjUC93LeA4TfnD66tOIrRT1wDFv8666v%2BX41p3EF6OB1UXKa7V0T75IQ%2FmcFGPRzDiKXcsLutzuFH1cYk%2BEQNlPqlPpHm%2BTxfccTVCicZnOrDto22bKVxAZE6zjvhheBfMMEzUqgEzmVSMTTYCPEPDlhPn5Bfrr08faFzXB6DDflb2es9owjPOeygY6pgGK96qfaBZwssS8ByZcJUxngNLrF8Z3hIHxbUsXXFKlGkd80TuooLZc6drj22qgbCvs3GMX5IACRytFbEmBBHqMXO7NUR%2BDEXSatcoRMxTXUMRWXmmcauuga0Q5%2BlgIE4V4NH1%2BllvpHeEWcN5vKc2tpZvCWrTfXktd%2FkgigVzFTYasENm8dLrJu%2B25bNIKKB2AwJ4qTEzfEBDN2TbralGWYkm7BCHf&X-Amz-Signature=8fad3d27257cea5e59c45f39916f7615fab66fb8d60bcb0ef739f85be48bd05a&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

