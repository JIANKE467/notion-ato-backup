
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466USCWG55E%2F20251211%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251211T040704Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBwaCXVzLXdlc3QtMiJGMEQCIFjnQngdUBLnARm08glXUjVaAWSag34kgUNFL5Qzub0XAiA7HSagd3E17sx3sT%2BN%2BY2wusA0D8X7V4j6Q0nyueH8oCqIBAjl%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDYzNzQyMzE4MzgwNSIM%2BK62VrLnMW3pOdyBKtwDSaOrbSJCZ%2BWGedELO0Tk7Ms3rApBKCLXNLkCIfYp6Ogjp8Z474rR3SOtp3oI4sua0KDKo2pnQ%2B47NLsTP9PglSOBU4u%2FwpCnyoOW4eNBVdQOso9WpQc6wXlsrczvQKz1QEu5lXpWqzXyMYnI4adArfUgqvPvOLfZvHmQpNhAHp5qio%2FbBcD28FNVx6xnKRBP1JffvQtYhpxRVA%2BuA6%2FzfnAk42oXVfuauronqS4aGZ4owTgnFreBcip%2FVBRfeD7bhudWrjElTAsl4aLlFUImaLDcE1VuYcVvOl1QmX%2FInKv6ugXfbGjG1Uqi0K0cXDm6ntkCksnQKvO8oSTjzNSZ8VzZ1EeQXpYVOUG5x%2FKflNZtST%2BPi15fRkhLdbrTykuf7B9QaYos1mXNQzBIQ5Wc5mtTxSBKRB0ixQv2yWG9XusbbEbzgDq9Mxcxlh%2BflqkjCngfQtnKa%2F5KCF7NvkHW%2FWq3dMXTvu9aTMF4Ox0kZfUvy2JMs7d8ANoY%2BOGZ5xM36McfRIVHWFfYwlBmZj0FvdA7USUYit6fJ%2B%2BDgOHW8Yw52oNZH8OKtlL3ORV4t3%2BIVYcpm0xk71Ik0M1gvkHrkA9C1fYEO%2FUj1jvxHBhgM9ytUfFu89RGizUkuNIww%2FToyQY6pgE%2F9FjelDEHpU1fgtZmWN%2BsvhheneCxjq7%2Bv8i4U5%2F5Xoo3sc6KLgkGHhyX%2BeRyE34%2FwcXbOXh5F7QROltAldnqBc6DY%2BU%2BZxOQ1T1RYIXuRka4x8kmZ5uq26ZiuIh6QDkD4MWMO6IEkBEsMlDH8bb3IKPY2LrCo%2BBDm80F9zrb4Q5IXJlEnnFl6uDsnJRYDTKpL6sgOWFVPIxvZMs18fXoBA6TxBqt&X-Amz-Signature=821c4d61cf64cb279195f0b560fac3922bd94a5555828ffc1404f6469793829a&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466USCWG55E%2F20251211%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251211T040704Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBwaCXVzLXdlc3QtMiJGMEQCIFjnQngdUBLnARm08glXUjVaAWSag34kgUNFL5Qzub0XAiA7HSagd3E17sx3sT%2BN%2BY2wusA0D8X7V4j6Q0nyueH8oCqIBAjl%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDYzNzQyMzE4MzgwNSIM%2BK62VrLnMW3pOdyBKtwDSaOrbSJCZ%2BWGedELO0Tk7Ms3rApBKCLXNLkCIfYp6Ogjp8Z474rR3SOtp3oI4sua0KDKo2pnQ%2B47NLsTP9PglSOBU4u%2FwpCnyoOW4eNBVdQOso9WpQc6wXlsrczvQKz1QEu5lXpWqzXyMYnI4adArfUgqvPvOLfZvHmQpNhAHp5qio%2FbBcD28FNVx6xnKRBP1JffvQtYhpxRVA%2BuA6%2FzfnAk42oXVfuauronqS4aGZ4owTgnFreBcip%2FVBRfeD7bhudWrjElTAsl4aLlFUImaLDcE1VuYcVvOl1QmX%2FInKv6ugXfbGjG1Uqi0K0cXDm6ntkCksnQKvO8oSTjzNSZ8VzZ1EeQXpYVOUG5x%2FKflNZtST%2BPi15fRkhLdbrTykuf7B9QaYos1mXNQzBIQ5Wc5mtTxSBKRB0ixQv2yWG9XusbbEbzgDq9Mxcxlh%2BflqkjCngfQtnKa%2F5KCF7NvkHW%2FWq3dMXTvu9aTMF4Ox0kZfUvy2JMs7d8ANoY%2BOGZ5xM36McfRIVHWFfYwlBmZj0FvdA7USUYit6fJ%2B%2BDgOHW8Yw52oNZH8OKtlL3ORV4t3%2BIVYcpm0xk71Ik0M1gvkHrkA9C1fYEO%2FUj1jvxHBhgM9ytUfFu89RGizUkuNIww%2FToyQY6pgE%2F9FjelDEHpU1fgtZmWN%2BsvhheneCxjq7%2Bv8i4U5%2F5Xoo3sc6KLgkGHhyX%2BeRyE34%2FwcXbOXh5F7QROltAldnqBc6DY%2BU%2BZxOQ1T1RYIXuRka4x8kmZ5uq26ZiuIh6QDkD4MWMO6IEkBEsMlDH8bb3IKPY2LrCo%2BBDm80F9zrb4Q5IXJlEnnFl6uDsnJRYDTKpL6sgOWFVPIxvZMs18fXoBA6TxBqt&X-Amz-Signature=2339faf19817a8a1253e9e12050090a5c02f7c69fa850421db3ba6e3b6c2a3ab&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466USCWG55E%2F20251211%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251211T040704Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBwaCXVzLXdlc3QtMiJGMEQCIFjnQngdUBLnARm08glXUjVaAWSag34kgUNFL5Qzub0XAiA7HSagd3E17sx3sT%2BN%2BY2wusA0D8X7V4j6Q0nyueH8oCqIBAjl%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDYzNzQyMzE4MzgwNSIM%2BK62VrLnMW3pOdyBKtwDSaOrbSJCZ%2BWGedELO0Tk7Ms3rApBKCLXNLkCIfYp6Ogjp8Z474rR3SOtp3oI4sua0KDKo2pnQ%2B47NLsTP9PglSOBU4u%2FwpCnyoOW4eNBVdQOso9WpQc6wXlsrczvQKz1QEu5lXpWqzXyMYnI4adArfUgqvPvOLfZvHmQpNhAHp5qio%2FbBcD28FNVx6xnKRBP1JffvQtYhpxRVA%2BuA6%2FzfnAk42oXVfuauronqS4aGZ4owTgnFreBcip%2FVBRfeD7bhudWrjElTAsl4aLlFUImaLDcE1VuYcVvOl1QmX%2FInKv6ugXfbGjG1Uqi0K0cXDm6ntkCksnQKvO8oSTjzNSZ8VzZ1EeQXpYVOUG5x%2FKflNZtST%2BPi15fRkhLdbrTykuf7B9QaYos1mXNQzBIQ5Wc5mtTxSBKRB0ixQv2yWG9XusbbEbzgDq9Mxcxlh%2BflqkjCngfQtnKa%2F5KCF7NvkHW%2FWq3dMXTvu9aTMF4Ox0kZfUvy2JMs7d8ANoY%2BOGZ5xM36McfRIVHWFfYwlBmZj0FvdA7USUYit6fJ%2B%2BDgOHW8Yw52oNZH8OKtlL3ORV4t3%2BIVYcpm0xk71Ik0M1gvkHrkA9C1fYEO%2FUj1jvxHBhgM9ytUfFu89RGizUkuNIww%2FToyQY6pgE%2F9FjelDEHpU1fgtZmWN%2BsvhheneCxjq7%2Bv8i4U5%2F5Xoo3sc6KLgkGHhyX%2BeRyE34%2FwcXbOXh5F7QROltAldnqBc6DY%2BU%2BZxOQ1T1RYIXuRka4x8kmZ5uq26ZiuIh6QDkD4MWMO6IEkBEsMlDH8bb3IKPY2LrCo%2BBDm80F9zrb4Q5IXJlEnnFl6uDsnJRYDTKpL6sgOWFVPIxvZMs18fXoBA6TxBqt&X-Amz-Signature=3f40a543c2fd860c5eec1b47bf3caf664315d753c6b7dd7518449878aaf5cfda&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466USCWG55E%2F20251211%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251211T040704Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBwaCXVzLXdlc3QtMiJGMEQCIFjnQngdUBLnARm08glXUjVaAWSag34kgUNFL5Qzub0XAiA7HSagd3E17sx3sT%2BN%2BY2wusA0D8X7V4j6Q0nyueH8oCqIBAjl%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDYzNzQyMzE4MzgwNSIM%2BK62VrLnMW3pOdyBKtwDSaOrbSJCZ%2BWGedELO0Tk7Ms3rApBKCLXNLkCIfYp6Ogjp8Z474rR3SOtp3oI4sua0KDKo2pnQ%2B47NLsTP9PglSOBU4u%2FwpCnyoOW4eNBVdQOso9WpQc6wXlsrczvQKz1QEu5lXpWqzXyMYnI4adArfUgqvPvOLfZvHmQpNhAHp5qio%2FbBcD28FNVx6xnKRBP1JffvQtYhpxRVA%2BuA6%2FzfnAk42oXVfuauronqS4aGZ4owTgnFreBcip%2FVBRfeD7bhudWrjElTAsl4aLlFUImaLDcE1VuYcVvOl1QmX%2FInKv6ugXfbGjG1Uqi0K0cXDm6ntkCksnQKvO8oSTjzNSZ8VzZ1EeQXpYVOUG5x%2FKflNZtST%2BPi15fRkhLdbrTykuf7B9QaYos1mXNQzBIQ5Wc5mtTxSBKRB0ixQv2yWG9XusbbEbzgDq9Mxcxlh%2BflqkjCngfQtnKa%2F5KCF7NvkHW%2FWq3dMXTvu9aTMF4Ox0kZfUvy2JMs7d8ANoY%2BOGZ5xM36McfRIVHWFfYwlBmZj0FvdA7USUYit6fJ%2B%2BDgOHW8Yw52oNZH8OKtlL3ORV4t3%2BIVYcpm0xk71Ik0M1gvkHrkA9C1fYEO%2FUj1jvxHBhgM9ytUfFu89RGizUkuNIww%2FToyQY6pgE%2F9FjelDEHpU1fgtZmWN%2BsvhheneCxjq7%2Bv8i4U5%2F5Xoo3sc6KLgkGHhyX%2BeRyE34%2FwcXbOXh5F7QROltAldnqBc6DY%2BU%2BZxOQ1T1RYIXuRka4x8kmZ5uq26ZiuIh6QDkD4MWMO6IEkBEsMlDH8bb3IKPY2LrCo%2BBDm80F9zrb4Q5IXJlEnnFl6uDsnJRYDTKpL6sgOWFVPIxvZMs18fXoBA6TxBqt&X-Amz-Signature=e282e05ef53f413be1bc7fbe0fd4e37cf2f7e3a356be0f62c752cf8e2c670a58&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

