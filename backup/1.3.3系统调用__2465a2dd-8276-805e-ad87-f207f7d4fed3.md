
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4667IJQADX7%2F20260106%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260106T041139Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEIz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCehd6uxL%2Blp0xPQMxbkxy1lxCQQ%2FLhFn8k0IUK3kpjkAIgczMovIRCF9d1V62locrpBfjnhrIx5NDblAYNyPwJV0wq%2FwMIVRAAGgw2Mzc0MjMxODM4MDUiDPtDL%2FqfJN6xR8LbiircA8tRugt1Q0RZ9x9RKyOWCzDntUwL%2BRpGgVn%2FaFYCfJpeM2aPnguI0W%2FETOa4xUBqlnTJCvMXYBJufLe%2FzL2St2SRyJ%2FSFZz9kwedrNKaSHUlRm3caBZG%2F%2FFiYv2CX%2F0CHmERFtxELcuD8VvdQRabTh74C7f6XHr7A4akXzzu0dLEvvovx7nIK9grM9zTCjZ27h3mXC90cMQAjk3AZV8HhqJbQRPOTDGd%2BOQqL%2FZJnx6a6zduCuvFrGUBU5PLvcKNAvtu%2FvTrdeqUWSpzQFf0sqQ7zaLI37KjHMHFHqNXh2HQ7RG1PxlH0E2DFlNoua%2BF934pqBlw0Y9s6dtl6Q0UyiebBDroJTvUUi44nj7i5QZxgzzUNlekaNCJJJwNv53DjKN40qcLwNfwRzfFincwwrwXXx4%2BTFKQQ3PhTPT%2BRndsNRCLmjV1M3hBWo8IqrlOv%2B9rnox09SFiQstC8lDq8CdG5DaX%2BE1zY%2FGGSNbbWY5czY3dbiFSzQw4Zs0sqUD89X2nDxwHy1MHUJ15eOY6EtIDPGp9LMsRnmEVoo%2BvfmaXsq7JJyM8tZ6Zuv6Y%2BjC5rb%2B7Xp1dpsRhOsE%2BwywdxKmYD%2FsCznFdaWwKE%2Bwk4yoYUkZttAw7u9Jtq3x2MN%2BL8soGOqUBFD68sdgGL5bnOIArp6Xm1%2FZs0bpx7s1EFa1haOMEfehVbxwPmhN8IPznlOnqsYSxRgNXFtsVNPrmAlNrwc9R9015y8DLJmZWxPaxChO8FHW4JjHfdEthcwZcqEoyZY%2FZ0MUWvWE4zrToAcwqjS76HneGUiUjWRMStRu%2BOUoQL0L3jVV4JnyrXli2DqU%2BPHWU4cl9Yc%2F%2Fq%2F21kjvmcNpK0AIDc27e&X-Amz-Signature=93f0d75414fa407cecbf2e8645c364f3a9cf60f9f8a82a40a16da69744fec468&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4667IJQADX7%2F20260106%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260106T041139Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEIz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCehd6uxL%2Blp0xPQMxbkxy1lxCQQ%2FLhFn8k0IUK3kpjkAIgczMovIRCF9d1V62locrpBfjnhrIx5NDblAYNyPwJV0wq%2FwMIVRAAGgw2Mzc0MjMxODM4MDUiDPtDL%2FqfJN6xR8LbiircA8tRugt1Q0RZ9x9RKyOWCzDntUwL%2BRpGgVn%2FaFYCfJpeM2aPnguI0W%2FETOa4xUBqlnTJCvMXYBJufLe%2FzL2St2SRyJ%2FSFZz9kwedrNKaSHUlRm3caBZG%2F%2FFiYv2CX%2F0CHmERFtxELcuD8VvdQRabTh74C7f6XHr7A4akXzzu0dLEvvovx7nIK9grM9zTCjZ27h3mXC90cMQAjk3AZV8HhqJbQRPOTDGd%2BOQqL%2FZJnx6a6zduCuvFrGUBU5PLvcKNAvtu%2FvTrdeqUWSpzQFf0sqQ7zaLI37KjHMHFHqNXh2HQ7RG1PxlH0E2DFlNoua%2BF934pqBlw0Y9s6dtl6Q0UyiebBDroJTvUUi44nj7i5QZxgzzUNlekaNCJJJwNv53DjKN40qcLwNfwRzfFincwwrwXXx4%2BTFKQQ3PhTPT%2BRndsNRCLmjV1M3hBWo8IqrlOv%2B9rnox09SFiQstC8lDq8CdG5DaX%2BE1zY%2FGGSNbbWY5czY3dbiFSzQw4Zs0sqUD89X2nDxwHy1MHUJ15eOY6EtIDPGp9LMsRnmEVoo%2BvfmaXsq7JJyM8tZ6Zuv6Y%2BjC5rb%2B7Xp1dpsRhOsE%2BwywdxKmYD%2FsCznFdaWwKE%2Bwk4yoYUkZttAw7u9Jtq3x2MN%2BL8soGOqUBFD68sdgGL5bnOIArp6Xm1%2FZs0bpx7s1EFa1haOMEfehVbxwPmhN8IPznlOnqsYSxRgNXFtsVNPrmAlNrwc9R9015y8DLJmZWxPaxChO8FHW4JjHfdEthcwZcqEoyZY%2FZ0MUWvWE4zrToAcwqjS76HneGUiUjWRMStRu%2BOUoQL0L3jVV4JnyrXli2DqU%2BPHWU4cl9Yc%2F%2Fq%2F21kjvmcNpK0AIDc27e&X-Amz-Signature=e1a544e078490b1193401c1cdf2c7b35b7625da063b15d4f8441dbbc2cdeea38&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4667IJQADX7%2F20260106%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260106T041139Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEIz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCehd6uxL%2Blp0xPQMxbkxy1lxCQQ%2FLhFn8k0IUK3kpjkAIgczMovIRCF9d1V62locrpBfjnhrIx5NDblAYNyPwJV0wq%2FwMIVRAAGgw2Mzc0MjMxODM4MDUiDPtDL%2FqfJN6xR8LbiircA8tRugt1Q0RZ9x9RKyOWCzDntUwL%2BRpGgVn%2FaFYCfJpeM2aPnguI0W%2FETOa4xUBqlnTJCvMXYBJufLe%2FzL2St2SRyJ%2FSFZz9kwedrNKaSHUlRm3caBZG%2F%2FFiYv2CX%2F0CHmERFtxELcuD8VvdQRabTh74C7f6XHr7A4akXzzu0dLEvvovx7nIK9grM9zTCjZ27h3mXC90cMQAjk3AZV8HhqJbQRPOTDGd%2BOQqL%2FZJnx6a6zduCuvFrGUBU5PLvcKNAvtu%2FvTrdeqUWSpzQFf0sqQ7zaLI37KjHMHFHqNXh2HQ7RG1PxlH0E2DFlNoua%2BF934pqBlw0Y9s6dtl6Q0UyiebBDroJTvUUi44nj7i5QZxgzzUNlekaNCJJJwNv53DjKN40qcLwNfwRzfFincwwrwXXx4%2BTFKQQ3PhTPT%2BRndsNRCLmjV1M3hBWo8IqrlOv%2B9rnox09SFiQstC8lDq8CdG5DaX%2BE1zY%2FGGSNbbWY5czY3dbiFSzQw4Zs0sqUD89X2nDxwHy1MHUJ15eOY6EtIDPGp9LMsRnmEVoo%2BvfmaXsq7JJyM8tZ6Zuv6Y%2BjC5rb%2B7Xp1dpsRhOsE%2BwywdxKmYD%2FsCznFdaWwKE%2Bwk4yoYUkZttAw7u9Jtq3x2MN%2BL8soGOqUBFD68sdgGL5bnOIArp6Xm1%2FZs0bpx7s1EFa1haOMEfehVbxwPmhN8IPznlOnqsYSxRgNXFtsVNPrmAlNrwc9R9015y8DLJmZWxPaxChO8FHW4JjHfdEthcwZcqEoyZY%2FZ0MUWvWE4zrToAcwqjS76HneGUiUjWRMStRu%2BOUoQL0L3jVV4JnyrXli2DqU%2BPHWU4cl9Yc%2F%2Fq%2F21kjvmcNpK0AIDc27e&X-Amz-Signature=2b7bcb5c1883d7cbb31da0874bdb1478d6f2f2b814848958b9bbbd65bf13d3c4&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4667IJQADX7%2F20260106%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260106T041139Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEIz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCehd6uxL%2Blp0xPQMxbkxy1lxCQQ%2FLhFn8k0IUK3kpjkAIgczMovIRCF9d1V62locrpBfjnhrIx5NDblAYNyPwJV0wq%2FwMIVRAAGgw2Mzc0MjMxODM4MDUiDPtDL%2FqfJN6xR8LbiircA8tRugt1Q0RZ9x9RKyOWCzDntUwL%2BRpGgVn%2FaFYCfJpeM2aPnguI0W%2FETOa4xUBqlnTJCvMXYBJufLe%2FzL2St2SRyJ%2FSFZz9kwedrNKaSHUlRm3caBZG%2F%2FFiYv2CX%2F0CHmERFtxELcuD8VvdQRabTh74C7f6XHr7A4akXzzu0dLEvvovx7nIK9grM9zTCjZ27h3mXC90cMQAjk3AZV8HhqJbQRPOTDGd%2BOQqL%2FZJnx6a6zduCuvFrGUBU5PLvcKNAvtu%2FvTrdeqUWSpzQFf0sqQ7zaLI37KjHMHFHqNXh2HQ7RG1PxlH0E2DFlNoua%2BF934pqBlw0Y9s6dtl6Q0UyiebBDroJTvUUi44nj7i5QZxgzzUNlekaNCJJJwNv53DjKN40qcLwNfwRzfFincwwrwXXx4%2BTFKQQ3PhTPT%2BRndsNRCLmjV1M3hBWo8IqrlOv%2B9rnox09SFiQstC8lDq8CdG5DaX%2BE1zY%2FGGSNbbWY5czY3dbiFSzQw4Zs0sqUD89X2nDxwHy1MHUJ15eOY6EtIDPGp9LMsRnmEVoo%2BvfmaXsq7JJyM8tZ6Zuv6Y%2BjC5rb%2B7Xp1dpsRhOsE%2BwywdxKmYD%2FsCznFdaWwKE%2Bwk4yoYUkZttAw7u9Jtq3x2MN%2BL8soGOqUBFD68sdgGL5bnOIArp6Xm1%2FZs0bpx7s1EFa1haOMEfehVbxwPmhN8IPznlOnqsYSxRgNXFtsVNPrmAlNrwc9R9015y8DLJmZWxPaxChO8FHW4JjHfdEthcwZcqEoyZY%2FZ0MUWvWE4zrToAcwqjS76HneGUiUjWRMStRu%2BOUoQL0L3jVV4JnyrXli2DqU%2BPHWU4cl9Yc%2F%2Fq%2F21kjvmcNpK0AIDc27e&X-Amz-Signature=d03139c7e95327965264f361dff4a6a1b25422deccbff64c1e98362080674b52&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

