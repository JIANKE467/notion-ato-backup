
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QBBDS5ZC%2F20251206%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251206T053327Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDcXpajvmsd6wz5KAATgo0WhRwsCWo5snIK35w0edRT8wIhALGrGvirZZa1xg5VwgqrfKkO1bKDvSJmKz%2B8C7E%2FavnwKv8DCG4QABoMNjM3NDIzMTgzODA1Igz5i9WLnbPuNrBW0IQq3APgY0WJDLdp%2B%2Fs9T4MBqbOUtL8dC3R4DxDbUOGgamxCx0lz8aEhlC5UqxQiAFeHLB6EeJvKroWI%2BRR3duveAurNY4nG4o%2FLHgCPyUNuMbmcA%2FYalkE6ibTHz3LW%2Bd2KZHqpbC3cqXjj6kchi81ndpwXMY3L1RCBEmt65M3ObxT5dQ%2BrsQ%2F1xX7kSbehdnCKYZQBrmkvQ4h1fWBGc%2BKk56VR5LsSoFCi79yjRpp3yqGbKIwUvJRs1SFzpArPl5PRGhiRJP8QxeYapgy%2BiRuEoCZXCJudUhYqaWOjWgsObEbaVOHDL0EiFJpJio%2FszoFoogxJN4tYbjFzRc9dz6CvAjqwo9Y1NcH2ir5StSJyAkD1C2ox54chWE%2BNdceD44RYxb0ZbIAgP2pecZ9QQUg0cxgnk9zb0dqa3IdbuKK%2BfkdtfYlt0uRjHZNGM44QIwaw2gVIqK0opq5tbSbJRMs3D40Kgtn2HaIG%2FZLwSJ%2FD3oDmyQgPt2V08AzvSg5fSulTlRs1JWWN79coIq0wfxE5Hv0CIt8M722%2FOjOrD6nteJJzE8TDg9%2BcWfeO7uy%2BQk%2BoIoNZl11MUiGHDcoaLUwrhPIuF5NpAVX6uql65R6%2F3KEaTNdof99KvfT0bijZhTDT687JBjqkASEFyMVcz1nF8GW8rgBubfETa%2FSY0bM7XyTMpiYuxpngvyqvpAOJhLjxDfAPX71%2F89aglEDMezrvmSWJGUepHPOI1XoQb%2FUWUwJ3JiVYxHHU2J%2Bu1JifmSrW4SzTi9R9bAW2lywq%2Fw%2FOAgbHcczbP4rWJG1z%2F0xNOEzG8aTf2n8LXKnw%2FsOOUtFO3PPrKGVx6FwY9KsmBGso%2Byr7pg4dc%2FDMowf5&X-Amz-Signature=9c8e7d7228e43d933db8631deb36a138bbc5f382e0463f16691eb1243fa6dc4d&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QBBDS5ZC%2F20251206%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251206T053327Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDcXpajvmsd6wz5KAATgo0WhRwsCWo5snIK35w0edRT8wIhALGrGvirZZa1xg5VwgqrfKkO1bKDvSJmKz%2B8C7E%2FavnwKv8DCG4QABoMNjM3NDIzMTgzODA1Igz5i9WLnbPuNrBW0IQq3APgY0WJDLdp%2B%2Fs9T4MBqbOUtL8dC3R4DxDbUOGgamxCx0lz8aEhlC5UqxQiAFeHLB6EeJvKroWI%2BRR3duveAurNY4nG4o%2FLHgCPyUNuMbmcA%2FYalkE6ibTHz3LW%2Bd2KZHqpbC3cqXjj6kchi81ndpwXMY3L1RCBEmt65M3ObxT5dQ%2BrsQ%2F1xX7kSbehdnCKYZQBrmkvQ4h1fWBGc%2BKk56VR5LsSoFCi79yjRpp3yqGbKIwUvJRs1SFzpArPl5PRGhiRJP8QxeYapgy%2BiRuEoCZXCJudUhYqaWOjWgsObEbaVOHDL0EiFJpJio%2FszoFoogxJN4tYbjFzRc9dz6CvAjqwo9Y1NcH2ir5StSJyAkD1C2ox54chWE%2BNdceD44RYxb0ZbIAgP2pecZ9QQUg0cxgnk9zb0dqa3IdbuKK%2BfkdtfYlt0uRjHZNGM44QIwaw2gVIqK0opq5tbSbJRMs3D40Kgtn2HaIG%2FZLwSJ%2FD3oDmyQgPt2V08AzvSg5fSulTlRs1JWWN79coIq0wfxE5Hv0CIt8M722%2FOjOrD6nteJJzE8TDg9%2BcWfeO7uy%2BQk%2BoIoNZl11MUiGHDcoaLUwrhPIuF5NpAVX6uql65R6%2F3KEaTNdof99KvfT0bijZhTDT687JBjqkASEFyMVcz1nF8GW8rgBubfETa%2FSY0bM7XyTMpiYuxpngvyqvpAOJhLjxDfAPX71%2F89aglEDMezrvmSWJGUepHPOI1XoQb%2FUWUwJ3JiVYxHHU2J%2Bu1JifmSrW4SzTi9R9bAW2lywq%2Fw%2FOAgbHcczbP4rWJG1z%2F0xNOEzG8aTf2n8LXKnw%2FsOOUtFO3PPrKGVx6FwY9KsmBGso%2Byr7pg4dc%2FDMowf5&X-Amz-Signature=ed68bc712506662f72377033a42c952c10017aae4a6dccdaba88a1f7ccced84c&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QBBDS5ZC%2F20251206%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251206T053327Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDcXpajvmsd6wz5KAATgo0WhRwsCWo5snIK35w0edRT8wIhALGrGvirZZa1xg5VwgqrfKkO1bKDvSJmKz%2B8C7E%2FavnwKv8DCG4QABoMNjM3NDIzMTgzODA1Igz5i9WLnbPuNrBW0IQq3APgY0WJDLdp%2B%2Fs9T4MBqbOUtL8dC3R4DxDbUOGgamxCx0lz8aEhlC5UqxQiAFeHLB6EeJvKroWI%2BRR3duveAurNY4nG4o%2FLHgCPyUNuMbmcA%2FYalkE6ibTHz3LW%2Bd2KZHqpbC3cqXjj6kchi81ndpwXMY3L1RCBEmt65M3ObxT5dQ%2BrsQ%2F1xX7kSbehdnCKYZQBrmkvQ4h1fWBGc%2BKk56VR5LsSoFCi79yjRpp3yqGbKIwUvJRs1SFzpArPl5PRGhiRJP8QxeYapgy%2BiRuEoCZXCJudUhYqaWOjWgsObEbaVOHDL0EiFJpJio%2FszoFoogxJN4tYbjFzRc9dz6CvAjqwo9Y1NcH2ir5StSJyAkD1C2ox54chWE%2BNdceD44RYxb0ZbIAgP2pecZ9QQUg0cxgnk9zb0dqa3IdbuKK%2BfkdtfYlt0uRjHZNGM44QIwaw2gVIqK0opq5tbSbJRMs3D40Kgtn2HaIG%2FZLwSJ%2FD3oDmyQgPt2V08AzvSg5fSulTlRs1JWWN79coIq0wfxE5Hv0CIt8M722%2FOjOrD6nteJJzE8TDg9%2BcWfeO7uy%2BQk%2BoIoNZl11MUiGHDcoaLUwrhPIuF5NpAVX6uql65R6%2F3KEaTNdof99KvfT0bijZhTDT687JBjqkASEFyMVcz1nF8GW8rgBubfETa%2FSY0bM7XyTMpiYuxpngvyqvpAOJhLjxDfAPX71%2F89aglEDMezrvmSWJGUepHPOI1XoQb%2FUWUwJ3JiVYxHHU2J%2Bu1JifmSrW4SzTi9R9bAW2lywq%2Fw%2FOAgbHcczbP4rWJG1z%2F0xNOEzG8aTf2n8LXKnw%2FsOOUtFO3PPrKGVx6FwY9KsmBGso%2Byr7pg4dc%2FDMowf5&X-Amz-Signature=a2e9fb853af53dbf56aae4ba21177a9c2f3936d7f9f56565733f0ebf2ceb6abe&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QBBDS5ZC%2F20251206%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251206T053327Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDcXpajvmsd6wz5KAATgo0WhRwsCWo5snIK35w0edRT8wIhALGrGvirZZa1xg5VwgqrfKkO1bKDvSJmKz%2B8C7E%2FavnwKv8DCG4QABoMNjM3NDIzMTgzODA1Igz5i9WLnbPuNrBW0IQq3APgY0WJDLdp%2B%2Fs9T4MBqbOUtL8dC3R4DxDbUOGgamxCx0lz8aEhlC5UqxQiAFeHLB6EeJvKroWI%2BRR3duveAurNY4nG4o%2FLHgCPyUNuMbmcA%2FYalkE6ibTHz3LW%2Bd2KZHqpbC3cqXjj6kchi81ndpwXMY3L1RCBEmt65M3ObxT5dQ%2BrsQ%2F1xX7kSbehdnCKYZQBrmkvQ4h1fWBGc%2BKk56VR5LsSoFCi79yjRpp3yqGbKIwUvJRs1SFzpArPl5PRGhiRJP8QxeYapgy%2BiRuEoCZXCJudUhYqaWOjWgsObEbaVOHDL0EiFJpJio%2FszoFoogxJN4tYbjFzRc9dz6CvAjqwo9Y1NcH2ir5StSJyAkD1C2ox54chWE%2BNdceD44RYxb0ZbIAgP2pecZ9QQUg0cxgnk9zb0dqa3IdbuKK%2BfkdtfYlt0uRjHZNGM44QIwaw2gVIqK0opq5tbSbJRMs3D40Kgtn2HaIG%2FZLwSJ%2FD3oDmyQgPt2V08AzvSg5fSulTlRs1JWWN79coIq0wfxE5Hv0CIt8M722%2FOjOrD6nteJJzE8TDg9%2BcWfeO7uy%2BQk%2BoIoNZl11MUiGHDcoaLUwrhPIuF5NpAVX6uql65R6%2F3KEaTNdof99KvfT0bijZhTDT687JBjqkASEFyMVcz1nF8GW8rgBubfETa%2FSY0bM7XyTMpiYuxpngvyqvpAOJhLjxDfAPX71%2F89aglEDMezrvmSWJGUepHPOI1XoQb%2FUWUwJ3JiVYxHHU2J%2Bu1JifmSrW4SzTi9R9bAW2lywq%2Fw%2FOAgbHcczbP4rWJG1z%2F0xNOEzG8aTf2n8LXKnw%2FsOOUtFO3PPrKGVx6FwY9KsmBGso%2Byr7pg4dc%2FDMowf5&X-Amz-Signature=44cffa013080caaf8122c8b0b3ed0d4b208e126702ce24cd098c3c0be86fc8ed&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

