
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466S5FLWIBV%2F20251210%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251210T040402Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEAMaCXVzLXdlc3QtMiJHMEUCICTQjbFCEwFxjMGa74YiLgyMEh7vghoHw%2BRH8m4uRIfKAiEA3fCj1cTrKIgJSkQa24Ud5Ha92PNlwaArbAs3ih4cSPwqiAQIzP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDHN6CwCUVpMidUxpKyrcA49VG18Zs9HZ7SDKse%2B4JTwUUETA4Gr4Fk5NMcBcxoT3elYHG2rH9WsWnYx6vIjQ8pECQmfJ1inV5jFJnHD%2FNOo9e8ENEVimdP2rooRUs7s%2B2IGpDaMsLUw9akIAaU%2Fc2NRMTTi1LX4XxUZrsAQVjyPglsXqpl9kkh7iz1Dac%2F4LIjAnq1%2FTGYxG3nFa%2Fszm%2BM9rSa%2FUpgUP%2Fd7zziM4ZU7MPBJyfcLutYurMiSBKI0wIyOrW1hg%2FAk2PpYJJ13YpAW147zRDgqAdQWs0lhJ5G8AIxDsaqs3sDeEqg%2BznXm9bQlpEXVsyLr2i0zDmCl9XjpgCamP9RQeLpvR%2BHuW4iQikm5TzDRVFyz5Unab6i0K9DIh9EzS5TS%2Be%2BFI1WHnEn40PxIv%2F3lQZdQrEPcIdxbzZngeAIjuT38pvL23RK8p91uBTMOEWBea99M1%2BbAy0ED%2BlZUgaqyoqdGaNf2O%2FRoV7Pvb0QFjtmp057NTa8mp3yThIvsyLOsHIqvKe5vdoNVHziLHNinmBh3v5gu6p1uhMfJ3rSRZrjKHGjzDKqIygYIXDLSPd4I1NNkttlAiQK%2FhmO3UWDzQXvy95QK2Wf6TFIwryuIHghq3mkQd6XvmVGFY0UOWKmZwGxxyMLTK48kGOqUBnCDYYGVlsroZneQ7dlAc04HGFwgL2v1yCMeYRw4A7CvBlQn0PWW%2BenYCekU%2BlLF2S7yIsoFyesGW5cxF1QggVgk92iRcNQIATKmkck1xvwQoAPFdqXNgncVe9LB6Zuv5huO%2Bq%2FsXA490PSlJ5IFEzqKAW6jfprZTJAouHKTBLwjoVOXCKGG%2BYT5oM2d3sxqBAwu%2Fai7aScwQFDtwjGbF6hWNTMi6&X-Amz-Signature=b6f33f1dc2e30567d1c87af9e6f0d225209b36ddc61fefd0633e5872bf1ed5a6&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466S5FLWIBV%2F20251210%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251210T040402Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEAMaCXVzLXdlc3QtMiJHMEUCICTQjbFCEwFxjMGa74YiLgyMEh7vghoHw%2BRH8m4uRIfKAiEA3fCj1cTrKIgJSkQa24Ud5Ha92PNlwaArbAs3ih4cSPwqiAQIzP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDHN6CwCUVpMidUxpKyrcA49VG18Zs9HZ7SDKse%2B4JTwUUETA4Gr4Fk5NMcBcxoT3elYHG2rH9WsWnYx6vIjQ8pECQmfJ1inV5jFJnHD%2FNOo9e8ENEVimdP2rooRUs7s%2B2IGpDaMsLUw9akIAaU%2Fc2NRMTTi1LX4XxUZrsAQVjyPglsXqpl9kkh7iz1Dac%2F4LIjAnq1%2FTGYxG3nFa%2Fszm%2BM9rSa%2FUpgUP%2Fd7zziM4ZU7MPBJyfcLutYurMiSBKI0wIyOrW1hg%2FAk2PpYJJ13YpAW147zRDgqAdQWs0lhJ5G8AIxDsaqs3sDeEqg%2BznXm9bQlpEXVsyLr2i0zDmCl9XjpgCamP9RQeLpvR%2BHuW4iQikm5TzDRVFyz5Unab6i0K9DIh9EzS5TS%2Be%2BFI1WHnEn40PxIv%2F3lQZdQrEPcIdxbzZngeAIjuT38pvL23RK8p91uBTMOEWBea99M1%2BbAy0ED%2BlZUgaqyoqdGaNf2O%2FRoV7Pvb0QFjtmp057NTa8mp3yThIvsyLOsHIqvKe5vdoNVHziLHNinmBh3v5gu6p1uhMfJ3rSRZrjKHGjzDKqIygYIXDLSPd4I1NNkttlAiQK%2FhmO3UWDzQXvy95QK2Wf6TFIwryuIHghq3mkQd6XvmVGFY0UOWKmZwGxxyMLTK48kGOqUBnCDYYGVlsroZneQ7dlAc04HGFwgL2v1yCMeYRw4A7CvBlQn0PWW%2BenYCekU%2BlLF2S7yIsoFyesGW5cxF1QggVgk92iRcNQIATKmkck1xvwQoAPFdqXNgncVe9LB6Zuv5huO%2Bq%2FsXA490PSlJ5IFEzqKAW6jfprZTJAouHKTBLwjoVOXCKGG%2BYT5oM2d3sxqBAwu%2Fai7aScwQFDtwjGbF6hWNTMi6&X-Amz-Signature=4249db574a71d277c779b9ca981729702d55b9eac7ae2821f964e00769ee281e&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466S5FLWIBV%2F20251210%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251210T040402Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEAMaCXVzLXdlc3QtMiJHMEUCICTQjbFCEwFxjMGa74YiLgyMEh7vghoHw%2BRH8m4uRIfKAiEA3fCj1cTrKIgJSkQa24Ud5Ha92PNlwaArbAs3ih4cSPwqiAQIzP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDHN6CwCUVpMidUxpKyrcA49VG18Zs9HZ7SDKse%2B4JTwUUETA4Gr4Fk5NMcBcxoT3elYHG2rH9WsWnYx6vIjQ8pECQmfJ1inV5jFJnHD%2FNOo9e8ENEVimdP2rooRUs7s%2B2IGpDaMsLUw9akIAaU%2Fc2NRMTTi1LX4XxUZrsAQVjyPglsXqpl9kkh7iz1Dac%2F4LIjAnq1%2FTGYxG3nFa%2Fszm%2BM9rSa%2FUpgUP%2Fd7zziM4ZU7MPBJyfcLutYurMiSBKI0wIyOrW1hg%2FAk2PpYJJ13YpAW147zRDgqAdQWs0lhJ5G8AIxDsaqs3sDeEqg%2BznXm9bQlpEXVsyLr2i0zDmCl9XjpgCamP9RQeLpvR%2BHuW4iQikm5TzDRVFyz5Unab6i0K9DIh9EzS5TS%2Be%2BFI1WHnEn40PxIv%2F3lQZdQrEPcIdxbzZngeAIjuT38pvL23RK8p91uBTMOEWBea99M1%2BbAy0ED%2BlZUgaqyoqdGaNf2O%2FRoV7Pvb0QFjtmp057NTa8mp3yThIvsyLOsHIqvKe5vdoNVHziLHNinmBh3v5gu6p1uhMfJ3rSRZrjKHGjzDKqIygYIXDLSPd4I1NNkttlAiQK%2FhmO3UWDzQXvy95QK2Wf6TFIwryuIHghq3mkQd6XvmVGFY0UOWKmZwGxxyMLTK48kGOqUBnCDYYGVlsroZneQ7dlAc04HGFwgL2v1yCMeYRw4A7CvBlQn0PWW%2BenYCekU%2BlLF2S7yIsoFyesGW5cxF1QggVgk92iRcNQIATKmkck1xvwQoAPFdqXNgncVe9LB6Zuv5huO%2Bq%2FsXA490PSlJ5IFEzqKAW6jfprZTJAouHKTBLwjoVOXCKGG%2BYT5oM2d3sxqBAwu%2Fai7aScwQFDtwjGbF6hWNTMi6&X-Amz-Signature=f15403f69456f5980bf3a39b32c509c49df2918d7548c66c6469dfd836f86ca2&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466S5FLWIBV%2F20251210%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251210T040402Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEAMaCXVzLXdlc3QtMiJHMEUCICTQjbFCEwFxjMGa74YiLgyMEh7vghoHw%2BRH8m4uRIfKAiEA3fCj1cTrKIgJSkQa24Ud5Ha92PNlwaArbAs3ih4cSPwqiAQIzP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDHN6CwCUVpMidUxpKyrcA49VG18Zs9HZ7SDKse%2B4JTwUUETA4Gr4Fk5NMcBcxoT3elYHG2rH9WsWnYx6vIjQ8pECQmfJ1inV5jFJnHD%2FNOo9e8ENEVimdP2rooRUs7s%2B2IGpDaMsLUw9akIAaU%2Fc2NRMTTi1LX4XxUZrsAQVjyPglsXqpl9kkh7iz1Dac%2F4LIjAnq1%2FTGYxG3nFa%2Fszm%2BM9rSa%2FUpgUP%2Fd7zziM4ZU7MPBJyfcLutYurMiSBKI0wIyOrW1hg%2FAk2PpYJJ13YpAW147zRDgqAdQWs0lhJ5G8AIxDsaqs3sDeEqg%2BznXm9bQlpEXVsyLr2i0zDmCl9XjpgCamP9RQeLpvR%2BHuW4iQikm5TzDRVFyz5Unab6i0K9DIh9EzS5TS%2Be%2BFI1WHnEn40PxIv%2F3lQZdQrEPcIdxbzZngeAIjuT38pvL23RK8p91uBTMOEWBea99M1%2BbAy0ED%2BlZUgaqyoqdGaNf2O%2FRoV7Pvb0QFjtmp057NTa8mp3yThIvsyLOsHIqvKe5vdoNVHziLHNinmBh3v5gu6p1uhMfJ3rSRZrjKHGjzDKqIygYIXDLSPd4I1NNkttlAiQK%2FhmO3UWDzQXvy95QK2Wf6TFIwryuIHghq3mkQd6XvmVGFY0UOWKmZwGxxyMLTK48kGOqUBnCDYYGVlsroZneQ7dlAc04HGFwgL2v1yCMeYRw4A7CvBlQn0PWW%2BenYCekU%2BlLF2S7yIsoFyesGW5cxF1QggVgk92iRcNQIATKmkck1xvwQoAPFdqXNgncVe9LB6Zuv5huO%2Bq%2FsXA490PSlJ5IFEzqKAW6jfprZTJAouHKTBLwjoVOXCKGG%2BYT5oM2d3sxqBAwu%2Fai7aScwQFDtwjGbF6hWNTMi6&X-Amz-Signature=9fed00f86842bea749d58792e85784b147d20a1470b3f292ce0afabcc5a51b54&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

