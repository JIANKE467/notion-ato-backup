
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4664YKF3HSZ%2F20251227%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251227T040438Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDaSFqt%2FjFunF3z6uyZKNes5If1wIVUqTce2WHu5rfrpgIgWHn%2FudJFjQSirFEGC6pnWAzNn5lk6dJSqj7xWbxIKccq%2FwMIYhAAGgw2Mzc0MjMxODM4MDUiDKFDuUDLsJX1%2BhQbPSrcAyoeIXVnJqKPiTcTRBVoEeZQiWeB5%2BYYnhKeEalENWIu45jpXDKIQZ9o1shmU63O4AX6P1Ryql5W1Yohh%2BOF8dob1Syb%2FoLeNxjAEsR2hYI4kLNo6KyO1EIBfSB7U8dWxpKCU3nuaC%2BlyuDgN1YKCIZChVJf8hx0qVTTluLxKhMfdC%2BmgMHkOc6PZEGsmdRKQllocQoYavhnJD%2BdyvN6tVhUEBjuaaKDkCxJ%2F6FCMSWU3HGbieLZtQxDQYO2eAHmAo5hhO0%2FwvgYWw1nBJmdfqAYwFe4sUrBOsVAqXjZnHVoJ1es7bActYUQu5zFwP3T6vsX0ivDf3mT%2FDYtdIW2kmnhaztZvriHHce0EitrSxNR%2FXeHry6ESbQT03pgP4RmqfcEALlSQOoOeKN8aiZpzH5m97Dr8tX5DIa9RmvMq29UF13F7FafTjCm59yYgcNi5Mvah66CWF4CGClrPid0v58Xizafa6fhQt8PidbF0xvvftFZv4TUbDhTuFAT0%2F3MfUKtan8MwRFJ5UYQpeppfUcf91hITzDeAHKzdFTfCioi9%2BRR8OPPATf79F8POkw%2Bp1VODes2V9N79eOFFw6GezSHcMZrGegHa6yrey35k7SRpViOwsY1wTuGrE2vMJjWvMoGOqUBMOXO3hzO48R%2F2NZHD%2FYiZX7F1bKCQsvGpArAo5RF9shtBw8VjeaV77oE%2FSdsRVQJnnkmvwhG6pS1ijRzzN7X5FogplQirtTz5j0I522d27mwHDnfHN3yBKcMnttC107WX%2FkY6bPaWyCEM38TJF9%2FnU72oDgXwc%2BLKN5BC1RFFAiOV7U%2FP8MYC%2BQLARR4bHlq%2BjwWzoivp6JCC7RaiU0D9iKUUQkh&X-Amz-Signature=bfb34d03a2d61fc7798088bb1ba70ebb8c06859808fd88655d1312225247452e&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4664YKF3HSZ%2F20251227%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251227T040438Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDaSFqt%2FjFunF3z6uyZKNes5If1wIVUqTce2WHu5rfrpgIgWHn%2FudJFjQSirFEGC6pnWAzNn5lk6dJSqj7xWbxIKccq%2FwMIYhAAGgw2Mzc0MjMxODM4MDUiDKFDuUDLsJX1%2BhQbPSrcAyoeIXVnJqKPiTcTRBVoEeZQiWeB5%2BYYnhKeEalENWIu45jpXDKIQZ9o1shmU63O4AX6P1Ryql5W1Yohh%2BOF8dob1Syb%2FoLeNxjAEsR2hYI4kLNo6KyO1EIBfSB7U8dWxpKCU3nuaC%2BlyuDgN1YKCIZChVJf8hx0qVTTluLxKhMfdC%2BmgMHkOc6PZEGsmdRKQllocQoYavhnJD%2BdyvN6tVhUEBjuaaKDkCxJ%2F6FCMSWU3HGbieLZtQxDQYO2eAHmAo5hhO0%2FwvgYWw1nBJmdfqAYwFe4sUrBOsVAqXjZnHVoJ1es7bActYUQu5zFwP3T6vsX0ivDf3mT%2FDYtdIW2kmnhaztZvriHHce0EitrSxNR%2FXeHry6ESbQT03pgP4RmqfcEALlSQOoOeKN8aiZpzH5m97Dr8tX5DIa9RmvMq29UF13F7FafTjCm59yYgcNi5Mvah66CWF4CGClrPid0v58Xizafa6fhQt8PidbF0xvvftFZv4TUbDhTuFAT0%2F3MfUKtan8MwRFJ5UYQpeppfUcf91hITzDeAHKzdFTfCioi9%2BRR8OPPATf79F8POkw%2Bp1VODes2V9N79eOFFw6GezSHcMZrGegHa6yrey35k7SRpViOwsY1wTuGrE2vMJjWvMoGOqUBMOXO3hzO48R%2F2NZHD%2FYiZX7F1bKCQsvGpArAo5RF9shtBw8VjeaV77oE%2FSdsRVQJnnkmvwhG6pS1ijRzzN7X5FogplQirtTz5j0I522d27mwHDnfHN3yBKcMnttC107WX%2FkY6bPaWyCEM38TJF9%2FnU72oDgXwc%2BLKN5BC1RFFAiOV7U%2FP8MYC%2BQLARR4bHlq%2BjwWzoivp6JCC7RaiU0D9iKUUQkh&X-Amz-Signature=f13a5cef0c8bb5d171fcfca9b5d0cfbaea2de7f07fe1b328ebce90c4d6fc837b&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4664YKF3HSZ%2F20251227%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251227T040438Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDaSFqt%2FjFunF3z6uyZKNes5If1wIVUqTce2WHu5rfrpgIgWHn%2FudJFjQSirFEGC6pnWAzNn5lk6dJSqj7xWbxIKccq%2FwMIYhAAGgw2Mzc0MjMxODM4MDUiDKFDuUDLsJX1%2BhQbPSrcAyoeIXVnJqKPiTcTRBVoEeZQiWeB5%2BYYnhKeEalENWIu45jpXDKIQZ9o1shmU63O4AX6P1Ryql5W1Yohh%2BOF8dob1Syb%2FoLeNxjAEsR2hYI4kLNo6KyO1EIBfSB7U8dWxpKCU3nuaC%2BlyuDgN1YKCIZChVJf8hx0qVTTluLxKhMfdC%2BmgMHkOc6PZEGsmdRKQllocQoYavhnJD%2BdyvN6tVhUEBjuaaKDkCxJ%2F6FCMSWU3HGbieLZtQxDQYO2eAHmAo5hhO0%2FwvgYWw1nBJmdfqAYwFe4sUrBOsVAqXjZnHVoJ1es7bActYUQu5zFwP3T6vsX0ivDf3mT%2FDYtdIW2kmnhaztZvriHHce0EitrSxNR%2FXeHry6ESbQT03pgP4RmqfcEALlSQOoOeKN8aiZpzH5m97Dr8tX5DIa9RmvMq29UF13F7FafTjCm59yYgcNi5Mvah66CWF4CGClrPid0v58Xizafa6fhQt8PidbF0xvvftFZv4TUbDhTuFAT0%2F3MfUKtan8MwRFJ5UYQpeppfUcf91hITzDeAHKzdFTfCioi9%2BRR8OPPATf79F8POkw%2Bp1VODes2V9N79eOFFw6GezSHcMZrGegHa6yrey35k7SRpViOwsY1wTuGrE2vMJjWvMoGOqUBMOXO3hzO48R%2F2NZHD%2FYiZX7F1bKCQsvGpArAo5RF9shtBw8VjeaV77oE%2FSdsRVQJnnkmvwhG6pS1ijRzzN7X5FogplQirtTz5j0I522d27mwHDnfHN3yBKcMnttC107WX%2FkY6bPaWyCEM38TJF9%2FnU72oDgXwc%2BLKN5BC1RFFAiOV7U%2FP8MYC%2BQLARR4bHlq%2BjwWzoivp6JCC7RaiU0D9iKUUQkh&X-Amz-Signature=cfee0dc434de090fcfb398c4c10ba5902d01f48d57490bf614b3480f6bb61eb3&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4664YKF3HSZ%2F20251227%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251227T040438Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDaSFqt%2FjFunF3z6uyZKNes5If1wIVUqTce2WHu5rfrpgIgWHn%2FudJFjQSirFEGC6pnWAzNn5lk6dJSqj7xWbxIKccq%2FwMIYhAAGgw2Mzc0MjMxODM4MDUiDKFDuUDLsJX1%2BhQbPSrcAyoeIXVnJqKPiTcTRBVoEeZQiWeB5%2BYYnhKeEalENWIu45jpXDKIQZ9o1shmU63O4AX6P1Ryql5W1Yohh%2BOF8dob1Syb%2FoLeNxjAEsR2hYI4kLNo6KyO1EIBfSB7U8dWxpKCU3nuaC%2BlyuDgN1YKCIZChVJf8hx0qVTTluLxKhMfdC%2BmgMHkOc6PZEGsmdRKQllocQoYavhnJD%2BdyvN6tVhUEBjuaaKDkCxJ%2F6FCMSWU3HGbieLZtQxDQYO2eAHmAo5hhO0%2FwvgYWw1nBJmdfqAYwFe4sUrBOsVAqXjZnHVoJ1es7bActYUQu5zFwP3T6vsX0ivDf3mT%2FDYtdIW2kmnhaztZvriHHce0EitrSxNR%2FXeHry6ESbQT03pgP4RmqfcEALlSQOoOeKN8aiZpzH5m97Dr8tX5DIa9RmvMq29UF13F7FafTjCm59yYgcNi5Mvah66CWF4CGClrPid0v58Xizafa6fhQt8PidbF0xvvftFZv4TUbDhTuFAT0%2F3MfUKtan8MwRFJ5UYQpeppfUcf91hITzDeAHKzdFTfCioi9%2BRR8OPPATf79F8POkw%2Bp1VODes2V9N79eOFFw6GezSHcMZrGegHa6yrey35k7SRpViOwsY1wTuGrE2vMJjWvMoGOqUBMOXO3hzO48R%2F2NZHD%2FYiZX7F1bKCQsvGpArAo5RF9shtBw8VjeaV77oE%2FSdsRVQJnnkmvwhG6pS1ijRzzN7X5FogplQirtTz5j0I522d27mwHDnfHN3yBKcMnttC107WX%2FkY6bPaWyCEM38TJF9%2FnU72oDgXwc%2BLKN5BC1RFFAiOV7U%2FP8MYC%2BQLARR4bHlq%2BjwWzoivp6JCC7RaiU0D9iKUUQkh&X-Amz-Signature=3adf12e3867b7e11c602a39b68f43528b45a2d29246656bf238196bc6f3efdb0&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

