
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466THBTEBKT%2F20260102%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260102T041058Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECkaCXVzLXdlc3QtMiJHMEUCIG9QHn50XqhmPh0%2BQrrP%2B0M6MfgViRwcJzMR5aIW4SOBAiEA%2F5af8f4N0rDtRCmUTOfSnZTOi5gAHxDsdqD1xqhFhIsqiAQI8v%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDC8%2BzN3u1%2BT365%2FUdyrcA5PebdMkNmbdpalzg1aJm11twA%2FGSbFdYumILhJMPHsfSS%2BGjOuOUxiIkmLS7JysPH6r4VUIGU9%2F1tdg54L%2BR%2FqszbhP0IY4uf0DozlnlM6Z%2Bh%2FxsnrsdBBocyULkbbxX1%2FONUozmxjoijp%2BJFT0n8fKsfIv8T3gmdVHn6dp8SW1vfVbfHxE6TN%2BQ6gc%2FRQCBWPSSa3WK87nVB0Xj%2FYtI3CpZnbknkYNJIrCzi8QH3%2FSQRgTrxqIc2CiCmAI8sARgpkCQFxd%2B7cTZ2tiOW%2B8ak9DYyJn3eg3JIQ2u8W6G4SCuMEcORYEkmcc%2BnH2lP65VRLbNa6zebduQDHOP014%2BFZMDA8EgiGuxpVmm%2By39PFkGk3ya3Ex%2FAFa5vAjUMh8eoKAFbuhGKVezx80BWvi4UtGIQ4yAm2nByVA6Kf1%2BSCp%2F%2Ff5NHxNNiYR4oHEY9gOM0fSc7a2LaPQzJSRRYxsAKGfvT6aBuSNww7FkOUp7ZOK8J1NsHbJeZLRddIAiXEBSOtrDiMLpoKgXoV5uzq4F41kOKzNIZ2eZ0beUVbEZqd5vrz2t44pPcnLP950xIfcVoYxm1I2vBVVAr%2Bg2Don204wD9F6nhdsbWaI%2FPVK6mvlXDJ11Sj51CX3k6PmMMai3MoGOqUBTizNStkkWvkvJsJyzol6QJSIPYWwIXVjAoJjsimIth%2BtTIau3p43AlTTJ2zwSCHyiKXhmP7yclMh%2FBiRaA22%2Boddw8fgE3mjrQFEPCYRKyCFyHRo6WOeU271ppHCB3iGzUI2RQGVbPqKQvueYBdx74LMjDR1hEMa0CraMNrR9aTOyvNuHjRF2sRHn7pdqvqkfCa02hoFP68EtfB3RsbJzcVtkXvr&X-Amz-Signature=72d5598324b46d68b1d5fe3cdb9a7c5b9280bd04656caca4b7cb78f3bbb56227&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466THBTEBKT%2F20260102%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260102T041058Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECkaCXVzLXdlc3QtMiJHMEUCIG9QHn50XqhmPh0%2BQrrP%2B0M6MfgViRwcJzMR5aIW4SOBAiEA%2F5af8f4N0rDtRCmUTOfSnZTOi5gAHxDsdqD1xqhFhIsqiAQI8v%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDC8%2BzN3u1%2BT365%2FUdyrcA5PebdMkNmbdpalzg1aJm11twA%2FGSbFdYumILhJMPHsfSS%2BGjOuOUxiIkmLS7JysPH6r4VUIGU9%2F1tdg54L%2BR%2FqszbhP0IY4uf0DozlnlM6Z%2Bh%2FxsnrsdBBocyULkbbxX1%2FONUozmxjoijp%2BJFT0n8fKsfIv8T3gmdVHn6dp8SW1vfVbfHxE6TN%2BQ6gc%2FRQCBWPSSa3WK87nVB0Xj%2FYtI3CpZnbknkYNJIrCzi8QH3%2FSQRgTrxqIc2CiCmAI8sARgpkCQFxd%2B7cTZ2tiOW%2B8ak9DYyJn3eg3JIQ2u8W6G4SCuMEcORYEkmcc%2BnH2lP65VRLbNa6zebduQDHOP014%2BFZMDA8EgiGuxpVmm%2By39PFkGk3ya3Ex%2FAFa5vAjUMh8eoKAFbuhGKVezx80BWvi4UtGIQ4yAm2nByVA6Kf1%2BSCp%2F%2Ff5NHxNNiYR4oHEY9gOM0fSc7a2LaPQzJSRRYxsAKGfvT6aBuSNww7FkOUp7ZOK8J1NsHbJeZLRddIAiXEBSOtrDiMLpoKgXoV5uzq4F41kOKzNIZ2eZ0beUVbEZqd5vrz2t44pPcnLP950xIfcVoYxm1I2vBVVAr%2Bg2Don204wD9F6nhdsbWaI%2FPVK6mvlXDJ11Sj51CX3k6PmMMai3MoGOqUBTizNStkkWvkvJsJyzol6QJSIPYWwIXVjAoJjsimIth%2BtTIau3p43AlTTJ2zwSCHyiKXhmP7yclMh%2FBiRaA22%2Boddw8fgE3mjrQFEPCYRKyCFyHRo6WOeU271ppHCB3iGzUI2RQGVbPqKQvueYBdx74LMjDR1hEMa0CraMNrR9aTOyvNuHjRF2sRHn7pdqvqkfCa02hoFP68EtfB3RsbJzcVtkXvr&X-Amz-Signature=abeb8ab01fe048bb1c7f060d19624ddd759c1ad372a46051333d423b9278175c&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466THBTEBKT%2F20260102%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260102T041058Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECkaCXVzLXdlc3QtMiJHMEUCIG9QHn50XqhmPh0%2BQrrP%2B0M6MfgViRwcJzMR5aIW4SOBAiEA%2F5af8f4N0rDtRCmUTOfSnZTOi5gAHxDsdqD1xqhFhIsqiAQI8v%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDC8%2BzN3u1%2BT365%2FUdyrcA5PebdMkNmbdpalzg1aJm11twA%2FGSbFdYumILhJMPHsfSS%2BGjOuOUxiIkmLS7JysPH6r4VUIGU9%2F1tdg54L%2BR%2FqszbhP0IY4uf0DozlnlM6Z%2Bh%2FxsnrsdBBocyULkbbxX1%2FONUozmxjoijp%2BJFT0n8fKsfIv8T3gmdVHn6dp8SW1vfVbfHxE6TN%2BQ6gc%2FRQCBWPSSa3WK87nVB0Xj%2FYtI3CpZnbknkYNJIrCzi8QH3%2FSQRgTrxqIc2CiCmAI8sARgpkCQFxd%2B7cTZ2tiOW%2B8ak9DYyJn3eg3JIQ2u8W6G4SCuMEcORYEkmcc%2BnH2lP65VRLbNa6zebduQDHOP014%2BFZMDA8EgiGuxpVmm%2By39PFkGk3ya3Ex%2FAFa5vAjUMh8eoKAFbuhGKVezx80BWvi4UtGIQ4yAm2nByVA6Kf1%2BSCp%2F%2Ff5NHxNNiYR4oHEY9gOM0fSc7a2LaPQzJSRRYxsAKGfvT6aBuSNww7FkOUp7ZOK8J1NsHbJeZLRddIAiXEBSOtrDiMLpoKgXoV5uzq4F41kOKzNIZ2eZ0beUVbEZqd5vrz2t44pPcnLP950xIfcVoYxm1I2vBVVAr%2Bg2Don204wD9F6nhdsbWaI%2FPVK6mvlXDJ11Sj51CX3k6PmMMai3MoGOqUBTizNStkkWvkvJsJyzol6QJSIPYWwIXVjAoJjsimIth%2BtTIau3p43AlTTJ2zwSCHyiKXhmP7yclMh%2FBiRaA22%2Boddw8fgE3mjrQFEPCYRKyCFyHRo6WOeU271ppHCB3iGzUI2RQGVbPqKQvueYBdx74LMjDR1hEMa0CraMNrR9aTOyvNuHjRF2sRHn7pdqvqkfCa02hoFP68EtfB3RsbJzcVtkXvr&X-Amz-Signature=c0a57b12da86f5b21e5f157070faba0c56b8bfc85728946f712fcc08c98ec4a0&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466THBTEBKT%2F20260102%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260102T041058Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECkaCXVzLXdlc3QtMiJHMEUCIG9QHn50XqhmPh0%2BQrrP%2B0M6MfgViRwcJzMR5aIW4SOBAiEA%2F5af8f4N0rDtRCmUTOfSnZTOi5gAHxDsdqD1xqhFhIsqiAQI8v%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDC8%2BzN3u1%2BT365%2FUdyrcA5PebdMkNmbdpalzg1aJm11twA%2FGSbFdYumILhJMPHsfSS%2BGjOuOUxiIkmLS7JysPH6r4VUIGU9%2F1tdg54L%2BR%2FqszbhP0IY4uf0DozlnlM6Z%2Bh%2FxsnrsdBBocyULkbbxX1%2FONUozmxjoijp%2BJFT0n8fKsfIv8T3gmdVHn6dp8SW1vfVbfHxE6TN%2BQ6gc%2FRQCBWPSSa3WK87nVB0Xj%2FYtI3CpZnbknkYNJIrCzi8QH3%2FSQRgTrxqIc2CiCmAI8sARgpkCQFxd%2B7cTZ2tiOW%2B8ak9DYyJn3eg3JIQ2u8W6G4SCuMEcORYEkmcc%2BnH2lP65VRLbNa6zebduQDHOP014%2BFZMDA8EgiGuxpVmm%2By39PFkGk3ya3Ex%2FAFa5vAjUMh8eoKAFbuhGKVezx80BWvi4UtGIQ4yAm2nByVA6Kf1%2BSCp%2F%2Ff5NHxNNiYR4oHEY9gOM0fSc7a2LaPQzJSRRYxsAKGfvT6aBuSNww7FkOUp7ZOK8J1NsHbJeZLRddIAiXEBSOtrDiMLpoKgXoV5uzq4F41kOKzNIZ2eZ0beUVbEZqd5vrz2t44pPcnLP950xIfcVoYxm1I2vBVVAr%2Bg2Don204wD9F6nhdsbWaI%2FPVK6mvlXDJ11Sj51CX3k6PmMMai3MoGOqUBTizNStkkWvkvJsJyzol6QJSIPYWwIXVjAoJjsimIth%2BtTIau3p43AlTTJ2zwSCHyiKXhmP7yclMh%2FBiRaA22%2Boddw8fgE3mjrQFEPCYRKyCFyHRo6WOeU271ppHCB3iGzUI2RQGVbPqKQvueYBdx74LMjDR1hEMa0CraMNrR9aTOyvNuHjRF2sRHn7pdqvqkfCa02hoFP68EtfB3RsbJzcVtkXvr&X-Amz-Signature=565273e8671544834a739598061bb7822c9bf86f7a6225b8d236b87823dab275&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

