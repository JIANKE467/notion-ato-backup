
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466WAHRMIWM%2F20260111%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260111T042157Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEAUaCXVzLXdlc3QtMiJGMEQCICszGUP8SEzaThtQywws0r7PfGRVN6JGfvEdwNaenRCYAiBCOS0NGS1eUOf593SEy5t6ckF52XXmFmmPWls2cF1OsSqIBAjN%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDYzNzQyMzE4MzgwNSIMieBv8%2B%2FkWHy3lSA2KtwDtQeiHJjSeogmtJDKMGXGxufDRtEzUS0Qak5JYhA%2Fp4OKTXDFkff0WFjqvp26WwrHIzRe1Tp%2BQzif5%2FoBacC2Q%2B5zyqvwjKG%2FZGQ0nZtpZcYTFuvkErAhOnTZF%2BSgMXKG1E293bjR5qXx904aBtUkTlAu22ZKPX1rYJrNdRJmKobGKEXbxofaBmZTDgqROgddQHwDp81qsuHLliaR7H%2BEP4rLZpQXEJh03ptpq0ZE7jQLIEYUzo0MKlHxqHRi85Cp8WGfXAtltK0dpRMTwk%2BFOenFpfmGqUOvZKtYSoJsSS6ap7HNYRUiJ4YTNk2Gvj%2FSl11tM6iAiSltZUdVgq%2FkoONw0NLGxokaP2QVue2kr5Fpja9AWVPxwjL06%2FVI3TvfMPb95Divwmw5LcjL%2BSU3TM1rFz4EkrkuZiyYXD3PnEgyeuf1CjKJ0tJ0YG7sry0L84pMiZDInpDBShcWP9lXH16SuP00MVviKrzQSgqEYQa7J1nOAIZ0ihFuBBN6PKLIztEvN1jGzeLjbraqm64UnXBwZjwWaExBvqMXQz2GJS21ESDOiLodpsdMtxe3rV9xxCZb9REeXOgjvPIXO38YmO%2BrzLDbloM4nhSyYIkWKwQUgoyO9sAtOQDQ0RAw%2BciMywY6pgGb0ScesDvKwLf56Z2i%2FsMjBWVBR3ARUqUFh68rEJtJeHfaiwwspyeNvqalzDa6nS5lnLEHF1Hp6k3yAZSDi6RCUMs%2FegOpF%2BSxf3HIrgqdMaAzynTVjIH5JRmxkcXQoN%2FWcmaT12wgTRr6c29XNB9Tdorkv9smElJ2mOTHIQA5bxOPGyKSmzcD7lYsGeWQyUEkjTbxATLRud%2FUxSF%2FHkx7WbG%2Btw%2Bc&X-Amz-Signature=8928f71e2592d293409e6d0082e095e4f3d46fc97f1bd9a343cda993f5603c59&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466WAHRMIWM%2F20260111%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260111T042157Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEAUaCXVzLXdlc3QtMiJGMEQCICszGUP8SEzaThtQywws0r7PfGRVN6JGfvEdwNaenRCYAiBCOS0NGS1eUOf593SEy5t6ckF52XXmFmmPWls2cF1OsSqIBAjN%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDYzNzQyMzE4MzgwNSIMieBv8%2B%2FkWHy3lSA2KtwDtQeiHJjSeogmtJDKMGXGxufDRtEzUS0Qak5JYhA%2Fp4OKTXDFkff0WFjqvp26WwrHIzRe1Tp%2BQzif5%2FoBacC2Q%2B5zyqvwjKG%2FZGQ0nZtpZcYTFuvkErAhOnTZF%2BSgMXKG1E293bjR5qXx904aBtUkTlAu22ZKPX1rYJrNdRJmKobGKEXbxofaBmZTDgqROgddQHwDp81qsuHLliaR7H%2BEP4rLZpQXEJh03ptpq0ZE7jQLIEYUzo0MKlHxqHRi85Cp8WGfXAtltK0dpRMTwk%2BFOenFpfmGqUOvZKtYSoJsSS6ap7HNYRUiJ4YTNk2Gvj%2FSl11tM6iAiSltZUdVgq%2FkoONw0NLGxokaP2QVue2kr5Fpja9AWVPxwjL06%2FVI3TvfMPb95Divwmw5LcjL%2BSU3TM1rFz4EkrkuZiyYXD3PnEgyeuf1CjKJ0tJ0YG7sry0L84pMiZDInpDBShcWP9lXH16SuP00MVviKrzQSgqEYQa7J1nOAIZ0ihFuBBN6PKLIztEvN1jGzeLjbraqm64UnXBwZjwWaExBvqMXQz2GJS21ESDOiLodpsdMtxe3rV9xxCZb9REeXOgjvPIXO38YmO%2BrzLDbloM4nhSyYIkWKwQUgoyO9sAtOQDQ0RAw%2BciMywY6pgGb0ScesDvKwLf56Z2i%2FsMjBWVBR3ARUqUFh68rEJtJeHfaiwwspyeNvqalzDa6nS5lnLEHF1Hp6k3yAZSDi6RCUMs%2FegOpF%2BSxf3HIrgqdMaAzynTVjIH5JRmxkcXQoN%2FWcmaT12wgTRr6c29XNB9Tdorkv9smElJ2mOTHIQA5bxOPGyKSmzcD7lYsGeWQyUEkjTbxATLRud%2FUxSF%2FHkx7WbG%2Btw%2Bc&X-Amz-Signature=c3c060ea203ace1af34ce799c54fdda06a3c8f1a5ffc5f7c8ece4ab14c08f691&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466WAHRMIWM%2F20260111%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260111T042157Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEAUaCXVzLXdlc3QtMiJGMEQCICszGUP8SEzaThtQywws0r7PfGRVN6JGfvEdwNaenRCYAiBCOS0NGS1eUOf593SEy5t6ckF52XXmFmmPWls2cF1OsSqIBAjN%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDYzNzQyMzE4MzgwNSIMieBv8%2B%2FkWHy3lSA2KtwDtQeiHJjSeogmtJDKMGXGxufDRtEzUS0Qak5JYhA%2Fp4OKTXDFkff0WFjqvp26WwrHIzRe1Tp%2BQzif5%2FoBacC2Q%2B5zyqvwjKG%2FZGQ0nZtpZcYTFuvkErAhOnTZF%2BSgMXKG1E293bjR5qXx904aBtUkTlAu22ZKPX1rYJrNdRJmKobGKEXbxofaBmZTDgqROgddQHwDp81qsuHLliaR7H%2BEP4rLZpQXEJh03ptpq0ZE7jQLIEYUzo0MKlHxqHRi85Cp8WGfXAtltK0dpRMTwk%2BFOenFpfmGqUOvZKtYSoJsSS6ap7HNYRUiJ4YTNk2Gvj%2FSl11tM6iAiSltZUdVgq%2FkoONw0NLGxokaP2QVue2kr5Fpja9AWVPxwjL06%2FVI3TvfMPb95Divwmw5LcjL%2BSU3TM1rFz4EkrkuZiyYXD3PnEgyeuf1CjKJ0tJ0YG7sry0L84pMiZDInpDBShcWP9lXH16SuP00MVviKrzQSgqEYQa7J1nOAIZ0ihFuBBN6PKLIztEvN1jGzeLjbraqm64UnXBwZjwWaExBvqMXQz2GJS21ESDOiLodpsdMtxe3rV9xxCZb9REeXOgjvPIXO38YmO%2BrzLDbloM4nhSyYIkWKwQUgoyO9sAtOQDQ0RAw%2BciMywY6pgGb0ScesDvKwLf56Z2i%2FsMjBWVBR3ARUqUFh68rEJtJeHfaiwwspyeNvqalzDa6nS5lnLEHF1Hp6k3yAZSDi6RCUMs%2FegOpF%2BSxf3HIrgqdMaAzynTVjIH5JRmxkcXQoN%2FWcmaT12wgTRr6c29XNB9Tdorkv9smElJ2mOTHIQA5bxOPGyKSmzcD7lYsGeWQyUEkjTbxATLRud%2FUxSF%2FHkx7WbG%2Btw%2Bc&X-Amz-Signature=45117f6f579a8320cc473d449b78943204177d0fa736c7960364d9c64f448e02&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466WAHRMIWM%2F20260111%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260111T042157Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEAUaCXVzLXdlc3QtMiJGMEQCICszGUP8SEzaThtQywws0r7PfGRVN6JGfvEdwNaenRCYAiBCOS0NGS1eUOf593SEy5t6ckF52XXmFmmPWls2cF1OsSqIBAjN%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDYzNzQyMzE4MzgwNSIMieBv8%2B%2FkWHy3lSA2KtwDtQeiHJjSeogmtJDKMGXGxufDRtEzUS0Qak5JYhA%2Fp4OKTXDFkff0WFjqvp26WwrHIzRe1Tp%2BQzif5%2FoBacC2Q%2B5zyqvwjKG%2FZGQ0nZtpZcYTFuvkErAhOnTZF%2BSgMXKG1E293bjR5qXx904aBtUkTlAu22ZKPX1rYJrNdRJmKobGKEXbxofaBmZTDgqROgddQHwDp81qsuHLliaR7H%2BEP4rLZpQXEJh03ptpq0ZE7jQLIEYUzo0MKlHxqHRi85Cp8WGfXAtltK0dpRMTwk%2BFOenFpfmGqUOvZKtYSoJsSS6ap7HNYRUiJ4YTNk2Gvj%2FSl11tM6iAiSltZUdVgq%2FkoONw0NLGxokaP2QVue2kr5Fpja9AWVPxwjL06%2FVI3TvfMPb95Divwmw5LcjL%2BSU3TM1rFz4EkrkuZiyYXD3PnEgyeuf1CjKJ0tJ0YG7sry0L84pMiZDInpDBShcWP9lXH16SuP00MVviKrzQSgqEYQa7J1nOAIZ0ihFuBBN6PKLIztEvN1jGzeLjbraqm64UnXBwZjwWaExBvqMXQz2GJS21ESDOiLodpsdMtxe3rV9xxCZb9REeXOgjvPIXO38YmO%2BrzLDbloM4nhSyYIkWKwQUgoyO9sAtOQDQ0RAw%2BciMywY6pgGb0ScesDvKwLf56Z2i%2FsMjBWVBR3ARUqUFh68rEJtJeHfaiwwspyeNvqalzDa6nS5lnLEHF1Hp6k3yAZSDi6RCUMs%2FegOpF%2BSxf3HIrgqdMaAzynTVjIH5JRmxkcXQoN%2FWcmaT12wgTRr6c29XNB9Tdorkv9smElJ2mOTHIQA5bxOPGyKSmzcD7lYsGeWQyUEkjTbxATLRud%2FUxSF%2FHkx7WbG%2Btw%2Bc&X-Amz-Signature=0710c7438043dab945002145f9442a65f747d60e40a9f1acc7cf35b039c58401&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

