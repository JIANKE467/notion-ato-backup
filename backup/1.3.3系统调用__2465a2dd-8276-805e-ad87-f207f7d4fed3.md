
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB46646UOFEFP%2F20251219%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251219T040601Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjENv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQD%2BQ5S%2Fgc6YOc3t1euEmJtAUH8Nnfgf5%2FvAOTH5kRkBcgIhAMQa8VUVGxD2%2Fxj03GGAy8yepVqk26MDCDp7VGrxzK2XKogECKT%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1IgyABDW634b07OHuc3kq3ANKIdzqvn3H3xT5KMzRWPHA5dE1EfbqM9BZ1MrrnBhC%2BW%2B2MsEUODSCQ6R4IRquxvuHqaxI7QBRKHHSI%2FSr0%2F8EbzH%2FG28RXdHMU%2Ft%2B3XV4KG9wFnR9Sv88S9ikL%2FNSb4M%2BEyrzUwDb98uy3efmxd%2BfJUVy7tTf4anEcYJtY5RPZiPK9oT9sI7zuGTmWTdS1j3zeZ9dusk6kgchY3K6rACIKHGyvN%2BpPwcsWE5kcjpzemY2iriWehSs0rn0F7UztWQ6NN2g7GHZ9Dy7%2Bt1vLV%2FQRYQToj%2FDtP3jsZIDR0AwwbzAXcRuUnrZY7eVXuHQ1nc8rw9bwrOrGM7e864CtrTyaKxn9SzxWzfx27x3%2BXT%2F1mNA%2BEIB%2FWRRJwCvtWC8vg9pNRDTllT3G4hIzPVHsX%2BxM%2FIB3hDricpmw6dB27Da4NIH0mOs5ih40zMAf8q%2FtW1e1Kf4EvtKBXM2zedrxpWnKogoY2e9uCieWiZffgGIa1QHnivxIxqMPgFTPrnCpxWWZis1nNWzIHM1u2Cm%2BZwLwKbI%2BJXf1FMblMSKcZdcFBNnIxieBvgYIC39QdJP%2BGMBgMhRnIL%2FBOM7hO5%2BsH3TYDAEWlwP62qG4SQ7LK19kgBly6jyKhdc0trmwjCchZPKBjqkAcWgNoQo4EGUaWkwPjoikC6LGtGMxxzgJGmDBVW0khDftONgXeppBItQ5uHgIWuDn6g%2FHhFWhKUhoBPz26AnQKKU67Dyw6VytHdivkY5eKcRTZNsxKXR2j%2B%2B%2B3MDCHX0PfD1epdK8oTdrO7UDUeHSocqyQI%2B4pQ59vYkK2o0qqxyg24x%2B7ERvfcxNLrdq%2ByKbg6L%2BMin%2FrtOYzktmPEMZ4kMe3zm&X-Amz-Signature=332f3a15adc514a80ecb8362f6d5420a8e69162edd99cdd4e8af226ed3f12552&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB46646UOFEFP%2F20251219%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251219T040601Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjENv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQD%2BQ5S%2Fgc6YOc3t1euEmJtAUH8Nnfgf5%2FvAOTH5kRkBcgIhAMQa8VUVGxD2%2Fxj03GGAy8yepVqk26MDCDp7VGrxzK2XKogECKT%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1IgyABDW634b07OHuc3kq3ANKIdzqvn3H3xT5KMzRWPHA5dE1EfbqM9BZ1MrrnBhC%2BW%2B2MsEUODSCQ6R4IRquxvuHqaxI7QBRKHHSI%2FSr0%2F8EbzH%2FG28RXdHMU%2Ft%2B3XV4KG9wFnR9Sv88S9ikL%2FNSb4M%2BEyrzUwDb98uy3efmxd%2BfJUVy7tTf4anEcYJtY5RPZiPK9oT9sI7zuGTmWTdS1j3zeZ9dusk6kgchY3K6rACIKHGyvN%2BpPwcsWE5kcjpzemY2iriWehSs0rn0F7UztWQ6NN2g7GHZ9Dy7%2Bt1vLV%2FQRYQToj%2FDtP3jsZIDR0AwwbzAXcRuUnrZY7eVXuHQ1nc8rw9bwrOrGM7e864CtrTyaKxn9SzxWzfx27x3%2BXT%2F1mNA%2BEIB%2FWRRJwCvtWC8vg9pNRDTllT3G4hIzPVHsX%2BxM%2FIB3hDricpmw6dB27Da4NIH0mOs5ih40zMAf8q%2FtW1e1Kf4EvtKBXM2zedrxpWnKogoY2e9uCieWiZffgGIa1QHnivxIxqMPgFTPrnCpxWWZis1nNWzIHM1u2Cm%2BZwLwKbI%2BJXf1FMblMSKcZdcFBNnIxieBvgYIC39QdJP%2BGMBgMhRnIL%2FBOM7hO5%2BsH3TYDAEWlwP62qG4SQ7LK19kgBly6jyKhdc0trmwjCchZPKBjqkAcWgNoQo4EGUaWkwPjoikC6LGtGMxxzgJGmDBVW0khDftONgXeppBItQ5uHgIWuDn6g%2FHhFWhKUhoBPz26AnQKKU67Dyw6VytHdivkY5eKcRTZNsxKXR2j%2B%2B%2B3MDCHX0PfD1epdK8oTdrO7UDUeHSocqyQI%2B4pQ59vYkK2o0qqxyg24x%2B7ERvfcxNLrdq%2ByKbg6L%2BMin%2FrtOYzktmPEMZ4kMe3zm&X-Amz-Signature=a17e16e8da99ea1912bb63e34fd2d3c8171f1cf3cae1758a3dbabacd11821695&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB46646UOFEFP%2F20251219%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251219T040601Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjENv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQD%2BQ5S%2Fgc6YOc3t1euEmJtAUH8Nnfgf5%2FvAOTH5kRkBcgIhAMQa8VUVGxD2%2Fxj03GGAy8yepVqk26MDCDp7VGrxzK2XKogECKT%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1IgyABDW634b07OHuc3kq3ANKIdzqvn3H3xT5KMzRWPHA5dE1EfbqM9BZ1MrrnBhC%2BW%2B2MsEUODSCQ6R4IRquxvuHqaxI7QBRKHHSI%2FSr0%2F8EbzH%2FG28RXdHMU%2Ft%2B3XV4KG9wFnR9Sv88S9ikL%2FNSb4M%2BEyrzUwDb98uy3efmxd%2BfJUVy7tTf4anEcYJtY5RPZiPK9oT9sI7zuGTmWTdS1j3zeZ9dusk6kgchY3K6rACIKHGyvN%2BpPwcsWE5kcjpzemY2iriWehSs0rn0F7UztWQ6NN2g7GHZ9Dy7%2Bt1vLV%2FQRYQToj%2FDtP3jsZIDR0AwwbzAXcRuUnrZY7eVXuHQ1nc8rw9bwrOrGM7e864CtrTyaKxn9SzxWzfx27x3%2BXT%2F1mNA%2BEIB%2FWRRJwCvtWC8vg9pNRDTllT3G4hIzPVHsX%2BxM%2FIB3hDricpmw6dB27Da4NIH0mOs5ih40zMAf8q%2FtW1e1Kf4EvtKBXM2zedrxpWnKogoY2e9uCieWiZffgGIa1QHnivxIxqMPgFTPrnCpxWWZis1nNWzIHM1u2Cm%2BZwLwKbI%2BJXf1FMblMSKcZdcFBNnIxieBvgYIC39QdJP%2BGMBgMhRnIL%2FBOM7hO5%2BsH3TYDAEWlwP62qG4SQ7LK19kgBly6jyKhdc0trmwjCchZPKBjqkAcWgNoQo4EGUaWkwPjoikC6LGtGMxxzgJGmDBVW0khDftONgXeppBItQ5uHgIWuDn6g%2FHhFWhKUhoBPz26AnQKKU67Dyw6VytHdivkY5eKcRTZNsxKXR2j%2B%2B%2B3MDCHX0PfD1epdK8oTdrO7UDUeHSocqyQI%2B4pQ59vYkK2o0qqxyg24x%2B7ERvfcxNLrdq%2ByKbg6L%2BMin%2FrtOYzktmPEMZ4kMe3zm&X-Amz-Signature=6817ea745e74acc04c6368a74a306feafce16f6ba270654958ae20e4ccb8dcb6&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB46646UOFEFP%2F20251219%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251219T040601Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjENv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQD%2BQ5S%2Fgc6YOc3t1euEmJtAUH8Nnfgf5%2FvAOTH5kRkBcgIhAMQa8VUVGxD2%2Fxj03GGAy8yepVqk26MDCDp7VGrxzK2XKogECKT%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1IgyABDW634b07OHuc3kq3ANKIdzqvn3H3xT5KMzRWPHA5dE1EfbqM9BZ1MrrnBhC%2BW%2B2MsEUODSCQ6R4IRquxvuHqaxI7QBRKHHSI%2FSr0%2F8EbzH%2FG28RXdHMU%2Ft%2B3XV4KG9wFnR9Sv88S9ikL%2FNSb4M%2BEyrzUwDb98uy3efmxd%2BfJUVy7tTf4anEcYJtY5RPZiPK9oT9sI7zuGTmWTdS1j3zeZ9dusk6kgchY3K6rACIKHGyvN%2BpPwcsWE5kcjpzemY2iriWehSs0rn0F7UztWQ6NN2g7GHZ9Dy7%2Bt1vLV%2FQRYQToj%2FDtP3jsZIDR0AwwbzAXcRuUnrZY7eVXuHQ1nc8rw9bwrOrGM7e864CtrTyaKxn9SzxWzfx27x3%2BXT%2F1mNA%2BEIB%2FWRRJwCvtWC8vg9pNRDTllT3G4hIzPVHsX%2BxM%2FIB3hDricpmw6dB27Da4NIH0mOs5ih40zMAf8q%2FtW1e1Kf4EvtKBXM2zedrxpWnKogoY2e9uCieWiZffgGIa1QHnivxIxqMPgFTPrnCpxWWZis1nNWzIHM1u2Cm%2BZwLwKbI%2BJXf1FMblMSKcZdcFBNnIxieBvgYIC39QdJP%2BGMBgMhRnIL%2FBOM7hO5%2BsH3TYDAEWlwP62qG4SQ7LK19kgBly6jyKhdc0trmwjCchZPKBjqkAcWgNoQo4EGUaWkwPjoikC6LGtGMxxzgJGmDBVW0khDftONgXeppBItQ5uHgIWuDn6g%2FHhFWhKUhoBPz26AnQKKU67Dyw6VytHdivkY5eKcRTZNsxKXR2j%2B%2B%2B3MDCHX0PfD1epdK8oTdrO7UDUeHSocqyQI%2B4pQ59vYkK2o0qqxyg24x%2B7ERvfcxNLrdq%2ByKbg6L%2BMin%2FrtOYzktmPEMZ4kMe3zm&X-Amz-Signature=cae9f60c1ef17d0bf2befecd65b5081ee0a9ce4fc9b37eb7184b69ef4cc9dabe&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

