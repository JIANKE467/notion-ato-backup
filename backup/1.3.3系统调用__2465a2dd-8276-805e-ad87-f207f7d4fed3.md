
系统调用是提供内核服务的接口


（要想执行特权指令需要使用系统调用，而非使用越权的指令）


### 系统调用与库函数的区别


一个程序可以用汇编直接使用系统调用


也可以使用库函数间接使用系统调用（库函数直接使用系统调用）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/a0f71c13-988a-4aca-bbc8-7fe8a14f2dfa/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466RXTMMTLZ%2F20260118%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260118T041643Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCKMz627tirqo0Is18UHe3see9O%2FvFAGe9hvjJdhlQA%2FgIhAPP60LHWo2FAdB%2FQHRPVsglzQlm%2BSozYOKfF5v4r9b79Kv8DCHQQABoMNjM3NDIzMTgzODA1IgyOF2Q7mBGTai1eEJ8q3ANVR4jyy9NXDHsGwcZ%2FC3CLOdkw4JdSU4uhdJKWcz4HFbQGEZSoQ%2Bw%2BKl2NpcEw1kU1GhwdyyB0WmFUCcvGKvndhVxXSU0gaR1Hpn9Cph6TXDpJcjC6KiFBRKxQK1CQ23mNwz%2FyHe04j1uUXqVr%2F14iA4Rwdgo4CyDrnBd%2FCMYsEoOLqpFLbmbmpApK%2FLaSOQ7Ip8fEYmCCdd4jOsHOdrC1tcom9BVJ1nOVoaR%2FcZ%2Fso5R3YtkVWsfW0MLxUMtNLYNC1lwi2qpU9MSCQwJau%2BNqatj1At%2Bfv95UXdQXX1OcIIexz8JPBSwpV2CHUj8xZVMkEKU2W9m0WfMeR0Br5aouHZiIY%2BaiPHDZ2PCAUKOQEMJqMHJCzUUjUtQufC5VdBEB7x6yfMnaD6i%2Fi7tWpZNgzPTWSmuW27LC04%2FU%2FFMFvM7CfPQ%2BB1qB9VcB8T1gpQVitcfQOIO9UDJHnptfYYOHXH7cQSi2xp14D0uwqVTjhSRoMPADVv%2ByEHgktNy2sXv7%2Fe%2FxsNd8H612gkNHOYofzM3ozdWgLwcAePoXnWacMKFy6GUpSe6XeKUy4ZilO8rxIK8ZKO8gw%2FLjF0rrVhQO%2B5%2F%2BQYKSHde9pdmD%2BR7d5GHlOMUfW9idKpj61zC0jrHLBjqkATHQG7lfhh5hJBOEfQmfkUYjdMIxyVtlIrlL983tjFPeSE0hp3efV%2F6Phr%2BLBUPDxfVRdfxfl%2Fi8FGrjUPgzVN7tYJgbC4WsBHPcSUdflMSFbRnS60bhAM8xayTAQDeZK9D6wwJ%2FCP9Lyn%2Bfk7cVQxtv%2B99TwZ1zTjWvRSnGtOuduUkbbH9q2zgB%2FZKEcNTVpBxJirRgc%2BP8Ckd25UcyysFdCKHX&X-Amz-Signature=91f7b0fa395f6a7ad834b74db5de65748322b2d616e79f6c16706f8430b952ae&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 为什么要系统调用


例：当多个进程同时使用一种设备资源（如摄像头）需要内核决定使用顺序，否则会出现争抢摄像头的情况


### 什么功能要系统调用


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/5c6a2eff-5468-4340-8c3e-2646dc3700e6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466RXTMMTLZ%2F20260118%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260118T041643Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCKMz627tirqo0Is18UHe3see9O%2FvFAGe9hvjJdhlQA%2FgIhAPP60LHWo2FAdB%2FQHRPVsglzQlm%2BSozYOKfF5v4r9b79Kv8DCHQQABoMNjM3NDIzMTgzODA1IgyOF2Q7mBGTai1eEJ8q3ANVR4jyy9NXDHsGwcZ%2FC3CLOdkw4JdSU4uhdJKWcz4HFbQGEZSoQ%2Bw%2BKl2NpcEw1kU1GhwdyyB0WmFUCcvGKvndhVxXSU0gaR1Hpn9Cph6TXDpJcjC6KiFBRKxQK1CQ23mNwz%2FyHe04j1uUXqVr%2F14iA4Rwdgo4CyDrnBd%2FCMYsEoOLqpFLbmbmpApK%2FLaSOQ7Ip8fEYmCCdd4jOsHOdrC1tcom9BVJ1nOVoaR%2FcZ%2Fso5R3YtkVWsfW0MLxUMtNLYNC1lwi2qpU9MSCQwJau%2BNqatj1At%2Bfv95UXdQXX1OcIIexz8JPBSwpV2CHUj8xZVMkEKU2W9m0WfMeR0Br5aouHZiIY%2BaiPHDZ2PCAUKOQEMJqMHJCzUUjUtQufC5VdBEB7x6yfMnaD6i%2Fi7tWpZNgzPTWSmuW27LC04%2FU%2FFMFvM7CfPQ%2BB1qB9VcB8T1gpQVitcfQOIO9UDJHnptfYYOHXH7cQSi2xp14D0uwqVTjhSRoMPADVv%2ByEHgktNy2sXv7%2Fe%2FxsNd8H612gkNHOYofzM3ozdWgLwcAePoXnWacMKFy6GUpSe6XeKUy4ZilO8rxIK8ZKO8gw%2FLjF0rrVhQO%2B5%2F%2BQYKSHde9pdmD%2BR7d5GHlOMUfW9idKpj61zC0jrHLBjqkATHQG7lfhh5hJBOEfQmfkUYjdMIxyVtlIrlL983tjFPeSE0hp3efV%2F6Phr%2BLBUPDxfVRdfxfl%2Fi8FGrjUPgzVN7tYJgbC4WsBHPcSUdflMSFbRnS60bhAM8xayTAQDeZK9D6wwJ%2FCP9Lyn%2Bfk7cVQxtv%2B99TwZ1zTjWvRSnGtOuduUkbbH9q2zgB%2FZKEcNTVpBxJirRgc%2BP8Ckd25UcyysFdCKHX&X-Amz-Signature=b673179bc66eeaa4d9608229d7a7b29051b69a90c1f87e12080236c1ea1230e4&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 系统调用过程


传参指令……（用户态）→陷入指令（用户态）[引发中断]→中断处理程序（内核态）[选择相应的系统调用处理程序]→相应系统调用处理程序（由传入的参数决定）


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/81119b28-7bd7-4ca6-85ed-8a132fcab89d/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466RXTMMTLZ%2F20260118%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260118T041643Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCKMz627tirqo0Is18UHe3see9O%2FvFAGe9hvjJdhlQA%2FgIhAPP60LHWo2FAdB%2FQHRPVsglzQlm%2BSozYOKfF5v4r9b79Kv8DCHQQABoMNjM3NDIzMTgzODA1IgyOF2Q7mBGTai1eEJ8q3ANVR4jyy9NXDHsGwcZ%2FC3CLOdkw4JdSU4uhdJKWcz4HFbQGEZSoQ%2Bw%2BKl2NpcEw1kU1GhwdyyB0WmFUCcvGKvndhVxXSU0gaR1Hpn9Cph6TXDpJcjC6KiFBRKxQK1CQ23mNwz%2FyHe04j1uUXqVr%2F14iA4Rwdgo4CyDrnBd%2FCMYsEoOLqpFLbmbmpApK%2FLaSOQ7Ip8fEYmCCdd4jOsHOdrC1tcom9BVJ1nOVoaR%2FcZ%2Fso5R3YtkVWsfW0MLxUMtNLYNC1lwi2qpU9MSCQwJau%2BNqatj1At%2Bfv95UXdQXX1OcIIexz8JPBSwpV2CHUj8xZVMkEKU2W9m0WfMeR0Br5aouHZiIY%2BaiPHDZ2PCAUKOQEMJqMHJCzUUjUtQufC5VdBEB7x6yfMnaD6i%2Fi7tWpZNgzPTWSmuW27LC04%2FU%2FFMFvM7CfPQ%2BB1qB9VcB8T1gpQVitcfQOIO9UDJHnptfYYOHXH7cQSi2xp14D0uwqVTjhSRoMPADVv%2ByEHgktNy2sXv7%2Fe%2FxsNd8H612gkNHOYofzM3ozdWgLwcAePoXnWacMKFy6GUpSe6XeKUy4ZilO8rxIK8ZKO8gw%2FLjF0rrVhQO%2B5%2F%2BQYKSHde9pdmD%2BR7d5GHlOMUfW9idKpj61zC0jrHLBjqkATHQG7lfhh5hJBOEfQmfkUYjdMIxyVtlIrlL983tjFPeSE0hp3efV%2F6Phr%2BLBUPDxfVRdfxfl%2Fi8FGrjUPgzVN7tYJgbC4WsBHPcSUdflMSFbRnS60bhAM8xayTAQDeZK9D6wwJ%2FCP9Lyn%2Bfk7cVQxtv%2B99TwZ1zTjWvRSnGtOuduUkbbH9q2zgB%2FZKEcNTVpBxJirRgc%2BP8Ckd25UcyysFdCKHX&X-Amz-Signature=0153c1038f56c802694a590d559d69685b023b47b2c56f072e3bce4bddb72cf4&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


ps：陷入指令=访管指令=trap指令


### 总结


![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/51145155-d0f0-4bb1-85cf-344e4c2400e0/d00274b7-ffbf-42d2-9255-534022d080b6/image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466RXTMMTLZ%2F20260118%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260118T041643Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCKMz627tirqo0Is18UHe3see9O%2FvFAGe9hvjJdhlQA%2FgIhAPP60LHWo2FAdB%2FQHRPVsglzQlm%2BSozYOKfF5v4r9b79Kv8DCHQQABoMNjM3NDIzMTgzODA1IgyOF2Q7mBGTai1eEJ8q3ANVR4jyy9NXDHsGwcZ%2FC3CLOdkw4JdSU4uhdJKWcz4HFbQGEZSoQ%2Bw%2BKl2NpcEw1kU1GhwdyyB0WmFUCcvGKvndhVxXSU0gaR1Hpn9Cph6TXDpJcjC6KiFBRKxQK1CQ23mNwz%2FyHe04j1uUXqVr%2F14iA4Rwdgo4CyDrnBd%2FCMYsEoOLqpFLbmbmpApK%2FLaSOQ7Ip8fEYmCCdd4jOsHOdrC1tcom9BVJ1nOVoaR%2FcZ%2Fso5R3YtkVWsfW0MLxUMtNLYNC1lwi2qpU9MSCQwJau%2BNqatj1At%2Bfv95UXdQXX1OcIIexz8JPBSwpV2CHUj8xZVMkEKU2W9m0WfMeR0Br5aouHZiIY%2BaiPHDZ2PCAUKOQEMJqMHJCzUUjUtQufC5VdBEB7x6yfMnaD6i%2Fi7tWpZNgzPTWSmuW27LC04%2FU%2FFMFvM7CfPQ%2BB1qB9VcB8T1gpQVitcfQOIO9UDJHnptfYYOHXH7cQSi2xp14D0uwqVTjhSRoMPADVv%2ByEHgktNy2sXv7%2Fe%2FxsNd8H612gkNHOYofzM3ozdWgLwcAePoXnWacMKFy6GUpSe6XeKUy4ZilO8rxIK8ZKO8gw%2FLjF0rrVhQO%2B5%2F%2BQYKSHde9pdmD%2BR7d5GHlOMUfW9idKpj61zC0jrHLBjqkATHQG7lfhh5hJBOEfQmfkUYjdMIxyVtlIrlL983tjFPeSE0hp3efV%2F6Phr%2BLBUPDxfVRdfxfl%2Fi8FGrjUPgzVN7tYJgbC4WsBHPcSUdflMSFbRnS60bhAM8xayTAQDeZK9D6wwJ%2FCP9Lyn%2Bfk7cVQxtv%2B99TwZ1zTjWvRSnGtOuduUkbbH9q2zgB%2FZKEcNTVpBxJirRgc%2BP8Ckd25UcyysFdCKHX&X-Amz-Signature=b49af6a3bcc654fc0a76dd3a99621f869aa4585bc84b1221f870cea376810fbe&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

